"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4455],{4455:(Uv,gu,P)=>{P.r(gu),P.d(gu,{LoginPageModule:()=>qv});var pu=P(6895),Lr=P(433),Ae=P(502),yu=P(1194),Dn=P(655),_=P(4650),ai=P(9646),hf=P(3900),Ke=P(1205),df=P(4986),ff=P(9751),Or=P(8996),Re=P(2122),ui=P(8675),mf=P(4482),gf=P(5403);function ci(){return(0,mf.e)((n,e)=>{let t,r=!1;n.subscribe((0,gf.x)(e,s=>{const i=t;t=s,r&&e.next([i,s]),r=!0}))})}var b,Le=P(4004),li=P(5026),pf=P(1884),vu=P(9300),Vr=P(2011),yf=(P(750),P(3942)),p=P(5861),Pr=P(9681),wu=P(4859),wt=P(1877),K=P(2090),vf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},je={},hi=hi||{},D=vf||self;function qr(){}function Ur(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Nn(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var di="closure_uid_"+(1e9*Math.random()>>>0),_f=0;function If(n,e,t){return n.call.apply(n.bind,arguments)}function xf(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,r),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function ve(n,e,t){return(ve=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?If:xf).apply(null,arguments)}function Br(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function fe(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(r,s,i){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(r,o)}}function Je(){this.s=this.s,this.o=this.o}Je.prototype.s=!1,Je.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function wf(n){Object.prototype.hasOwnProperty.call(n,di)&&n[di]||(n[di]=++_f)}(this)},Je.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const _u=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function fi(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Iu(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Ur(r)){const s=n.length||0,i=r.length||0;n.length=s+i;for(let o=0;o<i;o++)n[s+o]=r[o]}else n.push(r)}}function we(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}we.prototype.h=function(){this.defaultPrevented=!0};var Ef=function(){if(!D.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{D.addEventListener("test",qr,e),D.removeEventListener("test",qr,e)}catch(t){}return n}();function Gr(n){return/^[\s\xa0]*$/.test(n)}var xu=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function mi(n,e){return n<e?-1:n>e?1:0}function Kr(){var n=D.navigator;return n&&(n=n.userAgent)?n:""}function Oe(n){return-1!=Kr().indexOf(n)}function gi(n){return gi[" "](n),n}gi[" "]=qr;var jr,n,bf=Oe("Opera"),Wt=Oe("Trident")||Oe("MSIE"),Tu=Oe("Edge"),pi=Tu||Wt,Eu=Oe("Gecko")&&!(-1!=Kr().toLowerCase().indexOf("webkit")&&!Oe("Edge"))&&!(Oe("Trident")||Oe("MSIE"))&&!Oe("Edge"),Cf=-1!=Kr().toLowerCase().indexOf("webkit")&&!Oe("Edge");function Su(){var n=D.document;return n?n.documentMode:void 0}e:{var yi="",vi=(n=Kr(),Eu?/rv:([^\);]+)(\)|;)/.exec(n):Tu?/Edge\/([\d\.]+)/.exec(n):Wt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Cf?/WebKit\/(\S+)/.exec(n):bf?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(vi&&(yi=vi?vi[1]:""),Wt){var wi=Su();if(null!=wi&&wi>parseFloat(yi)){jr=String(wi);break e}}jr=yi}var Af={};var Nf=D.document&&Wt&&(Su()||parseInt(jr,10))||void 0;function kn(n,e){if(we.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Eu){e:{try{gi(e.nodeName);var s=!0;break e}catch(i){}s=!1}s||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:kf[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&kn.X.h.call(this)}}fe(kn,we);var kf={2:"touch",3:"pen",4:"mouse"};kn.prototype.h=function(){kn.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Rn="closure_listenable_"+(1e6*Math.random()|0),Rf=0;function Ff(n,e,t,r,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=s,this.key=++Rf,this.ba=this.ea=!1}function $r(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function Ii(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Cu(n){const e={};for(const t in n)e[t]=n[t];return e}const Au="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Du(n,e){let t,r;for(let s=1;s<arguments.length;s++){for(t in r=arguments[s],r)n[t]=r[t];for(let i=0;i<Au.length;i++)t=Au[i],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function zr(n){this.src=n,this.g={},this.h=0}function xi(n,e){var t=e.type;if(t in n.g){var i,r=n.g[t],s=_u(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&($r(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Ti(n,e,t,r){for(var s=0;s<n.length;++s){var i=n[s];if(!i.ba&&i.listener==e&&i.capture==!!t&&i.ha==r)return s}return-1}zr.prototype.add=function(n,e,t,r,s){var i=n.toString();(n=this.g[i])||(n=this.g[i]=[],this.h++);var o=Ti(n,e,r,s);return-1<o?(e=n[o],t||(e.ea=!1)):((e=new Ff(e,this.src,i,!!r,s)).ea=t,n.push(e)),e};var Ei="closure_lm_"+(1e6*Math.random()|0),Si={};function Nu(n,e,t,r,s){if(r&&r.once)return Ru(n,e,t,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Nu(n,e[i],t,r,s);return null}return t=Di(t),n&&n[Rn]?n.N(e,t,Nn(r)?!!r.capture:!!r,s):ku(n,e,t,!1,r,s)}function ku(n,e,t,r,s,i){if(!e)throw Error("Invalid event type");var o=Nn(s)?!!s.capture:!!s,a=Ci(n);if(a||(n[Ei]=a=new zr(n)),(t=a.add(e,t,r,o,i)).proxy)return t;if(r=function Mf(){const e=Lf;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Ef||(s=o),void 0===s&&(s=!1),n.addEventListener(e.toString(),r,s);else if(n.attachEvent)n.attachEvent(Mu(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Ru(n,e,t,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)Ru(n,e[i],t,r,s);return null}return t=Di(t),n&&n[Rn]?n.O(e,t,Nn(r)?!!r.capture:!!r,s):ku(n,e,t,!0,r,s)}function Fu(n,e,t,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)Fu(n,e[i],t,r,s);else r=Nn(r)?!!r.capture:!!r,t=Di(t),n&&n[Rn]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Ti(i=n.g[e],t,r,s))&&($r(i[t]),Array.prototype.splice.call(i,t,1),0==i.length&&(delete n.g[e],n.h--))):n&&(n=Ci(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ti(e,t,r,s)),(t=-1<n?e[n]:null)&&bi(t))}function bi(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[Rn])xi(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Mu(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Ci(e))?(xi(t,n),0==t.h&&(t.src=null,e[Ei]=null)):$r(n)}}}function Mu(n){return n in Si?Si[n]:Si[n]="on"+n}function Lf(n,e){if(n.ba)n=!0;else{e=new kn(e,this);var t=n.listener,r=n.ha||n.src;n.ea&&bi(n),n=t.call(r,e)}return n}function Ci(n){return(n=n[Ei])instanceof zr?n:null}var Ai="__closure_events_fn_"+(1e9*Math.random()>>>0);function Di(n){return"function"==typeof n?n:(n[Ai]||(n[Ai]=function(e){return n.handleEvent(e)}),n[Ai])}function ce(){Je.call(this),this.i=new zr(this),this.P=this,this.I=null}function me(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new we(e,n);else if(e instanceof we)e.target=e.target||n;else{var s=e;Du(e=new we(r,n),s)}if(s=!0,t)for(var i=t.length-1;0<=i;i--){var o=e.g=t[i];s=Qr(o,r,!0,e)&&s}if(s=Qr(o=e.g=n,r,!0,e)&&s,s=Qr(o,r,!1,e)&&s,t)for(i=0;i<t.length;i++)s=Qr(o=e.g=t[i],r,!1,e)&&s}function Qr(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ba&&o.capture==t){var a=o.listener,u=o.ha||o.src;o.ea&&xi(n.i,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}fe(ce,Je),ce.prototype[Rn]=!0,ce.prototype.removeEventListener=function(n,e,t,r){Fu(this,n,e,t,r)},ce.prototype.M=function(){if(ce.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)$r(t[r]);delete n.g[e],n.h--}}this.I=null},ce.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},ce.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Ni=D.JSON.stringify;function Of(){var n=Vu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var ki,Lu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new Pf,n=>n.reset());class Pf{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function qf(n){D.setTimeout(()=>{throw n},0)}function Ou(n,e){ki||function Uf(){var n=D.Promise.resolve(void 0);ki=function(){n.then(Bf)}}(),Ri||(ki(),Ri=!0),Vu.add(n,e)}var Ri=!1,Vu=new class Vf{constructor(){this.h=this.g=null}add(e,t){const r=Lu.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function Bf(){for(var n;n=Of();){try{n.h.call(n.g)}catch(t){qf(t)}var e=Lu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ri=!1}function Zr(n,e){ce.call(this),this.h=n||1,this.g=e||D,this.j=ve(this.lb,this),this.l=Date.now()}function Fi(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function Mi(n,e,t){if("function"==typeof n)t&&(n=ve(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=ve(n.handleEvent,n)}return 2147483647<Number(e)?-1:D.setTimeout(n,e||0)}function Pu(n){n.g=Mi(()=>{n.g=null,n.i&&(n.i=!1,Pu(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}fe(Zr,ce),(b=Zr.prototype).ca=!1,b.R=null,b.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),me(this,"tick"),this.ca&&(Fi(this),this.start()))}},b.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},b.M=function(){Zr.X.M.call(this),Fi(this),delete this.g};class Gf extends Je{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Pu(this)}M(){super.M(),this.g&&(D.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Fn(n){Je.call(this),this.h=n,this.g={}}fe(Fn,Je);var qu=[];function Uu(n,e,t,r){Array.isArray(t)||(t&&(qu[0]=t.toString()),t=qu);for(var s=0;s<t.length;s++){var i=Nu(e,t[s],r||n.handleEvent,!1,n.h||n);if(!i)break;n.g[i.key]=i}}function Bu(n){Ii(n.g,function(e,t){this.g.hasOwnProperty(t)&&bi(e)},n),n.g={}}function Wr(){this.g=!0}function Ht(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function zf(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ni(t)}catch(a){return e}}(n,t)+(r?" "+r:"")})}Fn.prototype.M=function(){Fn.X.M.call(this),Bu(this)},Fn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Wr.prototype.Aa=function(){this.g=!1},Wr.prototype.info=function(){};var _t={},Gu=null;function Hr(){return Gu=Gu||new ce}function Ku(n){we.call(this,_t.Pa,n)}function Mn(n){const e=Hr();me(e,new Ku(e))}function ju(n,e){we.call(this,_t.STAT_EVENT,n),this.stat=e}function _e(n){const e=Hr();me(e,new ju(e,n))}function $u(n,e){we.call(this,_t.Qa,n),this.size=e}function Ln(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return D.setTimeout(function(){n()},e)}_t.Pa="serverreachability",fe(Ku,we),_t.STAT_EVENT="statevent",fe(ju,we),_t.Qa="timingevent",fe($u,we);var Yr={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},zu={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Li(){}function Zu(){}Li.prototype.h=null;var Pi,On={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Oi(){we.call(this,"d")}function Vi(){we.call(this,"c")}function Xr(){}function Vn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.U=r||1,this.S=new Fn(this),this.O=Qf,this.T=new Zr(n=pi?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Wu}function Wu(){this.i=null,this.g="",this.h=!1}fe(Oi,we),fe(Vi,we),fe(Xr,Li),Xr.prototype.g=function(){return new XMLHttpRequest},Xr.prototype.i=function(){return{}},Pi=new Xr;var Qf=45e3,qi={},Jr={};function Ui(n,e,t){n.K=1,n.v=rs($e(e)),n.s=t,n.P=!0,Hu(n,null)}function Hu(n,e){n.F=Date.now(),Pn(n),n.A=$e(n.v);var t=n.A,r=n.U;Array.isArray(r)||(r=[String(r)]),oc(t.i,"t",r),n.C=0,t=n.l.H,n.h=new Wu,n.g=Nc(n.l,t?e:null,!n.s),0<n.N&&(n.L=new Gf(ve(n.La,n,n.g),n.N)),Uu(n.S,n.g,"readystatechange",n.ib),e=n.H?Cu(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Mn(),function Kf(n,e,t,r,s,i){n.info(function(){if(n.g)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+t+"\n"+o})}(n.j,n.u,n.A,n.m,n.U,n.s)}function Yu(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function Xu(n,e,t){let s,r=!0;for(;!n.I&&n.C<t.length;){if(s=Zf(n,t),s==Jr){4==e&&(n.o=4,_e(14),r=!1),Ht(n.j,n.m,null,"[Incomplete Response]");break}if(s==qi){n.o=4,_e(15),Ht(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Ht(n.j,n.m,s,null),Bi(n,s)}Yu(n)&&s!=Jr&&s!=qi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,_e(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Wi(e),e.K=!0,_e(11))):(Ht(n.j,n.m,t,"[Invalid Chunked Response]"),It(n),qn(n))}function Zf(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Jr:(t=Number(e.substring(t,r)),isNaN(t)?qi:(r+=1)+t>e.length?Jr:(e=e.substr(r,t),n.C=r+t,e))}function Pn(n){n.V=Date.now()+n.O,Ju(n,n.O)}function Ju(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Ln(ve(n.gb,n),e)}function es(n){n.B&&(D.clearTimeout(n.B),n.B=null)}function qn(n){0==n.l.G||n.I||bc(n.l,n)}function It(n){es(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,Fi(n.T),Bu(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Bi(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Gi(t.h,n)))if(!n.J&&Gi(t.h,n)&&3==t.G){try{var r=t.Fa.g.parse(e)}catch(c){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!t.u){if(t.g){if(!(t.g.F+3e3<n.F))break e;cs(t),as(t)}Zi(t),_e(18)}}else t.Ba=s[1],0<t.Ba-t.T&&37500>s[2]&&t.L&&0==t.A&&!t.v&&(t.v=Ln(ve(t.cb,t),6e3));if(1>=cc(t.h)&&t.ja){try{t.ja()}catch(c){}t.ja=void 0}}else Tt(t,11)}else if((n.J||t.g==n)&&cs(t),!Gr(e))for(s=t.Fa.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(t.T=c[0],c=c[1],2==t.G)if("c"==c[0]){t.I=c[1],t.ka=c[2];const l=c[3];null!=l&&(t.ma=l,t.j.info("VER="+t.ma));const h=c[4];null!=h&&(t.Ca=h,t.j.info("SVER="+t.Ca));const d=c[5];null!=d&&"number"==typeof d&&0<d&&(t.J=r=1.5*d,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const g=n.g;if(g){const v=g.g?g.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(v){var i=r.h;i.g||-1==v.indexOf("spdy")&&-1==v.indexOf("quic")&&-1==v.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ki(i,i.h),i.h=null))}if(r.D){const T=g.g?g.g.getResponseHeader("X-HTTP-Session-Id"):null;T&&(r.za=T,Q(r.F,r.D,T))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var o=n;if((r=t).sa=Dc(r,r.H?r.ka:null,r.V),o.J){lc(r.h,o);var a=o,u=r.J;u&&a.setTimeout(u),a.B&&(es(a),Pn(a)),r.g=o}else Ec(r);0<t.i.length&&us(t)}else"stop"!=c[0]&&"close"!=c[0]||Tt(t,7);else 3==t.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Tt(t,7):Qi(t):"noop"!=c[0]&&t.l&&t.l.wa(c),t.A=0)}Mn()}catch(c){}}function ec(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(Ur(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Hf(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Ur(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function Wf(n){if(n.W&&"function"==typeof n.W)return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(Ur(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],t&&t[i],n)}(b=Vn.prototype).setTimeout=function(n){this.O=n},b.ib=function(n){n=n.target;const e=this.L;e&&3==ze(n)?e.l():this.La(n)},b.La=function(n){try{if(n==this.g)e:{const l=ze(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>l)&&(3!=l||pi||this.g&&(this.h.h||this.g.fa()||vc(this.g)))){this.I||4!=l||7==e||Mn(),es(this);var t=this.g.aa();this.Y=t;t:if(Yu(this)){var r=vc(this.g);n="";var s=r.length,i=4==ze(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){It(this),qn(this);var o="";break t}this.h.i=new D.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=200==t,function jf(n,e,t,r,s,i,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+t+"\n"+i+" "+o})}(this.j,this.u,this.A,this.m,this.U,l,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Gr(a)){var c=a;break t}}c=null}if(!(t=c)){this.i=!1,this.o=3,_e(12),It(this),qn(this);break e}Ht(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Bi(this,t)}this.P?(Xu(this,l,o),pi&&this.i&&3==l&&(Uu(this.S,this.T,"tick",this.hb),this.T.start())):(Ht(this.j,this.m,o,null),Bi(this,o)),4==l&&It(this),this.i&&!this.I&&(4==l?bc(this.l,this):(this.i=!1,Pn(this)))}else 400==t&&0<o.indexOf("Unknown SID")?(this.o=3,_e(12)):(this.o=0,_e(13)),It(this),qn(this)}}}catch(l){}},b.hb=function(){if(this.g){var n=ze(this.g),e=this.g.fa();this.C<e.length&&(es(this),Xu(this,n,e),this.i&&4!=n&&Pn(this))}},b.cancel=function(){this.I=!0,It(this)},b.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function $f(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Mn(),_e(17)),It(this),this.o=2,qn(this)):Ju(this,this.V-n)};var tc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function xt(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof xt){this.h=void 0!==e?e:n.h,ts(this,n.j),this.s=n.s,this.g=n.g,ns(this,n.m),this.l=n.l,e=n.i;var t=new Gn;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),nc(this,t),this.o=n.o}else n&&(t=String(n).match(tc))?(this.h=!!e,ts(this,t[1]||"",!0),this.s=Un(t[2]||""),this.g=Un(t[3]||"",!0),ns(this,t[4]),this.l=Un(t[5]||"",!0),nc(this,t[6]||"",!0),this.o=Un(t[7]||"")):(this.h=!!e,this.i=new Gn(null,this.h))}function $e(n){return new xt(n)}function ts(n,e,t){n.j=t?Un(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ns(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function nc(n,e,t){e instanceof Gn?(n.i=e,function rm(n,e){e&&!n.j&&(et(n),n.i=null,n.g.forEach(function(t,r){var s=r.toLowerCase();r!=s&&(sc(this,r),oc(this,s,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Bn(e,tm)),n.i=new Gn(e,n.h))}function Q(n,e,t){n.i.set(e,t)}function rs(n){return Q(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Un(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Bn(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,Xf),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Xf(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}xt.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Bn(e,rc,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Bn(e,rc,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Bn(t,"/"==t.charAt(0)?em:Jf,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Bn(t,nm)),n.join("")};var rc=/[#\/\?@]/g,Jf=/[#\?:]/g,em=/[#\?]/g,tm=/[#\?@]/g,nm=/#/g;function Gn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function et(n){n.g||(n.g=new Map,n.h=0,n.i&&function Yf(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),s=null;if(0<=r){var i=n[t].substring(0,r);s=n[t].substring(r+1)}else i=n[t];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function sc(n,e){et(n),e=Yt(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function ic(n,e){return et(n),e=Yt(n,e),n.g.has(e)}function oc(n,e,t){sc(n,e),0<t.length&&(n.i=null,n.g.set(Yt(n,e),fi(t)),n.h+=t.length)}function Yt(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function ac(n){this.l=n||im,n=D.PerformanceNavigationTiming?0<(n=D.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(D.g&&D.g.Ga&&D.g.Ga()&&D.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(b=Gn.prototype).add=function(n,e){et(this),this.i=null,n=Yt(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},b.forEach=function(n,e){et(this),this.g.forEach(function(t,r){t.forEach(function(s){n.call(e,s,r,this)},this)},this)},b.oa=function(){et(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const s=n[r];for(let i=0;i<s.length;i++)t.push(e[r])}return t},b.W=function(n){et(this);let e=[];if("string"==typeof n)ic(this,n)&&(e=e.concat(this.g.get(Yt(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},b.set=function(n,e){return et(this),this.i=null,ic(this,n=Yt(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},b.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},b.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const i=encodeURIComponent(String(r)),o=this.W(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),n.push(s)}}return this.i=n.join("&")};var im=10;function uc(n){return!!n.h||!!n.g&&n.g.size>=n.j}function cc(n){return n.h?1:n.g?n.g.size:0}function Gi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Ki(n,e){n.g?n.g.add(e):n.h=e}function lc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function hc(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return fi(n.i)}function ji(){}function om(){this.g=new ji}function am(n,e,t){const r=t||"";try{ec(n,function(s,i){let o=s;Nn(s)&&(o=Ni(s)),e.push(r+i+"="+encodeURIComponent(o))})}catch(s){throw e.push(r+"type="+encodeURIComponent("_badmap")),s}}function ss(n,e,t,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(i){}}function Kn(n){this.l=n.ac||null,this.j=n.jb||!1}function is(n,e){ce.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=$i,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ac.prototype.cancel=function(){if(this.i=hc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},ji.prototype.stringify=function(n){return D.JSON.stringify(n,void 0)},ji.prototype.parse=function(n){return D.JSON.parse(n,void 0)},fe(Kn,Li),Kn.prototype.g=function(){return new is(this.l,this.j)},Kn.prototype.i=function(n){return function(){return n}}({}),fe(is,ce);var $i=0;function dc(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function jn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,$n(n)}function $n(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(b=is.prototype).open=function(n,e){if(this.readyState!=$i)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,$n(this)},b.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||D).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},b.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,jn(this)),this.readyState=$i},b.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,$n(this)),this.g&&(this.readyState=3,$n(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof D.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;dc(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},b.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?jn(this):$n(this),3==this.readyState&&dc(this)}},b.Va=function(n){this.g&&(this.response=this.responseText=n,jn(this))},b.Ua=function(n){this.g&&(this.response=n,jn(this))},b.ga=function(){this.g&&jn(this)},b.setRequestHeader=function(n,e){this.v.append(n,e)},b.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},b.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(is.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var cm=D.JSON.parse;function Y(n){ce.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=fc,this.K=this.L=!1}fe(Y,ce);var fc="",lm=/^https?$/i,hm=["POST","PUT"];function mc(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,gc(n),os(n)}function gc(n){n.D||(n.D=!0,me(n,"complete"),me(n,"error"))}function pc(n){if(n.h&&typeof hi<"u"&&(!n.C[1]||4!=ze(n)||2!=n.aa()))if(n.v&&4==ze(n))Mi(n.Ha,0,n);else if(me(n,"readystatechange"),4==ze(n)){n.h=!1;try{const a=n.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===a){var s=String(n.H).match(tc)[1]||null;if(!s&&D.self&&D.self.location){var i=D.self.location.protocol;s=i.substr(0,i.length-1)}r=!lm.test(s?s.toLowerCase():"")}t=r}if(t)me(n,"complete"),me(n,"success");else{n.m=6;try{var o=2<ze(n)?n.g.statusText:""}catch(u){o=""}n.j=o+" ["+n.aa()+"]",gc(n)}}finally{os(n)}}}function os(n,e){if(n.g){yc(n);const t=n.g,r=n.C[0]?qr:null;n.g=null,n.C=null,e||me(n,"ready");try{t.onreadystatechange=r}catch(s){}}}function yc(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(D.clearTimeout(n.A),n.A=null)}function ze(n){return n.g?n.g.readyState:0}function vc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case fc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function wc(n){let e="";return Ii(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function zi(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=wc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):Q(n,e,t))}function zn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function _c(n){this.Ca=0,this.i=[],this.j=new Wr,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=zn("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=zn("baseRetryDelayMs",5e3,n),this.bb=zn("retryDelaySeedMs",1e4,n),this.$a=zn("forwardChannelMaxRetries",2,n),this.ta=zn("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new ac(n&&n.concurrentRequestLimit),this.Fa=new om,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Qi(n){if(Ic(n),3==n.G){var e=n.U++,t=$e(n.F);Q(t,"SID",n.I),Q(t,"RID",e),Q(t,"TYPE","terminate"),Qn(n,t),(e=new Vn(n,n.j,e,void 0)).K=2,e.v=rs($e(t)),t=!1,D.navigator&&D.navigator.sendBeacon&&(t=D.navigator.sendBeacon(e.v.toString(),"")),!t&&D.Image&&((new Image).src=e.v,t=!0),t||(e.g=Nc(e.l,null),e.g.da(e.v)),e.F=Date.now(),Pn(e)}Ac(n)}function as(n){n.g&&(Wi(n),n.g.cancel(),n.g=null)}function Ic(n){as(n),n.u&&(D.clearTimeout(n.u),n.u=null),cs(n),n.h.cancel(),n.m&&("number"==typeof n.m&&D.clearTimeout(n.m),n.m=null)}function us(n){uc(n.h)||n.m||(n.m=!0,Ou(n.Ja,n),n.C=0)}function xc(n,e){var t;t=e?e.m:n.U++;const r=$e(n.F);Q(r,"SID",n.I),Q(r,"RID",t),Q(r,"AID",n.T),Qn(n,r),n.o&&n.s&&zi(r,n.o,n.s),t=new Vn(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=Tc(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Ki(n.h,t),Ui(t,r,e)}function Qn(n,e){n.ia&&Ii(n.ia,function(t,r){Q(e,r,t)}),n.l&&ec({},function(t,r){Q(e,r,t)})}function Tc(n,e,t){t=Math.min(n.i.length,t);var r=n.l?ve(n.l.Ra,n.l,n):null;e:{var s=n.i;let i=-1;for(;;){const o=["count="+t];-1==i?0<t?(i=s[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);let a=!0;for(let u=0;u<t;u++){let c=s[u].h;const l=s[u].g;if(c-=i,0>c)i=Math.max(0,s[u].h-100),a=!1;else try{am(l,o,"req"+c+"_")}catch(h){r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,r}function Ec(n){n.g||n.u||(n.Z=1,Ou(n.Ia,n),n.A=0)}function Zi(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=Ln(ve(n.Ia,n),Cc(n,n.A)),n.A++,0))}function Wi(n){null!=n.B&&(D.clearTimeout(n.B),n.B=null)}function Sc(n){n.g=new Vn(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=$e(n.sa);Q(e,"RID","rpc"),Q(e,"SID",n.I),Q(e,"CI",n.L?"0":"1"),Q(e,"AID",n.T),Q(e,"TYPE","xmlhttp"),Qn(n,e),n.o&&n.s&&zi(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=rs($e(e)),t.s=null,t.P=!0,Hu(t,n)}function cs(n){null!=n.v&&(D.clearTimeout(n.v),n.v=null)}function bc(n,e){var t=null;if(n.g==e){cs(n),Wi(n),n.g=null;var r=2}else{if(!Gi(n.h,e))return;t=e.D,lc(n.h,e),r=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;me(r=Hr(),new $u(r,t)),us(n)}else Ec(n);else if(3==(s=e.o)||0==s&&0<n.pa||!(1==r&&function fm(n,e){return!(cc(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=Ln(ve(n.Ja,n,e),Cc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Zi(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),s){case 1:Tt(n,5);break;case 4:Tt(n,10);break;case 3:Tt(n,6);break;default:Tt(n,2)}}function Cc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function Tt(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var r=ve(n.kb,n);t||(t=new xt("//www.google.com/images/cleardot.gif"),D.location&&"http"==D.location.protocol||ts(t,"https"),rs(t)),function um(n,e){const t=new Wr;if(D.Image){const r=new Image;r.onload=Br(ss,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Br(ss,t,r,"TestLoadImage: error",!1,e),r.onabort=Br(ss,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Br(ss,t,r,"TestLoadImage: timeout",!1,e),D.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else _e(2);n.G=0,n.l&&n.l.va(e),Ac(n),Ic(n)}function Ac(n){if(n.G=0,n.la=[],n.l){const e=hc(n.h);(0!=e.length||0!=n.i.length)&&(Iu(n.la,e),Iu(n.la,n.i),n.h.i.length=0,fi(n.i),n.i.length=0),n.l.ua()}}function Dc(n,e,t){var r=t instanceof xt?$e(t):new xt(t,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),ns(r,r.m);else{var s=D.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new xt(null,void 0);r&&ts(i,r),e&&(i.g=e),s&&ns(i,s),t&&(i.l=t),r=i}return e=n.za,(t=n.D)&&e&&Q(r,t,e),Q(r,"VER",n.ma),Qn(n,r),r}function Nc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Y(t&&n.Da&&!n.ra?new Kn({jb:!0}):n.ra)).Ka(n.H),e}function kc(){}function ls(){if(Wt&&!(10<=Number(Nf)))throw Error("Environmental error: no available transport.")}function De(n,e){ce.call(this),this.g=new _c(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!Gr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Gr(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Xt(this)}function Rc(n){Oi.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Fc(){Vi.call(this),this.status=1}function Xt(n){this.g=n}(b=Y.prototype).Ka=function(n){this.L=n},b.da=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Pi.g(),this.C=function Qu(n){return n.h||(n.h=n.i())}(this.u?this.u:Pi),this.g.onreadystatechange=ve(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(i){return void mc(this,i)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)t.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const i of r.keys())t.set(i,r.get(i))}r=Array.from(t.keys()).find(i=>"content-type"==i.toLowerCase()),s=D.FormData&&n instanceof D.FormData,!(0<=_u(hm,e))||r||s||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of t)this.g.setRequestHeader(i,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{yc(this),0<this.B&&((this.K=function dm(n){return Wt&&function Df(){return function Sf(n){var e=Af;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=xu(String(jr)).split("."),t=xu("9").split("."),r=Math.max(e.length,t.length);for(let o=0;0==n&&o<r;o++){var s=e[o]||"",i=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==s[0].length&&0==i[0].length)break;n=mi(0==s[1].length?0:parseInt(s[1],10),0==i[1].length?0:parseInt(i[1],10))||mi(0==s[2].length,0==i[2].length)||mi(s[2],i[2]),s=s[3],i=i[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ve(this.qa,this)):this.A=Mi(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(i){mc(this,i)}},b.qa=function(){typeof hi<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,me(this,"timeout"),this.abort(8))},b.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,me(this,"complete"),me(this,"abort"),os(this))},b.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),os(this,!0)),Y.X.M.call(this)},b.Ha=function(){this.s||(this.F||this.v||this.l?pc(this):this.fb())},b.fb=function(){pc(this)},b.aa=function(){try{return 2<ze(this)?this.g.status:-1}catch(n){return-1}},b.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},b.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),cm(e)}},b.Ea=function(){return this.m},b.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(b=_c.prototype).ma=8,b.G=1,b.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const s=new Vn(this,this.j,n,void 0);let i=this.s;if(this.S&&(i?(i=Cu(i),Du(i,this.S)):i=this.S),null!==this.o||this.N||(s.H=i,i=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var r=this.i[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Tc(this,s,e),Q(t=$e(this.F),"RID",n),Q(t,"CVER",22),this.D&&Q(t,"X-HTTP-Session-Id",this.D),Qn(this,t),i&&(this.N?e="headers="+encodeURIComponent(String(wc(i)))+"&"+e:this.o&&zi(t,this.o,i)),Ki(this.h,s),this.Ya&&Q(t,"TYPE","init"),this.O?(Q(t,"$req",e),Q(t,"SID","null"),s.Z=!0,Ui(s,t,null)):Ui(s,t,e),this.G=2}}else 3==this.G&&(n?xc(this,n):0==this.i.length||uc(this.h)||xc(this))},b.Ia=function(){if(this.u=null,Sc(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Ln(ve(this.eb,this),n)}},b.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,_e(10),as(this),Sc(this))},b.cb=function(){null!=this.v&&(this.v=null,as(this),Zi(this),_e(19))},b.kb=function(n){n?(this.j.info("Successfully pinged google.com"),_e(2)):(this.j.info("Failed to ping google.com"),_e(1))},(b=kc.prototype).xa=function(){},b.wa=function(){},b.va=function(){},b.ua=function(){},b.Ra=function(){},ls.prototype.g=function(n,e){return new De(n,e)},fe(De,ce),De.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;_e(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=Dc(n,null,n.V),us(n)},De.prototype.close=function(){Qi(this.g)},De.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Ni(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&us(e)},De.prototype.M=function(){this.g.l=null,delete this.j,Qi(this.g),delete this.g,De.X.M.call(this)},fe(Rc,Oi),fe(Fc,Vi),fe(Xt,kc),Xt.prototype.xa=function(){me(this.g,"a")},Xt.prototype.wa=function(n){me(this.g,new Rc(n))},Xt.prototype.va=function(n){me(this.g,new Fc)},Xt.prototype.ua=function(){me(this.g,"b")},ls.prototype.createWebChannel=ls.prototype.g,De.prototype.send=De.prototype.u,De.prototype.open=De.prototype.m,De.prototype.close=De.prototype.close,Yr.NO_ERROR=0,Yr.TIMEOUT=8,Yr.HTTP_ERROR=6,zu.COMPLETE="complete",Zu.EventType=On,On.OPEN="a",On.CLOSE="b",On.ERROR="c",On.MESSAGE="d",ce.prototype.listen=ce.prototype.N,Y.prototype.listenOnce=Y.prototype.O,Y.prototype.getLastError=Y.prototype.Oa,Y.prototype.getLastErrorCode=Y.prototype.Ea,Y.prototype.getStatus=Y.prototype.aa,Y.prototype.getResponseJson=Y.prototype.Sa,Y.prototype.getResponseText=Y.prototype.fa,Y.prototype.send=Y.prototype.da,Y.prototype.setWithCredentials=Y.prototype.Ka;var mm=je.createWebChannelTransport=function(){return new ls},gm=je.getStatEventTarget=function(){return Hr()},Hi=je.ErrorCode=Yr,pm=je.EventType=zu,ym=je.Event=_t,Mc=je.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},vm=je.FetchXmlHttpFactory=Kn,hs=je.WebChannel=Zu,wm=je.XhrIo=Y;const Lc="@firebase/firestore";class le{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}le.UNAUTHENTICATED=new le(null),le.GOOGLE_CREDENTIALS=new le("google-credentials-uid"),le.FIRST_PARTY=new le("first-party-uid"),le.MOCK_USER=new le("mock-user");let Jt="9.16.0";const tt=new wt.Yd("@firebase/firestore");function Yi(){return tt.logLevel}function w(n,...e){if(tt.logLevel<=wt.in.DEBUG){const t=e.map(Xi);tt.debug(`Firestore (${Jt}): ${n}`,...t)}}function ne(n,...e){if(tt.logLevel<=wt.in.ERROR){const t=e.map(Xi);tt.error(`Firestore (${Jt}): ${n}`,...t)}}function Et(n,...e){if(tt.logLevel<=wt.in.WARN){const t=e.map(Xi);tt.warn(`Firestore (${Jt}): ${n}`,...t)}}function Xi(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function E(n="Unexpected state"){const e=`FIRESTORE (${Jt}) INTERNAL ASSERTION FAILED: `+n;throw ne(e),new Error(e)}function S(n,e){n||E()}function x(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends K.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class oe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Oc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class xm{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(le.UNAUTHENTICATED))}shutdown(){}}class Tm{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Em{constructor(e){this.t=e,this.currentUser=le.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let s=this.i;const i=c=>this.i!==s?(s=this.i,t(c)):Promise.resolve();let o=new oe;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new oe,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const c=o;e.enqueueRetryable((0,p.Z)(function*(){yield c.promise,yield i(r.currentUser)}))},u=c=>{w("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?u(c):(w("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new oe)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(w("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(S("string"==typeof r.accessToken),new Oc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return S(null===e||"string"==typeof e),new le(e)}}class Sm{constructor(e,t,r,s){this.h=e,this.l=t,this.m=r,this.g=s,this.type="FirstParty",this.user=le.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(S(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class bm{constructor(e,t,r,s){this.h=e,this.l=t,this.m=r,this.g=s}getToken(){return Promise.resolve(new Sm(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(le.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Vc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Cm{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=i=>{null!=i.error&&w("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.A;return this.A=i.token,w("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{w("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.appCheck.addTokenListener(this.o)};this.T.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.T.getImmediate({optional:!0});i?s(i):w("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(S("string"==typeof t.token),this.A=t.token,new Vc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Am(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Pc{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const s=Am(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%e.length))}return r}}function N(n,e){return n<e?-1:n>e?1:0}function en(n,e,t){return n.length===e.length&&n.every((r,s)=>t(r,e[s]))}function qc(n){return n+"\0"}class Z{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Z.fromMillis(Date.now())}static fromDate(e){return Z.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Z(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?N(this.nanoseconds,e.nanoseconds):N(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class A{constructor(e){this.timestamp=e}static fromTimestamp(e){return new A(e)}static min(){return new A(new Z(0,0))}static max(){return new A(new Z(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Zn{constructor(e,t,r){void 0===t?t=0:t>e.length&&E(),void 0===r?r=e.length-t:r>e.length-t&&E(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Zn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Zn?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=e.get(s),o=t.get(s);if(i<o)return-1;if(i>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class M extends Zn{construct(e,t,r){return new M(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(s=>s.length>0))}return new M(t)}static emptyPath(){return new M([])}}const Dm=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class X extends Zn{construct(e,t,r){return new X(e,t,r)}static isValidIdentifier(e){return Dm.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),X.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new X(["__name__"])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(0===r.length)throw new y(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if("\\"===a){if(s+1===e.length)throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else"`"===a?(o=!o,s++):"."!==a||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new X(t)}static emptyPath(){return new X([])}}class I{constructor(e){this.path=e}static fromPath(e){return new I(M.fromString(e))}static fromName(e){return new I(M.fromString(e).popFirst(5))}static empty(){return new I(M.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===M.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return M.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new I(new M(e.slice()))}}class ds{constructor(e,t,r,s){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=s}}function Ji(n){return n.fields.find(e=>2===e.kind)}function St(n){return n.fields.filter(e=>2!==e.kind)}ds.UNKNOWN_ID=-1;class fs{constructor(e,t){this.fieldPath=e,this.kind=t}}class Wn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Wn(0,Ne.min())}}function Uc(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=A.fromTimestamp(1e9===r?new Z(t+1,0):new Z(t,r));return new Ne(s,I.empty(),e)}function Bc(n){return new Ne(n.readTime,n.key,-1)}class Ne{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Ne(A.min(),I.empty(),-1)}static max(){return new Ne(A.max(),I.empty(),-1)}}function eo(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=I.comparator(n.documentKey,e.documentKey),0!==t?t:N(n.largestBatchId,e.largestBatchId))}const Gc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Kc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function nt(n){return to.apply(this,arguments)}function to(){return to=(0,p.Z)(function*(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==Gc)throw n;w("LocalStore","Unexpectedly lost primary lease")}),to.apply(this,arguments)}class f{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&E(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new f((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof f?t:f.resolve(t)}catch(t){return f.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):f.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):f.reject(t)}static resolve(e){return new f((t,r)=>{t(e)})}static reject(e){return new f((t,r)=>{r(e)})}static waitFor(e){return new f((t,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&t()},u=>r(u))}),o=!0,i===s&&t()})}static or(e){let t=f.resolve(!1);for(const r of e)t=t.next(s=>s?f.resolve(s):r());return t}static forEach(e,t){const r=[];return e.forEach((s,i)=>{r.push(t.call(this,s,i))}),this.waitFor(r)}static mapArray(e,t){return new f((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let u=0;u<i;u++){const c=u;t(e[c]).next(l=>{o[c]=l,++a,a===i&&r(o)},l=>s(l))}})}static doWhile(e,t){return new f((r,s)=>{const i=()=>{!0===e()?t().next(()=>{i()},s):r()};i()})}}class ms{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new oe,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Hn(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const s=no(r.target.error);this.P.reject(new Hn(e,s))}}static open(e,t,r,s){try{return new ms(t,e.transaction(s,r))}catch(i){throw new Hn(t,i)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(w("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Fm(t)}}class Me{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===Me.D((0,K.z$)())&&ne("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return w("SimpleDb","Removing database:",e),bt(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,K.hl)())return!1;if(Me.N())return!0;const e=(0,K.z$)(),t=Me.D(e),r=0<t&&t<10,s=Me.k(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static N(){var e;return typeof process<"u"&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}F(e){var t=this;return(0,p.Z)(function*(){return t.db||(w("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,s)=>{const i=indexedDB.open(t.name,t.version);i.onsuccess=o=>{r(o.target.result)},i.onblocked=()=>{s(new Hn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=o=>{const a=o.target.error;s("VersionError"===a.name?new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===a.name?new y(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a):new Hn(e,a))},i.onupgradeneeded=o=>{w("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',o.oldVersion),t.S.$(o.target.result,i.transaction,o.oldVersion,t.version).next(()=>{w("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,s){var i=this;return(0,p.Z)(function*(){const o="readonly"===t;let a=0;for(;;){++a;try{i.db=yield i.F(e);const u=ms.open(i.db,e,o?"readonly":"readwrite",r),c=s(u).next(l=>(u.V(),l)).catch(l=>(u.abort(l),f.reject(l))).toPromise();return c.catch(()=>{}),yield u.v,c}catch(u){const c=u,l="FirebaseError"!==c.name&&a<3;if(w("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),i.close(),!l)return Promise.reject(c)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Rm{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return bt(this.q.delete())}}class Hn extends y{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function rt(n){return"IndexedDbTransactionError"===n.name}class Fm{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(w("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(w("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),bt(r)}add(e){return w("SimpleDb","ADD",this.store.name,e,e),bt(this.store.add(e))}get(e){return bt(this.store.get(e)).next(t=>(void 0===t&&(t=null),w("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return w("SimpleDb","DELETE",this.store.name,e),bt(this.store.delete(e))}count(){return w("SimpleDb","COUNT",this.store.name),bt(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const s=this.cursor(r),i=[];return this.H(s,(o,a)=>{i.push(a)}).next(()=>i)}{const s=this.store.getAll(r.range);return new f((i,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{i(a.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new f((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Y(e,t){w("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const s=this.cursor(r);return this.H(s,t)}tt(e){const t=this.cursor({});return new f((r,s)=>{t.onerror=i=>{const o=no(i.target.error);s(o)},t.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,t){const r=[];return new f((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const u=new Rm(a),c=t(a.primaryKey,a.value,u);if(c instanceof f){const l=c.catch(h=>(u.done(),f.reject(h)));r.push(l)}u.isDone?s():null===u.G?a.continue():a.continue(u.G)}}).next(()=>f.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function bt(n){return new f((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const s=no(r.target.error);t(s)}})}let jc=!1;function no(n){const e=Me.D((0,K.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return jc||(jc=!0,setTimeout(()=>{throw r},0)),r}}return n}class Mm{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;w("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,p.Z)(function*(){t.task=null;try{w("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(r){rt(r)?w("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield nt(r)}yield t.nt(6e4)}))}}class Lm{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,p.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.it(r,e))})()}it(e,t){const r=new Set;let s=t,i=!0;return f.doWhile(()=>!0===i&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(null!==o&&!r.has(o))return w("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>t-s)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(s,i)).next(a=>(w("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ot(e,t){let r=e;return t.changes.forEach((s,i)=>{const o=Bc(i);eo(o,r)>0&&(r=o)}),new Ne(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let ke=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=s=>this.ut(s),this.ct=s=>r.writeSequenceNumber(s))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class Om{constructor(e,t,r,s,i,o,a,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=u}}class st{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new st("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof st&&e.projectId===this.projectId&&e.database===this.database}}function $c(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ct(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function zc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Yn(n){return null==n}function Xn(n){return 0===n&&1/n==-1/0}function Qc(n){return"number"==typeof n&&Number.isInteger(n)&&!Xn(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class ae{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ae(t)}static fromUint8Array(e){const t=function(r){let s="";for(let i=0;i<r.length;++i)s+=String.fromCharCode(r[i]);return s}(e);return new ae(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return N(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ae.EMPTY_BYTE_STRING=new ae("");const Pm=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function it(n){if(S(!!n),"string"==typeof n){let e=0;const t=Pm.exec(n);if(S(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:J(n.seconds),nanos:J(n.nanos)}}function J(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function At(n){return"string"==typeof n?ae.fromBase64String(n):ae.fromUint8Array(n)}function ro(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Zc(n){const e=n.mapValue.fields.__previous_value__;return ro(e)?Zc(e):e}function Jn(n){const e=it(n.mapValue.fields.__local_write_time__.timestampValue);return new Z(e.seconds,e.nanos)}const ot={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},gs={nullValue:"NULL_VALUE"};function Dt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ro(n)?4:Xc(n)?9007199254740991:10:E()}function Ve(n,e){if(n===e)return!0;const t=Dt(n);if(t!==Dt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Jn(n).isEqual(Jn(e));case 3:return function(r,s){if("string"==typeof r.timestampValue&&"string"==typeof s.timestampValue&&r.timestampValue.length===s.timestampValue.length)return r.timestampValue===s.timestampValue;const i=it(r.timestampValue),o=it(s.timestampValue);return i.seconds===o.seconds&&i.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return s=e,At(n.bytesValue).isEqual(At(s.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,s){return J(r.geoPointValue.latitude)===J(s.geoPointValue.latitude)&&J(r.geoPointValue.longitude)===J(s.geoPointValue.longitude)}(n,e);case 2:return function(r,s){if("integerValue"in r&&"integerValue"in s)return J(r.integerValue)===J(s.integerValue);if("doubleValue"in r&&"doubleValue"in s){const i=J(r.doubleValue),o=J(s.doubleValue);return i===o?Xn(i)===Xn(o):isNaN(i)&&isNaN(o)}return!1}(n,e);case 9:return en(n.arrayValue.values||[],e.arrayValue.values||[],Ve);case 10:return function(r,s){const i=r.mapValue.fields||{},o=s.mapValue.fields||{};if($c(i)!==$c(o))return!1;for(const a in i)if(i.hasOwnProperty(a)&&(void 0===o[a]||!Ve(i[a],o[a])))return!1;return!0}(n,e);default:return E()}var s}function er(n,e){return void 0!==(n.values||[]).find(t=>Ve(t,e))}function at(n,e){if(n===e)return 0;const t=Dt(n),r=Dt(e);if(t!==r)return N(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return N(n.booleanValue,e.booleanValue);case 2:return function(s,i){const o=J(s.integerValue||s.doubleValue),a=J(i.integerValue||i.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return Wc(n.timestampValue,e.timestampValue);case 4:return Wc(Jn(n),Jn(e));case 5:return N(n.stringValue,e.stringValue);case 6:return function(s,i){const o=At(s),a=At(i);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,i){const o=s.split("/"),a=i.split("/");for(let u=0;u<o.length&&u<a.length;u++){const c=N(o[u],a[u]);if(0!==c)return c}return N(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,i){const o=N(J(s.latitude),J(i.latitude));return 0!==o?o:N(J(s.longitude),J(i.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,i){const o=s.values||[],a=i.values||[];for(let u=0;u<o.length&&u<a.length;++u){const c=at(o[u],a[u]);if(c)return c}return N(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,i){if(s===ot.mapValue&&i===ot.mapValue)return 0;if(s===ot.mapValue)return 1;if(i===ot.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),u=i.fields||{},c=Object.keys(u);a.sort(),c.sort();for(let l=0;l<a.length&&l<c.length;++l){const h=N(a[l],c[l]);if(0!==h)return h;const d=at(o[a[l]],u[c[l]]);if(0!==d)return d}return N(a.length,c.length)}(n.mapValue,e.mapValue);default:throw E()}}function Wc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return N(n,e);const t=it(n),r=it(e),s=N(t.seconds,r.seconds);return 0!==s?s:N(t.nanos,r.nanos)}function tn(n){return so(n)}function so(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const s=it(r);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?At(n.bytesValue).toBase64():"referenceValue"in n?I.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let s="[",i=!0;for(const o of r.values||[])i?i=!1:s+=",",s+=so(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(r){const s=Object.keys(r.fields||{}).sort();let i="{",o=!0;for(const a of s)o?o=!1:i+=",",i+=`${a}:${so(r.fields[a])}`;return i+"}"}(n.mapValue):E();var e}function Nt(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function io(n){return!!n&&"integerValue"in n}function tr(n){return!!n&&"arrayValue"in n}function Hc(n){return!!n&&"nullValue"in n}function Yc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function ps(n){return!!n&&"mapValue"in n}function nr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ct(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=nr(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=nr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Xc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function qm(n){return"nullValue"in n?gs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Nt(st.empty(),I.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:E()}function Um(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Nt(st.empty(),I.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?ot:E()}function Jc(n,e){const t=at(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function el(n,e){const t=at(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class ut{constructor(e,t){this.position=e,this.inclusive=t}}function tl(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],o=n.position[s];if(r=i.field.isKeyField()?I.comparator(I.fromName(o.referenceValue),t.key):at(o,t.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function nl(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Ve(n.position[t],e.position[t]))return!1;return!0}class rl{}class R extends rl{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Bm(e,t,r):"array-contains"===t?new jm(e,r):"in"===t?new cl(e,r):"not-in"===t?new $m(e,r):"array-contains-any"===t?new zm(e,r):new R(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Gm(e,r):new Km(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(at(t,this.value)):null!==t&&Dt(this.value)===Dt(t)&&this.matchesComparison(at(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return E()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class U extends rl{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new U(e,t)}matches(e){return nn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function nn(n){return"and"===n.op}function oo(n){return"or"===n.op}function ao(n){return sl(n)&&nn(n)}function sl(n){for(const e of n.filters)if(e instanceof U)return!1;return!0}function uo(n){if(n instanceof R)return n.field.canonicalString()+n.op.toString()+tn(n.value);if(ao(n))return n.filters.map(e=>uo(e)).join(",");{const e=n.filters.map(t=>uo(t)).join(",");return`${n.op}(${e})`}}function il(n,e){return n instanceof R?(t=n,(r=e)instanceof R&&t.op===r.op&&t.field.isEqual(r.field)&&Ve(t.value,r.value)):n instanceof U?function(t,r){return r instanceof U&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((s,i,o)=>s&&il(i,r.filters[o]),!0)}(n,e):void E();var t,r}function ol(n,e){const t=n.filters.concat(e);return U.create(t,n.op)}function al(n){return n instanceof R?`${(e=n).field.canonicalString()} ${e.op} ${tn(e.value)}`:n instanceof U?function(e){return e.op.toString()+" {"+e.getFilters().map(al).join(" ,")+"}"}(n):"Filter";var e}class Bm extends R{constructor(e,t,r){super(e,t,r),this.key=I.fromName(r.referenceValue)}matches(e){const t=I.comparator(e.key,this.key);return this.matchesComparison(t)}}class Gm extends R{constructor(e,t){super(e,"in",t),this.keys=ul(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Km extends R{constructor(e,t){super(e,"not-in",t),this.keys=ul(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ul(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>I.fromName(r.referenceValue))}class jm extends R{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return tr(t)&&er(t.arrayValue,this.value)}}class cl extends R{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&er(this.value.arrayValue,t)}}class $m extends R{constructor(e,t){super(e,"not-in",t)}matches(e){if(er(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!er(this.value.arrayValue,t)}}class zm extends R{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!tr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>er(this.value.arrayValue,r))}}class rn{constructor(e,t="asc"){this.field=e,this.dir=t}}function Qm(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ee{constructor(e,t){this.comparator=e,this.root=t||ge.EMPTY}insert(e,t){return new ee(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ge.BLACK,null,null))}remove(e){return new ee(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ge.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(0===s)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ys(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ys(this.root,e,this.comparator,!1)}getReverseIterator(){return new ys(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ys(this.root,e,this.comparator,!0)}}class ys{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ge{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=null!=r?r:ge.RED,this.left=null!=s?s:ge.EMPTY,this.right=null!=i?i:ge.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new ge(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=s?s:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):0===i?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ge.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===t(e,s.key)){if(s.right.isEmpty())return ge.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ge.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ge.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw E();const e=this.left.check();if(e!==this.right.check())throw E();return e+(this.isRed()?0:1)}}ge.EMPTY=null,ge.RED=!0,ge.BLACK=!1,ge.EMPTY=new class{constructor(){this.size=0}get key(){throw E()}get value(){throw E()}get color(){throw E()}get left(){throw E()}get right(){throw E()}copy(n,e,t,r,s){return this}insert(n,e,t){return new ge(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class B{constructor(e){this.comparator=e,this.data=new ee(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ll(this.data.getIterator())}getIteratorFrom(e){return new ll(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof B)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(0!==this.comparator(s,i))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new B(this.comparator);return t.data=e,t}}class ll{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sn(n){return n.hasNext()?n.getNext():void 0}class Se{constructor(e){this.fields=e,e.sort(X.comparator)}static empty(){return new Se([])}unionWith(e){let t=new B(X.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Se(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return en(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class pe{constructor(e){this.value=e}static empty(){return new pe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!ps(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nr(t)}setAll(e){let t=X.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=a.popLast()}o?r[a.lastSegment()]=nr(o):s.push(a.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());ps(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Ve(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];ps(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){Ct(t,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new pe(nr(this.value))}}function hl(n){const e=[];return Ct(n.fields,(t,r)=>{const s=new X([t]);if(ps(r)){const i=hl(r.mapValue).fields;if(0===i.length)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Se(e)}class j{constructor(e,t,r,s,i,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new j(e,0,A.min(),A.min(),A.min(),pe.empty(),0)}static newFoundDocument(e,t,r,s){return new j(e,1,t,A.min(),r,s,0)}static newNoDocument(e,t){return new j(e,2,t,A.min(),A.min(),pe.empty(),0)}static newUnknownDocument(e,t){return new j(e,3,t,A.min(),A.min(),pe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(A.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=pe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=pe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=A.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof j&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new j(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Zm{constructor(e,t=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.ft=null}}function co(n,e=null,t=[],r=[],s=null,i=null,o=null){return new Zm(n,e,t,r,s,i,o)}function kt(n){const e=x(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>uo(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(s=r).field.canonicalString()+s.dir;var s}).join(","),Yn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>tn(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>tn(r)).join(",")),e.ft=t}return e.ft}function rr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Qm(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!il(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!nl(n.startAt,e.startAt)&&nl(n.endAt,e.endAt)}function vs(n){return I.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function ws(n,e){return n.filters.filter(t=>t instanceof R&&t.field.isEqual(e))}function dl(n,e,t){let r=gs,s=!0;for(const i of ws(n,e)){let o=gs,a=!0;switch(i.op){case"<":case"<=":o=qm(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=gs}Jc({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];Jc({value:r,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}function fl(n,e,t){let r=ot,s=!0;for(const i of ws(n,e)){let o=ot,a=!0;switch(i.op){case">=":case">":o=Um(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=ot}el({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(null!==t)for(let i=0;i<n.orderBy.length;++i)if(n.orderBy[i].field.isEqual(e)){const o=t.position[i];el({value:r,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(r=o,s=t.inclusive);break}return{value:r,inclusive:s}}class Qe{constructor(e,t=null,r=[],s=[],i=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=u,this.dt=null,this._t=null}}function ml(n,e,t,r,s,i,o,a){return new Qe(n,e,t,r,s,i,o,a)}function on(n){return new Qe(n)}function gl(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function lo(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function _s(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function ho(n){return null!==n.collectionGroup}function Rt(n){const e=x(n);if(null===e.dt){e.dt=[];const t=_s(e),r=lo(e);if(null!==t&&null===r)t.isKeyField()||e.dt.push(new rn(t)),e.dt.push(new rn(X.keyField(),"asc"));else{let s=!1;for(const i of e.explicitOrderBy)e.dt.push(i),i.field.isKeyField()&&(s=!0);if(!s){const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new rn(X.keyField(),i))}}}return e.dt}function Ie(n){const e=x(n);if(!e._t)if("F"===e.limitType)e._t=co(e.path,e.collectionGroup,Rt(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of Rt(e))t.push(new rn(i.field,"desc"===i.dir?"asc":"desc"));const r=e.endAt?new ut(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new ut(e.startAt.position,e.startAt.inclusive):null;e._t=co(e.path,e.collectionGroup,t,e.filters,e.limit,r,s)}return e._t}function fo(n,e){e.getFirstInequalityField(),_s(n);const t=n.filters.concat([e]);return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Is(n,e,t){return new Qe(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function sr(n,e){return rr(Ie(n),Ie(e))&&n.limitType===e.limitType}function pl(n){return`${kt(Ie(n))}|lt:${n.limitType}`}function mo(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>al(r)).join(", ")}]`),Yn(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(s=r).field.canonicalString()} (${s.dir})`;var s}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>tn(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>tn(r)).join(",")),`Target(${t})`}(Ie(n))}; limitType=${n.limitType})`}function go(n,e){return e.isFoundDocument()&&function(t,r){const s=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):I.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,r){for(const s of Rt(t))if(!s.field.isKeyField()&&null===r.data.field(s.field))return!1;return!0}(n,e)&&function(t,r){for(const s of t.filters)if(!s.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(s,i,o){const a=tl(s,i,o);return s.inclusive?a<=0:a<0}(t.startAt,Rt(t),r)||t.endAt&&!function(s,i,o){const a=tl(s,i,o);return s.inclusive?a>=0:a>0}(t.endAt,Rt(t),r)));var t,r}function yl(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function vl(n){return(e,t)=>{let r=!1;for(const s of Rt(n)){const i=Wm(s,e,t);if(0!==i)return i;r=r||s.field.isKeyField()}return 0}}function Wm(n,e,t){const r=n.field.isKeyField()?I.comparator(e.key,t.key):function(s,i,o){const a=i.data.field(s),u=o.data.field(s);return null!==a&&null!==u?at(a,u):E()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return E()}}function wl(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Xn(e)?"-0":e}}function _l(n){return{integerValue:""+n}}function Il(n,e){return Qc(e)?_l(e):wl(n,e)}class xs{constructor(){this._=void 0}}function Hm(n,e,t){return n instanceof an?function(r,s){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return s&&(i.fields.__previous_value__=s),{mapValue:i}}(t,e):n instanceof Ft?Tl(n,e):n instanceof Mt?El(n,e):function(r,s){const i=xl(r,s),o=Sl(i)+Sl(r.gt);return io(i)&&io(r.gt)?_l(o):wl(r.yt,o)}(n,e)}function Ym(n,e,t){return n instanceof Ft?Tl(n,e):n instanceof Mt?El(n,e):t}function xl(n,e){return n instanceof un?io(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class an extends xs{}class Ft extends xs{constructor(e){super(),this.elements=e}}function Tl(n,e){const t=bl(e);for(const r of n.elements)t.some(s=>Ve(s,r))||t.push(r);return{arrayValue:{values:t}}}class Mt extends xs{constructor(e){super(),this.elements=e}}function El(n,e){let t=bl(e);for(const r of n.elements)t=t.filter(s=>!Ve(s,r));return{arrayValue:{values:t}}}class un extends xs{constructor(e,t){super(),this.yt=e,this.gt=t}}function Sl(n){return J(n.integerValue||n.doubleValue)}function bl(n){return tr(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class ir{constructor(e,t){this.field=e,this.transform=t}}class Jm{constructor(e,t){this.version=e,this.transformResults=t}}class W{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new W}static exists(e){return new W(void 0,e)}static updateTime(e){return new W(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ts(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Es{}function Cl(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new ln(n.key,W.none()):new cn(n.key,n.data,W.none());{const t=n.data,r=pe.empty();let s=new B(X.comparator);for(let i of e.fields)if(!s.has(i)){let o=t.field(i);null===o&&i.length>1&&(i=i.popLast(),o=t.field(i)),null===o?r.delete(i):r.set(i,o),s=s.add(i)}return new Ze(n.key,r,new Se(s.toArray()),W.none())}}function eg(n,e,t){n instanceof cn?function(r,s,i){const o=r.value.clone(),a=Nl(r.fieldTransforms,s,i.transformResults);o.setAll(a),s.convertToFoundDocument(i.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Ze?function(r,s,i){if(!Ts(r.precondition,s))return void s.convertToUnknownDocument(i.version);const o=Nl(r.fieldTransforms,s,i.transformResults),a=s.data;a.setAll(Dl(r)),a.setAll(o),s.convertToFoundDocument(i.version,a).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function or(n,e,t,r){return n instanceof cn?function(s,i,o,a){if(!Ts(s.precondition,i))return o;const u=s.value.clone(),c=kl(s.fieldTransforms,a,i);return u.setAll(c),i.convertToFoundDocument(i.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ze?function(s,i,o,a){if(!Ts(s.precondition,i))return o;const u=kl(s.fieldTransforms,a,i),c=i.data;return c.setAll(Dl(s)),c.setAll(u),i.convertToFoundDocument(i.version,c).setHasLocalMutations(),null===o?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(l=>l.field))}(n,e,t,r):(o=t,Ts(n.precondition,i=e)?(i.convertToNoDocument(i.version).setHasLocalMutations(),null):o);var i,o}function tg(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=xl(r.transform,s||null);null!=i&&(null===t&&(t=pe.empty()),t.set(r.field,i))}return t||null}function Al(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&en(t,r,(s,i)=>function Xm(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof Ft&&r instanceof Ft||t instanceof Mt&&r instanceof Mt?en(t.elements,r.elements,Ve):t instanceof un&&r instanceof un?Ve(t.gt,r.gt):t instanceof an&&r instanceof an);var t,r}(s,i))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class cn extends Es{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ze extends Es{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Dl(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function Nl(n,e,t){const r=new Map;S(n.length===t.length);for(let s=0;s<t.length;s++){const i=n[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,Ym(o,a,t[s]))}return r}function kl(n,e,t){const r=new Map;for(const s of n){const i=s.transform,o=t.data.field(s.field);r.set(s.field,Hm(i,o,e))}return r}class ln extends Es{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class po extends Es{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ng{constructor(e){this.count=e}}var ie,L;function Rl(n){switch(n){default:return E();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function Fl(n){if(void 0===n)return ne("GRPC error has no .code"),m.UNKNOWN;switch(n){case ie.OK:return m.OK;case ie.CANCELLED:return m.CANCELLED;case ie.UNKNOWN:return m.UNKNOWN;case ie.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case ie.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case ie.INTERNAL:return m.INTERNAL;case ie.UNAVAILABLE:return m.UNAVAILABLE;case ie.UNAUTHENTICATED:return m.UNAUTHENTICATED;case ie.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case ie.NOT_FOUND:return m.NOT_FOUND;case ie.ALREADY_EXISTS:return m.ALREADY_EXISTS;case ie.PERMISSION_DENIED:return m.PERMISSION_DENIED;case ie.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case ie.ABORTED:return m.ABORTED;case ie.OUT_OF_RANGE:return m.OUT_OF_RANGE;case ie.UNIMPLEMENTED:return m.UNIMPLEMENTED;case ie.DATA_LOSS:return m.DATA_LOSS;default:return E()}}(L=ie||(ie={}))[L.OK=0]="OK",L[L.CANCELLED=1]="CANCELLED",L[L.UNKNOWN=2]="UNKNOWN",L[L.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",L[L.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",L[L.NOT_FOUND=5]="NOT_FOUND",L[L.ALREADY_EXISTS=6]="ALREADY_EXISTS",L[L.PERMISSION_DENIED=7]="PERMISSION_DENIED",L[L.UNAUTHENTICATED=16]="UNAUTHENTICATED",L[L.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",L[L.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",L[L.ABORTED=10]="ABORTED",L[L.OUT_OF_RANGE=11]="OUT_OF_RANGE",L[L.UNIMPLEMENTED=12]="UNIMPLEMENTED",L[L.INTERNAL=13]="INTERNAL",L[L.UNAVAILABLE=14]="UNAVAILABLE",L[L.DATA_LOSS=15]="DATA_LOSS";class ct{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[s,i]of r)if(this.equalsFn(s,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(void 0===s)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return 1===r.length?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ct(this.inner,(t,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return zc(this.inner)}size(){return this.innerSize}}const rg=new ee(I.comparator);function be(){return rg}const Ml=new ee(I.comparator);function ar(...n){let e=Ml;for(const t of n)e=e.insert(t.key,t);return e}function Ll(n){let e=Ml;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Pe(){return ur()}function Ol(){return ur()}function ur(){return new ct(n=>n.toString(),(n,e)=>n.isEqual(e))}const sg=new ee(I.comparator),ig=new B(I.comparator);function k(...n){let e=ig;for(const t of n)e=e.add(t);return e}const og=new B(N);function Ss(){return og}class cr{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,lr.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new cr(A.min(),s,Ss(),be(),k())}}class lr{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lr(r,t,k(),k(),k())}}class bs{constructor(e,t,r,s){this.It=e,this.removedTargetIds=t,this.key=r,this.Tt=s}}class Vl{constructor(e,t){this.targetId=e,this.Et=t}}class Pl{constructor(e,t,r=ae.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class ql{constructor(){this.At=0,this.Rt=Bl(),this.bt=ae.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=k(),t=k(),r=k();return this.Rt.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:E()}}),new lr(this.bt,this.Pt,e,t,r)}xt(){this.vt=!1,this.Rt=Bl()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class ag{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=be(),this.qt=Ul(),this.Ut=new B(N)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const r=this.Wt(t);switch(e.state){case 0:this.zt(t)&&r.Dt(e.resumeToken);break;case 1:r.Mt(),r.Vt||r.xt(),r.Dt(e.resumeToken);break;case 2:r.Mt(),r.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(r.Ft(),r.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),r.Dt(e.resumeToken));break;default:E()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((r,s)=>{this.zt(s)&&t(s)})}Jt(e){const t=e.targetId,r=e.Et.count,s=this.Yt(t);if(s){const i=s.target;if(vs(i))if(0===r){const o=new I(i.path);this.Qt(t,o,j.newNoDocument(o,A.min()))}else S(1===r);else this.Xt(t)!==r&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((i,o)=>{const a=this.Yt(o);if(a){if(i.current&&vs(a.target)){const u=new I(a.target.path);null!==this.Lt.get(u)||this.te(o,u)||this.Qt(o,u,j.newNoDocument(u,e))}i.St&&(t.set(o,i.Ct()),i.xt())}});let r=k();this.qt.forEach((i,o)=>{let a=!0;o.forEachWhile(u=>{const c=this.Yt(u);return!c||2===c.purpose||(a=!1,!1)}),a&&(r=r.add(i))}),this.Lt.forEach((i,o)=>o.setReadTime(e));const s=new cr(e,t,this.Ut,this.Lt,r);return this.Lt=be(),this.qt=Ul(),this.Ut=new B(N),s}Gt(e,t){if(!this.zt(e))return;const r=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,r),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,r){if(!this.zt(e))return;const s=this.Wt(e);this.te(e,t)?s.Nt(t,1):s.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),r&&(this.Lt=this.Lt.insert(t,r))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new ql,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new B(N),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||w("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new ql),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function Ul(){return new ee(I.comparator)}function Bl(){return new ee(I.comparator)}const ug={asc:"ASCENDING",desc:"DESCENDING"},cg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},lg={and:"AND",or:"OR"};class hg{constructor(e,t){this.databaseId=e,this.wt=t}}function hn(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Gl(n,e){return n.wt?e.toBase64():e.toUint8Array()}function dg(n,e){return hn(n,e.toTimestamp())}function re(n){return S(!!n),A.fromTimestamp(function(e){const t=it(e);return new Z(t.seconds,t.nanos)}(n))}function yo(n,e){return(t=n,new M(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Kl(n){const e=M.fromString(n);return S(Xl(e)),e}function hr(n,e){return yo(n.databaseId,e.path)}function qe(n,e){const t=Kl(e);if(t.get(1)!==n.databaseId.projectId)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new I($l(t))}function vo(n,e){return yo(n.databaseId,e)}function jl(n){const e=Kl(n);return 4===e.length?M.emptyPath():$l(e)}function dr(n){return new M(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $l(n){return S(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function zl(n,e,t){return{name:hr(n,e),fields:t.value.mapValue.fields}}function Ql(n,e,t){const r=qe(n,e.name),s=re(e.updateTime),i=e.createTime?re(e.createTime):A.min(),o=new pe({mapValue:{fields:e.fields}}),a=j.newFoundDocument(r,s,i,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function fr(n,e){let t;if(e instanceof cn)t={update:zl(n,e.key,e.value)};else if(e instanceof ln)t={delete:hr(n,e.key)};else if(e instanceof Ze)t={update:zl(n,e.key,e.data),updateMask:_g(e.fieldMask)};else{if(!(e instanceof po))return E();t={verify:hr(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,i){const o=i.transform;if(o instanceof an)return{fieldPath:i.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof Ft)return{fieldPath:i.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof Mt)return{fieldPath:i.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof un)return{fieldPath:i.field.canonicalString(),increment:o.gt};throw E()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:dg(n,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:E()),t;var s}function wo(n,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?W.updateTime(re(s.updateTime)):void 0!==s.exists?W.exists(s.exists):W.none():W.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(i,o){let a=null;"setToServerValue"in o?(S("REQUEST_TIME"===o.setToServerValue),a=new an):"appendMissingElements"in o?a=new Ft(o.appendMissingElements.values||[]):"removeAllFromArray"in o?a=new Mt(o.removeAllFromArray.values||[]):"increment"in o?a=new un(i,o.increment):E();const u=X.fromServerFormat(o.fieldPath);return new ir(u,a)}(n,s)):[];var s;if(e.update){const s=qe(n,e.update.name),i=new pe({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=new Se((e.updateMask.fieldPaths||[]).map(c=>X.fromServerFormat(c)));return new Ze(s,i,o,t,r)}return new cn(s,i,t,r)}if(e.delete){const s=qe(n,e.delete);return new ln(s,t)}if(e.verify){const s=qe(n,e.verify);return new po(s,t)}return E()}function Zl(n,e){return{documents:[vo(n,e.path)]}}function _o(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=vo(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=vo(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const s=function(u){if(0!==u.length)return Yl(U.create(u,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const i=function(u){if(0!==u.length)return u.map(c=>{return{field:dn((l=c).field),direction:yg(l.dir)};var l})}(e.orderBy);i&&(t.structuredQuery.orderBy=i);const o=(c=e.limit,n.wt||Yn(c)?c:{value:c});var c,a,u;return null!==o&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt={before:!(u=e.endAt).inclusive,values:u.position}),t}function Wl(n){let e=jl(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){S(1===r);const l=t.from[0];l.allDescendants?s=l.collectionId:e=e.child(l.collectionId)}let i=[];t.where&&(i=function(l){const h=Hl(l);return h instanceof U&&ao(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(l=>{return new rn(fn((h=l).field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction));var h}));let a=null;t.limit&&(a=function(l){let h;return h="object"==typeof l?l.value:l,Yn(h)?null:h}(t.limit));let u=null;var l;t.startAt&&(u=new ut((l=t.startAt).values||[],!!l.before));let c=null;return t.endAt&&(c=function(l){return new ut(l.values||[],!l.before)}(t.endAt)),ml(e,s,o,i,a,"F",u,c)}function Hl(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=fn(e.unaryFilter.field);return R.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=fn(e.unaryFilter.field);return R.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=fn(e.unaryFilter.field);return R.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=fn(e.unaryFilter.field);return R.create(i,"!=",{nullValue:"NULL_VALUE"});default:return E()}}(n):void 0!==n.fieldFilter?R.create(fn((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return E()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return U.create(e.compositeFilter.filters.map(t=>Hl(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return E()}}(e.compositeFilter.op))}(n):E();var e}function yg(n){return ug[n]}function vg(n){return cg[n]}function wg(n){return lg[n]}function dn(n){return{fieldPath:n.canonicalString()}}function fn(n){return X.fromServerFormat(n.fieldPath)}function Yl(n){return n instanceof R?function(e){if("=="===e.op){if(Yc(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NAN"}};if(Hc(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Yc(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NAN"}};if(Hc(e.value))return{unaryFilter:{field:dn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:dn(e.field),op:vg(e.op),value:e.value}}}(n):n instanceof U?function(e){const t=e.getFilters().map(r=>Yl(r));return 1===t.length?t[0]:{compositeFilter:{op:wg(e.op),filters:t}}}(n):E()}function _g(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Xl(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function xe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Jl(e)),e=Ig(n.get(t),e);return Jl(e)}function Ig(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=i}}return t}function Jl(n){return n+"\x01\x01"}function Ue(n){const e=n.length;if(S(e>=2),2===e)return S("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),M.emptyPath();const t=e-2,r=[];let s="";for(let i=0;i<e;){const o=n.indexOf("\x01",i);switch((o<0||o>t)&&E(),n.charAt(o+1)){case"\x01":const a=n.substring(i,o);let u;0===s.length?u=a:(s+=a,u=s,s=""),r.push(u);break;case"\x10":s+=n.substring(i,o),s+="\0";break;case"\x11":s+=n.substring(i,o+1);break;default:E()}i=o+2}return new M(r)}const eh=["userId","batchId"];function Cs(n,e){return[n,xe(e)]}function th(n,e,t){return[n,xe(e),t]}const xg={},Tg=["prefixPath","collectionGroup","readTime","documentId"],Eg=["prefixPath","collectionGroup","documentId"],Sg=["collectionGroup","readTime","prefixPath","documentId"],bg=["canonicalId","targetId"],Cg=["targetId","path"],Ag=["path","targetId"],Dg=["collectionId","parent"],Ng=["indexId","uid"],kg=["uid","sequenceNumber"],Rg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Fg=["indexId","uid","orderedDocumentKey"],Mg=["userId","collectionPath","documentId"],Lg=["userId","collectionPath","largestBatchId"],Og=["userId","collectionGroup","largestBatchId"],nh=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Vg=[...nh,"documentOverlays"],rh=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],sh=rh,Pg=[...sh,"indexConfiguration","indexState","indexEntries"];class Io extends Kc{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function he(n,e){const t=x(n);return Me.M(t.se,e)}class xo{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&eg(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=or(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=or(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ol();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=t.has(s.key)?null:a;const u=Cl(o,a);null!==u&&r.set(s.key,u),o.isValidDocument()||o.convertToNoDocument(A.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),k())}isEqual(e){return this.batchId===e.batchId&&en(this.mutations,e.mutations,(t,r)=>Al(t,r))&&en(this.baseMutations,e.baseMutations,(t,r)=>Al(t,r))}}class To{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){S(e.mutations.length===r.length);let s=sg;const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new To(e,t,r,s)}}class Eo{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class lt{constructor(e,t,r,s,i=A.min(),o=A.min(),a=ae.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new lt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new lt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new lt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class ih{constructor(e){this.ie=e}}function oh(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:As(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:hr(s=n.ie,(i=e).key),fields:i.data.value.mapValue.fields,updateTime:hn(s,i.version.toTimestamp()),createTime:hn(s,i.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Lt(e.version)};else{if(!e.isUnknownDocument())return E();r.unknownDocument={path:t.path.toArray(),version:Lt(e.version)}}var s,i;return r}function As(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Lt(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ot(n){const e=new Z(n.seconds,n.nanoseconds);return A.fromTimestamp(e)}function Vt(n,e){const t=(e.baseMutations||[]).map(i=>wo(n.ie,i));for(let i=0;i<e.mutations.length-1;++i)i+1<e.mutations.length&&void 0!==e.mutations[i+1].transform&&(e.mutations[i].updateTransforms=e.mutations[i+1].transform.fieldTransforms,e.mutations.splice(i+1,1),++i);const r=e.mutations.map(i=>wo(n.ie,i)),s=Z.fromMillis(e.localWriteTimeMs);return new xo(e.batchId,s,t,r)}function mr(n){const e=Ot(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Ot(n.lastLimboFreeSnapshotVersion):A.min();let r;var s;return void 0!==n.query.documents?(S(1===(s=n.query).documents.length),r=Ie(on(jl(s.documents[0])))):r=Ie(Wl(n.query)),new lt(r,n.targetId,0,n.lastListenSequenceNumber,e,t,ae.fromBase64String(n.resumeToken))}function ah(n,e){const t=Lt(e.snapshotVersion),r=Lt(e.lastLimboFreeSnapshotVersion);let s;s=vs(e.target)?Zl(n.ie,e.target):_o(n.ie,e.target);const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:kt(e.target),readTime:t,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function So(n){const e=Wl({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Is(e,e.limit,"L"):e}function bo(n,e){return new Eo(e.largestBatchId,wo(n.ie,e.overlayMutation))}function uh(n,e){const t=e.path.lastSegment();return[n,xe(e.path.popLast()),t]}function ch(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Lt(r.readTime),documentKey:xe(r.documentKey.path),largestBatchId:r.largestBatchId}}class Ug{getBundleMetadata(e,t){return lh(e).get(t).next(r=>{if(r)return{id:(s=r).bundleId,createTime:Ot(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return lh(e).put({bundleId:(r=t).id,createTime:Lt(re(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return hh(e).get(t).next(r=>{if(r)return{name:(s=r).name,query:So(s.bundledQuery),readTime:Ot(s.readTime)};var s})}saveNamedQuery(e,t){return hh(e).put({name:(r=t).name,readTime:Lt(re(r.readTime)),bundledQuery:r.bundledQuery});var r}}function lh(n){return he(n,"bundles")}function hh(n){return he(n,"namedQueries")}class Ds{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new Ds(e,t.uid||"")}getOverlay(e,t){return gr(e).get(uh(this.userId,t)).next(r=>r?bo(this.yt,r):null)}getOverlays(e,t){const r=Pe();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){const s=[];return r.forEach((i,o)=>{const a=new Eo(t,o);s.push(this.oe(e,a))}),f.waitFor(s)}removeOverlaysForBatchId(e,t,r){const s=new Set;t.forEach(o=>s.add(xe(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(gr(e).Y("collectionPathOverlayIndex",a))}),f.waitFor(i)}getOverlaysForCollection(e,t,r){const s=Pe(),i=xe(t),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return gr(e).W("collectionPathOverlayIndex",o).next(a=>{for(const u of a){const c=bo(this.yt,u);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,t,r,s){const i=Pe();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return gr(e).Z({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{const h=bo(this.yt,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>i)}oe(e,t){return gr(e).put(function(r,s,i){const[o,a,u]=uh(s,i.mutation.key);return{userId:s,collectionPath:a,documentId:u,collectionGroup:i.mutation.key.getCollectionGroup(),largestBatchId:i.largestBatchId,overlayMutation:fr(r.ie,i.mutation)}}(this.yt,this.userId,t))}}function gr(n){return he(n,"documentOverlays")}class Pt{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(J(e.integerValue));else if("doubleValue"in e){const r=J(e.doubleValue);isNaN(r)?this.he(t,13):(this.he(t,15),Xn(r)?t.le(0):t.le(r))}else if("timestampValue"in e){const r=e.timestampValue;this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(`${r.seconds||""}`),t.le(r.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(At(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)}else"mapValue"in e?Xc(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):E()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const r=e.fields||{};this.he(t,55);for(const s of Object.keys(r))this.de(s,t),this.ce(r[s],t)}ye(e,t){const r=e.values||[];this.he(t,50);for(const s of r)this.ce(s,t)}me(e,t){this.he(t,37),I.fromName(e).path.forEach(r=>{this.he(t,60),this.pe(r,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function Bg(n){if(0===n)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function dh(n){const e=64-function(t){let r=0;for(let s=0;s<8;++s){const i=Bg(255&t[s]);if(r+=i,8!==i)break}return r}(n);return Math.ceil(e/8)}Pt.Ie=new Pt;class Gg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ee(r.value),r=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.be(r.value),r=t.next();this.Pe()}ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ee(r);else if(r<2048)this.Ee(960|r>>>6),this.Ee(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r);else{const s=t.codePointAt(0);this.Ee(240|s>>>18),this.Ee(128|63&s>>>12),this.Ee(128|63&s>>>6),this.Ee(128|63&s)}}this.Ae()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.be(r);else if(r<2048)this.be(960|r>>>6),this.be(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.be(480|r>>>12),this.be(128|63&r>>>6),this.be(128|63&r);else{const s=t.codePointAt(0);this.be(240|s>>>18),this.be(128|63&s>>>12),this.be(128|63&s>>>6),this.be(128|63&s)}}this.Pe()}Se(e){const t=this.De(e),r=dh(t);this.Ce(1+r),this.buffer[this.position++]=255&r;for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=255&t[s]}xe(e){const t=this.De(e),r=dh(t);this.Ce(1+r),this.buffer[this.position++]=~(255&r);for(let s=t.length-r;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(s){const i=new DataView(new ArrayBuffer(8));return i.setFloat64(0,s,!1),new Uint8Array(i.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let s=1;s<t.length;++s)t[s]^=r?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Kg{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class jg{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class pr{constructor(){this.$e=new Gg,this.Be=new Kg(this.$e),this.Le=new jg(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class qt{constructor(e,t,r,s){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=s}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new qt(this.indexId,this.documentKey,this.arrayValue,r)}}function ht(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=fh(n.arrayValue,e.arrayValue),0!==t?t:(t=fh(n.directionalValue,e.directionalValue),0!==t?t:I.comparator(n.documentKey,e.documentKey)))}function fh(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class $g{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const r=t;r.isInequality()?this.Qe=r:this.Ge.push(r)}}je(e){S(e.collectionGroup===this.collectionId);const t=Ji(e);if(void 0!==t&&!this.We(t))return!1;const r=St(e);let s=0,i=0;for(;s<r.length&&this.We(r[s]);++s);if(s===r.length)return!0;if(void 0!==this.Qe){const o=r[s];if(!this.ze(this.Qe,o)||!this.He(this.Ke[i++],o))return!1;++s}for(;s<r.length;++s)if(i>=this.Ke.length||!this.He(this.Ke[i++],r[s]))return!1;return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function mh(n){var e,t;if(S(n instanceof R||n instanceof U),n instanceof R){if(n instanceof cl){const s=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(i=>R.create(n.field,"==",i)))||[];return U.create(s,"or")}return n}const r=n.filters.map(s=>mh(s));return U.create(r,n.op)}function zg(n){if(0===n.getFilters().length)return[];const e=Do(mh(n));return S(gh(e)),Co(e)||Ao(e)?[e]:e.getFilters()}function Co(n){return n instanceof R}function Ao(n){return n instanceof U&&ao(n)}function gh(n){return Co(n)||Ao(n)||function(e){if(e instanceof U&&oo(e)){for(const t of e.getFilters())if(!Co(t)&&!Ao(t))return!1;return!0}return!1}(n)}function Do(n){if(S(n instanceof R||n instanceof U),n instanceof R)return n;if(1===n.filters.length)return Do(n.filters[0]);const e=n.filters.map(r=>Do(r));let t=U.create(e,n.op);return t=Ns(t),gh(t)?t:(S(t instanceof U),S(nn(t)),S(t.filters.length>1),t.filters.reduce((r,s)=>No(r,s)))}function No(n,e){let t;return S(n instanceof R||n instanceof U),S(e instanceof R||e instanceof U),t=n instanceof R?e instanceof R?U.create([n,e],"and"):ph(n,e):e instanceof R?ph(e,n):function(r,s){if(S(r.filters.length>0&&s.filters.length>0),nn(r)&&nn(s))return ol(r,s.getFilters());const i=oo(r)?r:s,o=oo(r)?s:r,a=i.filters.map(u=>No(u,o));return U.create(a,"or")}(n,e),Ns(t)}function ph(n,e){if(nn(e))return ol(e,n.getFilters());{const t=e.filters.map(r=>No(n,r));return U.create(t,"or")}}function Ns(n){if(S(n instanceof R||n instanceof U),n instanceof R)return n;const e=n.getFilters();if(1===e.length)return Ns(e[0]);if(sl(n))return n;const t=e.map(s=>Ns(s)),r=[];return t.forEach(s=>{s instanceof R?r.push(s):s instanceof U&&(s.op===n.op?r.push(...s.filters):r.push(s))}),1===r.length?r[0]:U.create(r,n.op)}class Qg{constructor(){this.Je=new ko}addToCollectionParentIndex(e,t){return this.Je.add(t),f.resolve()}getCollectionParents(e,t){return f.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return f.resolve()}deleteFieldIndex(e,t){return f.resolve()}getDocumentsMatchingTarget(e,t){return f.resolve(null)}getIndexType(e,t){return f.resolve(0)}getFieldIndexes(e,t){return f.resolve([])}getNextCollectionGroupToUpdate(e){return f.resolve(null)}getMinOffset(e,t){return f.resolve(Ne.min())}getMinOffsetFromCollectionGroup(e,t){return f.resolve(Ne.min())}updateCollectionGroup(e,t,r){return f.resolve()}updateIndexEntries(e,t){return f.resolve()}}class ko{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new B(M.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new B(M.comparator)).toArray()}}const ks=new Uint8Array(0);class Zg{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new ko,this.Xe=new ct(r=>kt(r),(r,s)=>rr(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const r=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const i={collectionId:r,parent:xe(s)};return yh(e).put(i)}return f.resolve()}getCollectionParents(e,t){const r=[],s=IDBKeyRange.bound([t,""],[qc(t),""],!1,!0);return yh(e).W(s).next(i=>{for(const o of i){if(o.collectionId!==t)break;r.push(Ue(o.parent))}return r})}addFieldIndex(e,t){const r=Rs(e),s={indexId:(o=t).indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])};var o;delete s.indexId;const i=r.add(s);if(t.indexState){const o=vr(e);return i.next(a=>{o.put(ch(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const r=Rs(e),s=vr(e),i=yr(e);return r.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=yr(e);let s=!0;const i=new Map;return f.forEach(this.Ze(t),o=>this.tn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=k();const a=[];return f.forEach(i,(u,c)=>{var l;w("IndexedDbIndexManager",`Using index ${l=u,`id=${l.indexId}|cg=${l.collectionGroup}|f=${l.fields.map(O=>`${O.fieldPath}:${O.kind}`).join(",")}`} to execute ${kt(t)}`);const h=function(O,te){const V=Ji(te);if(void 0===V)return null;for(const q of ws(O,V.fieldPath))switch(q.op){case"array-contains-any":return q.value.arrayValue.values||[];case"array-contains":return[q.value]}return null}(c,u),d=function(O,te){const V=new Map;for(const q of St(te))for(const ue of ws(O,q.fieldPath))switch(ue.op){case"==":case"in":V.set(q.fieldPath.canonicalString(),ue.value);break;case"not-in":case"!=":return V.set(q.fieldPath.canonicalString(),ue.value),Array.from(V.values())}return null}(c,u),g=function(O,te){const V=[];let q=!0;for(const ue of St(te)){const Mr=0===ue.kind?dl(O,ue.fieldPath,O.startAt):fl(O,ue.fieldPath,O.startAt);V.push(Mr.value),q&&(q=Mr.inclusive)}return new ut(V,q)}(c,u),v=function(O,te){const V=[];let q=!0;for(const ue of St(te)){const Mr=0===ue.kind?fl(O,ue.fieldPath,O.endAt):dl(O,ue.fieldPath,O.endAt);V.push(Mr.value),q&&(q=Mr.inclusive)}return new ut(V,q)}(c,u),T=this.en(u,c,g),C=this.en(u,c,v),G=this.nn(u,c,d),H=this.sn(u.indexId,h,T,g.inclusive,C,v.inclusive,G);return f.forEach(H,O=>r.J(O,t.limit).next(te=>{te.forEach(V=>{const q=I.fromSegments(V.documentKey);o.has(q)||(o=o.add(q),a.push(q))})}))}).next(()=>a)}return f.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:zg(U.create(e.filters,"and")).map(r=>co(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,r,s,i,o,a){const u=(null!=t?t.length:1)*Math.max(r.length,i.length),c=u/(null!=t?t.length:1),l=[];for(let h=0;h<u;++h){const d=t?this.rn(t[h/c]):ks,g=this.on(e,d,r[h%c],s),v=this.un(e,d,i[h%c],o),T=a.map(C=>this.on(e,d,C,!0));l.push(...this.createRange(g,v,T))}return l}on(e,t,r,s){const i=new qt(e,I.empty(),t,r);return s?i:i.Ue()}un(e,t,r,s){const i=new qt(e,I.empty(),t,r);return s?i.Ue():i}tn(e,t){const r=new $g(t),s=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.je(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const s=this.Ze(t);return f.forEach(s,i=>this.tn(e,i).next(o=>{o?0!==r&&o.fields.length<function(a){let u=new B(X.comparator),c=!1;for(const l of a.filters)for(const h of l.getFlattenedFilters())h.field.isKeyField()||("array-contains"===h.op||"array-contains-any"===h.op?c=!0:u=u.add(h.field));for(const l of a.orderBy)l.field.isKeyField()||(u=u.add(l.field));return u.size+(c?1:0)}(i)&&(r=1):r=0})).next(()=>null!==t.limit&&s.length>1&&2===r?1:r)}cn(e,t){const r=new pr;for(const s of St(e)){const i=t.data.field(s.fieldPath);if(null==i)return null;const o=r.qe(s.kind);Pt.Ie.ue(i,o)}return r.Fe()}rn(e){const t=new pr;return Pt.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const r=new pr;return Pt.Ie.ue(Nt(this.databaseId,t),r.qe(function(s){const i=St(s);return 0===i.length?0:i[i.length-1].kind}(e))),r.Fe()}nn(e,t,r){if(null===r)return[];let s=[];s.push(new pr);let i=0;for(const o of St(e)){const a=r[i++];for(const u of s)if(this.hn(t,o.fieldPath)&&tr(a))s=this.ln(s,o,a);else{const c=u.qe(o.kind);Pt.Ie.ue(a,c)}}return this.fn(s)}en(e,t,r){return this.nn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Fe();return t}ln(e,t,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const u=new pr;u.seed(a.Fe()),Pt.Ie.ue(o,u.qe(t.kind)),i.push(u)}return i}hn(e,t){return!!e.filters.find(r=>r instanceof R&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=Rs(e),s=vr(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(i=>{const o=[];return f.forEach(i,a=>s.get([a.indexId,this.uid]).next(u=>{o.push(function(c,l){const h=l?new Wn(l.sequenceNumber,new Ne(Ot(l.readTime),new I(Ue(l.documentKey)),l.largestBatchId)):Wn.empty(),d=c.fields.map(([g,v])=>new fs(X.fromServerFormat(g),v));return new ds(c.indexId,c.collectionGroup,d,h)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return 0!==i?i:N(r.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const s=Rs(e),i=vr(e);return this.dn(e).next(o=>s.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>f.forEach(a,u=>i.put(ch(u.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return f.forEach(t,(s,i)=>{const o=r.get(s.collectionGroup);return(o?f.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),f.forEach(a,u=>this._n(e,s,u).next(c=>{const l=this.wn(i,u);return c.isEqual(l)?f.resolve():this.mn(e,i,u,c,l)}))))})}gn(e,t,r,s){return yr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.an(r,t.key),documentKey:t.key.path.toArray()})}yn(e,t,r,s){return yr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.an(r,t.key),t.key.path.toArray()])}_n(e,t,r){const s=yr(e);let i=new B(ht);return s.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,t)])},(o,a)=>{i=i.add(new qt(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>i)}wn(e,t){let r=new B(ht);const s=this.cn(t,e);if(null==s)return r;const i=Ji(t);if(null!=i){const o=e.data.field(i.fieldPath);if(tr(o))for(const a of o.arrayValue.values||[])r=r.add(new qt(t.indexId,e.key,this.rn(a),s))}else r=r.add(new qt(t.indexId,e.key,ks,s));return r}mn(e,t,r,s,i){w("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,u,c,l,h){const d=a.getIterator(),g=u.getIterator();let v=sn(d),T=sn(g);for(;v||T;){let C=!1,G=!1;if(v&&T){const H=c(v,T);H<0?G=!0:H>0&&(C=!0)}else null!=v?G=!0:C=!0;C?(l(T),T=sn(g)):G?(h(v),v=sn(d)):(v=sn(d),T=sn(g))}}(s,i,ht,a=>{o.push(this.gn(e,t,r,a))},a=>{o.push(this.yn(e,t,r,a))}),f.waitFor(o)}dn(e){let t=1;return vr(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ht(o,a)).filter((o,a,u)=>!a||0!==ht(o,u[a-1]));const s=[];s.push(e);for(const o of r){const a=ht(o,e),u=ht(o,t);if(0===a)s[0]=e.Ue();else if(a>0&&u<0)s.push(o),s.push(o.Ue());else if(u>0)break}s.push(t);const i=[];for(let o=0;o<s.length;o+=2){if(this.pn(s[o],s[o+1]))return[];i.push(IDBKeyRange.bound([s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,ks,[]],[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,ks,[]]))}return i}pn(e,t){return ht(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(vh)}getMinOffset(e,t){return f.mapArray(this.Ze(t),r=>this.tn(e,r).next(s=>s||E())).next(vh)}}function yh(n){return he(n,"collectionParents")}function yr(n){return he(n,"indexEntries")}function Rs(n){return he(n,"indexConfiguration")}function vr(n){return he(n,"indexState")}function vh(n){S(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const s=n[r].indexState.offset;eo(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Ne(e.readTime,e.documentKey,t)}const wh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ce{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ce(e,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function _h(n,e,t){const r=n.store("mutations"),s=n.store("documentMutations"),i=[],o=IDBKeyRange.only(t.batchId);let a=0;const u=r.Z({range:o},(l,h,d)=>(a++,d.delete()));i.push(u.next(()=>{S(1===a)}));const c=[];for(const l of t.mutations){const h=th(e,l.key.path,t.batchId);i.push(s.delete(h)),c.push(l.key)}return f.waitFor(i).next(()=>c)}function Fs(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw E();e=n.noDocument}return JSON.stringify(e).length}Ce.DEFAULT_COLLECTION_PERCENTILE=10,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ce.DEFAULT=new Ce(41943040,Ce.DEFAULT_COLLECTION_PERCENTILE,Ce.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ce.DISABLED=new Ce(-1,0,0);class Ms{constructor(e,t,r,s){this.userId=e,this.yt=t,this.indexManager=r,this.referenceDelegate=s,this.In={}}static re(e,t,r,s){S(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Ms(i,t,r,s)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return dt(e).Z({index:"userMutationsIndex",range:r},(s,i,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,s){const i=mn(e),o=dt(e);return o.add({}).next(a=>{S("number"==typeof a);const u=new xo(a,t,r,s),c=function(d,g,v){const T=v.baseMutations.map(G=>fr(d.ie,G)),C=v.mutations.map(G=>fr(d.ie,G));return{userId:g,batchId:v.batchId,localWriteTimeMs:v.localWriteTime.toMillis(),baseMutations:T,mutations:C}}(this.yt,this.userId,u),l=[];let h=new B((d,g)=>N(d.canonicalString(),g.canonicalString()));for(const d of s){const g=th(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(i.put(g,xg))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.In[a]=u.keys()}),f.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return dt(e).get(t).next(r=>r?(S(r.userId===this.userId),Vt(this.yt,r)):null)}Tn(e,t){return this.In[t]?f.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const s=r.keys();return this.In[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return dt(e).Z({index:"userMutationsIndex",range:s},(o,a,u)=>{a.userId===this.userId&&(S(a.batchId>=r),i=Vt(this.yt,a)),u.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return dt(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return dt(e).W("userMutationsIndex",t).next(r=>r.map(s=>Vt(this.yt,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Cs(this.userId,t.path),s=IDBKeyRange.lowerBound(r),i=[];return mn(e).Z({range:s},(o,a,u)=>{const[c,l,h]=o,d=Ue(l);if(c===this.userId&&t.path.isEqual(d))return dt(e).get(h).next(g=>{if(!g)throw E();S(g.userId===this.userId),i.push(Vt(this.yt,g))});u.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new B(N);const s=[];return t.forEach(i=>{const o=Cs(this.userId,i.path),a=IDBKeyRange.lowerBound(o),u=mn(e).Z({range:a},(c,l,h)=>{const[d,g,v]=c,T=Ue(g);d===this.userId&&i.path.isEqual(T)?r=r.add(v):h.done()});s.push(u)}),f.waitFor(s).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1,i=Cs(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new B(N);return mn(e).Z({range:o},(u,c,l)=>{const[h,d,g]=u,v=Ue(d);h===this.userId&&r.isPrefixOf(v)?v.length===s&&(a=a.add(g)):l.done()}).next(()=>this.En(e,a))}En(e,t){const r=[],s=[];return t.forEach(i=>{s.push(dt(e).get(i).next(o=>{if(null===o)throw E();S(o.userId===this.userId),r.push(Vt(this.yt,o))}))}),f.waitFor(s).next(()=>r)}removeMutationBatch(e,t){return _h(e.se,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),f.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return f.resolve();const r=IDBKeyRange.lowerBound([this.userId]),s=[];return mn(e).Z({range:r},(i,o,a)=>{if(i[0]===this.userId){const u=Ue(i[1]);s.push(u)}else a.done()}).next(()=>{S(0===s.length)})})}containsKey(e,t){return Ih(e,this.userId,t)}Rn(e){return xh(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Ih(n,e,t){const r=Cs(e,t.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return mn(n).Z({range:i,X:!0},(a,u,c)=>{const[l,h,d]=a;l===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function dt(n){return he(n,"mutations")}function mn(n){return he(n,"documentMutations")}function xh(n){return he(n,"mutationQueues")}class Ut{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Ut(0)}static vn(){return new Ut(-1)}}class Wg{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new Ut(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>A.fromTimestamp(new Z(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(s=>(s.highestListenSequenceNumber=t,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Sn(e,s)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>gn(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(S(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let s=0;const i=[];return gn(e).Z((o,a)=>{const u=mr(a);u.sequenceNumber<=t&&null===r.get(u.targetId)&&(s++,i.push(this.removeTargetData(e,u)))}).next(()=>f.waitFor(i)).next(()=>s)}forEachTarget(e,t){return gn(e).Z((r,s)=>{const i=mr(s);t(i)})}Vn(e){return Th(e).get("targetGlobalKey").next(t=>(S(null!==t),t))}Sn(e,t){return Th(e).put("targetGlobalKey",t)}Dn(e,t){return gn(e).put(ah(this.yt,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=kt(t),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return gn(e).Z({range:s,index:"queryTargetsIndex"},(o,a,u)=>{const c=mr(a);rr(t,c.target)&&(i=c,u.done())}).next(()=>i)}addMatchingKeys(e,t,r){const s=[],i=ft(e);return t.forEach(o=>{const a=xe(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),f.waitFor(s)}removeMatchingKeys(e,t,r){const s=ft(e);return f.forEach(t,i=>{const o=xe(i.path);return f.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,t){const r=ft(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),s=ft(e);let i=k();return s.Z({range:r,X:!0},(o,a,u)=>{const c=Ue(o[1]),l=new I(c);i=i.add(l)}).next(()=>i)}containsKey(e,t){const r=xe(t.path),s=IDBKeyRange.bound([r],[qc(r)],!1,!0);let i=0;return ft(e).Z({index:"documentTargetsIndex",X:!0,range:s},([o,a],u,c)=>{0!==o&&(i++,c.done())}).next(()=>i>0)}ne(e,t){return gn(e).get(t).next(r=>r?mr(r):null)}}function gn(n){return he(n,"targets")}function Th(n){return he(n,"targetGlobal")}function ft(n){return he(n,"targetDocuments")}function Eh([n,e],[t,r]){const s=N(n,t);return 0===s?N(e,r):s}class Hg{constructor(e){this.xn=e,this.buffer=new B(Eh),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Eh(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Yg{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;w("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,p.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){rt(r)?w("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield nt(r)}yield t.Fn(3e5)}))}}class Xg{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return f.resolve(ke.at);const r=new Hg(t);return this.$n.forEachTarget(e,s=>r.On(s.sequenceNumber)).next(()=>this.$n.Ln(e,s=>r.On(s))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector","Garbage collection skipped; disabled"),f.resolve(wh)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(w("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),wh):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let r,s,i,o,a,u,c;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(w("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(i=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Yi()<=wt.in.DEBUG&&w("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${o-l}ms\n\tDetermined least recently used ${s} in `+(a-o)+`ms\n\tRemoved ${i} targets in `+(u-a)+`ms\n\tRemoved ${h} documents in `+(c-u)+`ms\nTotal Duration: ${c-l}ms`),f.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}class Jg{constructor(e,t){this.db=e,this.garbageCollector=new Xg(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(s=>r+s))}Un(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,s)=>t(s))}addReference(e,t,r){return Ls(e,r)}removeReference(e,t,r){return Ls(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ls(e,t)}Gn(e,t){return function(r,s){let i=!1;return xh(r).tt(o=>Ih(r,o,s).next(a=>(a&&(i=!0),f.resolve(!a)))).next(()=>i)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Kn(e,(o,a)=>{if(a<=t){const u=this.Gn(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,A.min()),ft(e).delete([0,xe(o.path)])))});s.push(u)}}).next(()=>f.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ls(e,t)}Kn(e,t){const r=ft(e);let s,i=ke.at;return r.Z({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{0===o?(i!==ke.at&&t(new I(Ue(s)),i),i=c,s=u):i=ke.at}).next(()=>{i!==ke.at&&t(new I(Ue(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Ls(n,e){return ft(n).put((r=n.currentSequenceNumber,{targetId:0,path:xe(e.path),sequenceNumber:r}));var r}class Sh{constructor(){this.changes=new ct(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,j.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?f.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ep{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Bt(e).put(r)}removeEntry(e,t,r){return Bt(e).delete(function(s,i){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],As(i),o[o.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=j.newInvalidDocument(t);return Bt(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(wr(t))},(s,i)=>{r=this.jn(t,i)}).next(()=>r)}Wn(e,t){let r={size:0,document:j.newInvalidDocument(t)};return Bt(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(wr(t))},(s,i)=>{r={document:this.jn(t,i),size:Fs(i)}}).next(()=>r)}getEntries(e,t){let r=be();return this.zn(e,t,(s,i)=>{const o=this.jn(s,i);r=r.insert(s,o)}).next(()=>r)}Hn(e,t){let r=be(),s=new ee(I.comparator);return this.zn(e,t,(i,o)=>{const a=this.jn(i,o);r=r.insert(i,a),s=s.insert(i,Fs(o))}).next(()=>({documents:r,Jn:s}))}zn(e,t,r){if(t.isEmpty())return f.resolve();let s=new B(Dh);t.forEach(u=>s=s.add(u));const i=IDBKeyRange.bound(wr(s.first()),wr(s.last())),o=s.getIterator();let a=o.getNext();return Bt(e).Z({index:"documentKeyIndex",range:i},(u,c,l)=>{const h=I.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Dh(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.j(wr(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,t,r){const s=[t.popLast().toArray(),t.lastSegment(),As(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Bt(e).W(IDBKeyRange.bound(s,i,!0)).next(o=>{let a=be();for(const u of o){const c=this.jn(I.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);a=a.insert(c.key,c)}return a})}getAllFromCollectionGroup(e,t,r,s){let i=be();const o=Ah(t,r),a=Ah(t,Ne.max());return Bt(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{const h=this.jn(I.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&l.done()}).next(()=>i)}newChangeBuffer(e){return new tp(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Ch(e).get("remoteDocumentGlobalKey").next(t=>(S(!!t),t))}Qn(e,t){return Ch(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=function qg(n,e){let t;if(e.document)t=Ql(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=I.fromSegments(e.noDocument.path),s=Ot(e.noDocument.readTime);t=j.newNoDocument(r,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return E();{const r=I.fromSegments(e.unknownDocument.path),s=Ot(e.unknownDocument.version);t=j.newUnknownDocument(r,s)}}return e.readTime&&t.setReadTime(function(r){const s=new Z(r[0],r[1]);return A.fromTimestamp(s)}(e.readTime)),t}(this.yt,t);if(!r.isNoDocument()||!r.version.isEqual(A.min()))return r}return j.newInvalidDocument(e)}}function bh(n){return new ep(n)}class tp extends Sh{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new ct(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const t=[];let r=0,s=new B((i,o)=>N(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Xn.get(i);if(t.push(this.Yn.removeEntry(e,i,a.readTime)),o.isValidDocument()){const u=oh(this.Yn.yt,o);s=s.add(i.path.popLast());const c=Fs(u);r+=c-a.size,t.push(this.Yn.addEntry(e,i,u))}else if(r-=a.size,this.trackRemovals){const u=oh(this.Yn.yt,o.convertToNoDocument(A.min()));t.push(this.Yn.addEntry(e,i,u))}}),s.forEach(i=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,i))}),t.push(this.Yn.updateMetadata(e,r)),f.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:s})=>(s.forEach((i,o)=>{this.Xn.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Ch(n){return he(n,"remoteDocumentGlobal")}function Bt(n){return he(n,"remoteDocumentsV14")}function wr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ah(n,e){const t=e.documentKey.path.toArray();return[n,As(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Dh(n,e){const t=n.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<t.length-2&&i<r.length-2;++i)if(s=N(t[i],r[i]),s)return s;return s=N(t.length,r.length),s||(s=N(t[t.length-2],r[r.length-2]),s||N(t[t.length-1],r[r.length-1]))}class np{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Nh{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(null!==r&&or(r.mutation,s,Se.empty(),Z.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,k()).next(()=>r))}getLocalViewOfDocuments(e,t,r=k()){const s=Pe();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,r).next(i=>{let o=ar();return i.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=Pe();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,k()))}populateOverlays(e,t,r){const s=[];return r.forEach(i=>{t.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,s){let i=be();const o=ur(),a=ur();return t.forEach((u,c)=>{const l=r.get(c.key);s.has(c.key)&&(void 0===l||l.mutation instanceof Ze)?i=i.insert(c.key,c):void 0!==l?(o.set(c.key,l.mutation.getFieldMask()),or(l.mutation,c,l.mutation.getFieldMask(),Z.now())):o.set(c.key,Se.empty())}),this.recalculateAndSaveOverlays(e,i).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new np(l,null!==(h=o.get(c))&&void 0!==h?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=ur();let s=new ee((o,a)=>o-a),i=k();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(u=>{const c=t.get(u);if(null===c)return;let l=r.get(u)||Se.empty();l=a.applyToLocalView(c,l),r.set(u,l);const h=(s.get(a.batchId)||k()).add(u);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const u=a.getNext(),c=u.key,l=u.value,h=Ol();l.forEach(d=>{if(!i.has(d)){const g=Cl(t.get(d),r.get(d));null!==g&&h.set(d,g),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return f.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return I.isDocumentKey((s=t).path)&&null===s.collectionGroup&&0===s.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ho(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var s}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):f.resolve(Pe());let a=-1,u=i;return o.next(c=>f.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(l)?f.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,u,c,k())).next(l=>({batchId:a,changes:Ll(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new I(t)).next(r=>{let s=ar();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const s=t.collectionGroup;let i=ar();return this.indexManager.getCollectionParents(e,s).next(o=>f.forEach(o,a=>{const u=(c=t,l=a.child(s),new Qe(l,null,c.explicitOrderBy.slice(),c.filters.slice(),c.limit,c.limitType,c.startAt,c.endAt));var c,l;return this.getDocumentsMatchingCollectionQuery(e,u,r).next(c=>{c.forEach((l,h)=>{i=i.insert(l,h)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,r){let s;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(i=>(s=i,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(i=>{i.forEach((a,u)=>{const c=u.getKey();null===s.get(c)&&(s=s.insert(c,j.newInvalidDocument(c)))});let o=ar();return s.forEach((a,u)=>{const c=i.get(a);void 0!==c&&or(c.mutation,u,Se.empty(),Z.now()),go(t,u)&&(o=o.insert(a,u))}),o})}}class rp{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return f.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:re(r.createTime)}),f.resolve()}getNamedQuery(e,t){return f.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(r=t).name,query:So(r.bundledQuery),readTime:re(r.readTime)}),f.resolve();var r}}class sp{constructor(){this.overlays=new ee(I.comparator),this.es=new Map}getOverlay(e,t){return f.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Pe();return f.forEach(t,s=>this.getOverlay(e,s).next(i=>{null!==i&&r.set(s,i)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((s,i)=>{this.oe(e,t,i)}),f.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.es.get(r);return void 0!==s&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.es.delete(r)),f.resolve()}getOverlaysForCollection(e,t,r){const s=Pe(),i=t.length+1,o=new I(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return f.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new ee((c,l)=>c-l);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=i.get(c.largestBatchId);null===l&&(l=Pe(),i=i.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}const a=Pe(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=s)););return f.resolve(a)}oe(e,t,r){const s=this.overlays.get(r.key);if(null!==s){const o=this.es.get(s.largestBatchId).delete(r.key);this.es.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Eo(t,r));let i=this.es.get(t);void 0===i&&(i=k(),this.es.set(t,i)),this.es.set(t,i.add(r.key))}}class Ro{constructor(){this.ns=new B(de.ss),this.rs=new B(de.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new de(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new de(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new I(new M([])),r=new de(t,e),s=new de(t,e+1),i=[];return this.rs.forEachInRange([r,s],o=>{this.cs(o),i.push(o.key)}),i}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new I(new M([])),r=new de(t,e),s=new de(t,e+1);let i=k();return this.rs.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const t=new de(e,0),r=this.ns.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class de{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return I.comparator(e.key,t.key)||N(e._s,t._s)}static os(e,t){return N(e._s,t._s)||I.comparator(e.key,t.key)}}class ip{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new B(de.ss)}checkEmpty(e){return f.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,s){const i=this.ws;this.ws++;const o=new xo(i,t,r,s);this.mutationQueue.push(o);for(const a of s)this.gs=this.gs.add(new de(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return f.resolve(o)}lookupMutationBatch(e,t){return f.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const s=this.ps(t+1),i=s<0?0:s;return f.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return f.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return f.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new de(t,0),s=new de(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([r,s],o=>{const a=this.ys(o._s);i.push(a)}),f.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new B(N);return t.forEach(s=>{const i=new de(s,0),o=new de(s,Number.POSITIVE_INFINITY);this.gs.forEachInRange([i,o],a=>{r=r.add(a._s)})}),f.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;I.isDocumentKey(i)||(i=i.child(""));const o=new de(new I(i),0);let a=new B(N);return this.gs.forEachWhile(u=>{const c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(u._s)),!0)},o),f.resolve(this.Is(a))}Is(e){const t=[];return e.forEach(r=>{const s=this.ys(r);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){S(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let r=this.gs;return f.forEach(t.mutations,s=>{const i=new de(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new de(t,0),s=this.gs.firstAfterOrEqual(r);return f.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return f.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class op{constructor(e){this.Es=e,this.docs=new ee(I.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,o=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return f.resolve(r?r.document.mutableCopy():j.newInvalidDocument(t))}getEntries(e,t){let r=be();return t.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():j.newInvalidDocument(s))}),f.resolve(r)}getAllFromCollection(e,t,r){let s=be();const i=new I(t.child("")),o=this.docs.getIteratorFrom(i);for(;o.hasNext();){const{key:a,value:{document:u}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||eo(Bc(u),r)<=0||(s=s.insert(u.key,u.mutableCopy()))}return f.resolve(s)}getAllFromCollectionGroup(e,t,r,s){E()}As(e,t){return f.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ap(this)}getSize(e){return f.resolve(this.size)}}class ap extends Sh{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?t.push(this.Yn.addEntry(e,s)):this.Yn.removeEntry(r)}),f.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class up{constructor(e){this.persistence=e,this.Rs=new ct(t=>kt(t),rr),this.lastRemoteSnapshotVersion=A.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Ro,this.targetCount=0,this.vs=Ut.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,s)=>t(s)),f.resolve()}getLastRemoteSnapshotVersion(e){return f.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return f.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),f.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),f.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Ut(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,f.resolve()}updateTargetData(e,t){return this.Dn(t),f.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,f.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.Rs.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),f.waitFor(i).next(()=>s)}getTargetCount(e){return f.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return f.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),f.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),f.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),f.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return f.resolve(r)}containsKey(e,t){return f.resolve(this.Ps.containsKey(t))}}class kh{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ke(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new up(this),this.indexManager=new Qg,this.remoteDocumentCache=new op(r=>this.referenceDelegate.xs(r)),this.yt=new ih(t),this.Ns=new rp(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sp,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new ip(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){w("MemoryPersistence","Starting transaction:",e);const s=new cp(this.Ss.next());return this.referenceDelegate.ks(),r(s).next(i=>this.referenceDelegate.Os(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ms(e,t){return f.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class cp extends Kc{constructor(e){super(),this.currentSequenceNumber=e}}class Os{constructor(e){this.persistence=e,this.Fs=new Ro,this.$s=null}static Bs(e){return new Os(e)}get Ls(){if(this.$s)return this.$s;throw E()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),f.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),f.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),f.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(s=>this.Ls.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(i=>this.Ls.add(i.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return f.forEach(this.Ls,r=>{const s=I.fromPath(r);return this.qs(e,s).next(i=>{i||t.removeEntry(s,A.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return f.or([()=>f.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class lp{constructor(e){this.yt=e}$(e,t,r,s){const i=new ms("createOrUpgrade",t);var a;r<1&&s>=1&&(e.createObjectStore("owner"),(a=e).createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",eh,{unique:!0}),a.createObjectStore("documentMutations"),Rh(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=f.resolve();return r<3&&s>=3&&(0!==r&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),Rh(e)),o=o.next(()=>function(a){const u=a.store("targetGlobal"),c={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:A.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",c)}(i))),r<4&&s>=4&&(0!==r&&(o=o.next(()=>function(a,u){return u.store("mutations").W().next(c=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",eh,{unique:!0});const l=u.store("mutations"),h=c.map(d=>l.put(d));return f.waitFor(h)})}(e,i))),o=o.next(()=>{!function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&s>=5&&(o=o.next(()=>this.Us(i))),r<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(i)))),r<7&&s>=7&&(o=o.next(()=>this.Gs(i))),r<8&&s>=8&&(o=o.next(()=>this.Qs(e,i))),r<9&&s>=9&&(o=o.next(()=>{!function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&s>=10&&(o=o.next(()=>this.js(i))),r<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&s>=12&&(o=o.next(()=>{!function(a){const u=a.createObjectStore("documentOverlays",{keyPath:Mg});u.createIndex("collectionPathOverlayIndex",Lg,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",Og,{unique:!1})}(e)})),r<13&&s>=13&&(o=o.next(()=>function(a){const u=a.createObjectStore("remoteDocumentsV14",{keyPath:Tg});u.createIndex("documentKeyIndex",Eg),u.createIndex("collectionGroupIndex",Sg)}(e)).next(()=>this.Ws(e,i)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&s>=14&&(o=o.next(()=>this.zs(e,i))),r<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:Ng}).createIndex("sequenceNumberIndex",kg,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:Rg}).createIndex("documentKeyIndex",Fg,{unique:!1})}(e))),o}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,s)=>{t+=Fs(s)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Us(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(s=>f.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,-1],[i.userId,i.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>f.forEach(a,u=>{S(u.userId===i.userId);const c=Vt(this.yt,u);return _h(e,i.userId,c).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const i=[];return r.Z((o,a)=>{const u=new M(o),c=[0,xe(u)];i.push(t.get(c).next(l=>l?f.resolve():t.put({targetId:0,path:xe(u),sequenceNumber:s.highestListenSequenceNumber})))}).next(()=>f.waitFor(i))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:Dg});const r=t.store("collectionParents"),s=new ko,i=o=>{if(s.add(o)){const a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:xe(u)})}};return t.store("remoteDocuments").Z({X:!0},(o,a)=>{const u=new M(o);return i(u.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([o,a,u],c)=>{const l=Ue(a);return i(l.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,s)=>{const i=mr(s),o=ah(this.yt,i);return t.put(o)})}Ws(e,t){const r=t.store("remoteDocuments"),s=[];return r.Z((i,o)=>{const a=t.store("remoteDocumentsV14"),u=(c=o,c.document?new I(M.fromString(c.document.name).popFirst(5)):c.noDocument?I.fromSegments(c.noDocument.path):c.unknownDocument?I.fromSegments(c.unknownDocument.path):E()).path.toArray();var c;const l={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(l))}).next(()=>f.waitFor(s))}zs(e,t){const r=t.store("mutations"),s=bh(this.yt),i=new kh(Os.Bs,this.yt.ie);return r.W().next(o=>{const a=new Map;return o.forEach(u=>{var c;let l=null!==(c=a.get(u.userId))&&void 0!==c?c:k();Vt(this.yt,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),f.forEach(a,(u,c)=>{const l=new le(c),h=Ds.re(this.yt,l),d=i.getIndexManager(l),g=Ms.re(l,this.yt,d,i.referenceDelegate);return new Nh(s,g,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Io(t,ke.at),u).next()})})}}function Rh(n){n.createObjectStore("targetDocuments",{keyPath:Cg}).createIndex("documentTargetsIndex",Ag,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",bg,{unique:!0}),n.createObjectStore("targetGlobal")}const Fo="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Mo{constructor(e,t,r,s,i,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=i,this.window=o,this.document=a,this.Js=c,this.Ys=l,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!Mo.C())throw new y(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Jg(this,s),this.ii=t+"main",this.yt=new ih(u),this.ri=new Me(this.ii,this.Xs,new lp(this.yt)),this.Cs=new Wg(this.referenceDelegate,this.yt),this.remoteDocumentCache=bh(this.yt),this.Ns=new Ug,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===l&&ne("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,Fo);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ke(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var r=(0,p.Z)(function*(s){if(t.started)return e(s)});return function(s){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,p.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,p.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Vs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(rt(e))return w("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return w("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return _r(e).get("owner").next(t=>f.resolve(this.mi(t)))}gi(e){return Vs(e).delete(this.clientId)}yi(){var e=this;return(0,p.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const s=he(r,"clientMetadata");return s.W().next(i=>{const o=e.Ii(i,18e5),a=i.filter(u=>-1===o.indexOf(u));return f.forEach(a,u=>s.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(e.oi)for(const r of t)e.oi.removeItem(e.Ti(r.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?f.resolve(!0):_r(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,Fo);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vs(e).W().next(r=>void 0===this.Ii(r,5e3).find(s=>!(this.clientId===s.clientId||!(!this.networkEnabled&&s.networkEnabled||!this.inForeground&&s.inForeground&&this.networkEnabled===s.networkEnabled))))}).next(t=>(this.isPrimary!==t&&w("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,p.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Io(t,ke.at);return e._i(r).next(()=>e.gi(r))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>Vs(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Ms.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Zg(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Ds.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){w("IndexedDbPersistence","Starting transaction:",e);const s="readonly"===t?"readonly":"readwrite",i=15===(o=this.Xs)?Pg:14===o?sh:13===o?rh:12===o?Vg:11===o?nh:void E();var o;let a;return this.ri.runTransaction(e,s,i,u=>(a=new Io(u,this.Ss?this.Ss.next():ke.at),"readwrite-primary"===t?this.fi(a).next(c=>!!c||this.di(a)).next(c=>{if(!c)throw ne(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new y(m.FAILED_PRECONDITION,Gc);return r(a)}).next(c=>this.wi(a).next(()=>c)):this.Vi(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Vi(e){return _r(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(m.FAILED_PRECONDITION,Fo)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return _r(e).put("owner",t)}static C(){return Me.C()}_i(e){const t=_r(e);return t.get("owner").next(r=>this.mi(r)?(w("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):f.resolve())}pi(e,t){const r=Date.now();return!(e<r-t||e>r&&(ne(`Detected an update time that is in the future: ${e} > ${r}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,K.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return w("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ne("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){ne("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function _r(n){return he(n,"owner")}function Vs(n){return he(n,"clientMetadata")}function Lo(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Oo{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=s}static Ci(e,t){let r=k(),s=k();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Oo(e,t.fromCache,r,s)}}class Fh{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,s){return this.ki(e,t).next(i=>i||this.Oi(e,t,s,r)).next(i=>i||this.Mi(e,t))}ki(e,t){if(gl(t))return f.resolve(null);let r=Ie(t);return this.indexManager.getIndexType(e,r).next(s=>0===s?null:(null!==t.limit&&1===s&&(t=Is(t,null,"F"),r=Ie(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=k(...i);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{const c=this.Fi(t,a);return this.$i(t,c,o,u.readTime)?this.ki(e,Is(t,null,"F")):this.Bi(e,c,t,u)}))})))}Oi(e,t,r,s){return gl(t)||s.isEqual(A.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(i=>{const o=this.Fi(t,i);return this.$i(t,o,r,s)?this.Mi(e,t):(Yi()<=wt.in.DEBUG&&w("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),mo(t)),this.Bi(e,o,t,Uc(s,-1)))})}Fi(e,t){let r=new B(vl(e));return t.forEach((s,i)=>{go(e,i)&&(r=r.add(i))}),r}$i(e,t,r,s){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Mi(e,t){return Yi()<=wt.in.DEBUG&&w("QueryEngine","Using full collection scan to execute query:",mo(t)),this.Ni.getDocumentsMatchingQuery(e,t,Ne.min())}Bi(e,t,r,s){return this.Ni.getDocumentsMatchingQuery(e,r,s).next(i=>(t.forEach(o=>{i=i.insert(o.key,o)}),i))}}class hp{constructor(e,t,r,s){this.persistence=e,this.Li=t,this.yt=s,this.qi=new ee(N),this.Ui=new ct(i=>kt(i),rr),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Nh(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function Mh(n,e,t,r){return new hp(n,e,t,r)}function Lh(n,e){return Vo.apply(this,arguments)}function Vo(){return Vo=(0,p.Z)(function*(n,e){const t=x(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let u=k();for(const c of s){o.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}for(const c of i){a.push(c.batchId);for(const l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({ji:c,removedBatchIds:o,addedBatchIds:a}))})})}),Vo.apply(this,arguments)}function dp(n,e){const t=x(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=t.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,u,c){const l=u.batch,h=l.keys();let d=f.resolve();return h.forEach(g=>{d=d.next(()=>c.getEntry(a,g)).next(v=>{const T=u.docVersions.get(g);S(null!==T),v.version.compareTo(T)<0&&(l.applyToRemoteDocument(v,u),v.isValidDocument()&&(v.setReadTime(u.commitVersion),c.addEntry(v)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,l))}(t,r,e,i).next(()=>i.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(o){let a=k();for(let u=0;u<o.mutationResults.length;++u)o.mutationResults[u].transformResults.length>0&&(a=a.add(o.batch.mutations[u].key));return a}(e))).next(()=>t.localDocuments.getDocuments(r,s))})}function Oh(n){const e=x(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function fp(n,e){const t=x(n),r=e.snapshotVersion;let s=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=t.Gi.newChangeBuffer({trackRemovals:!0});s=t.qi;const a=[];e.targetChanges.forEach((l,h)=>{const d=s.get(h);if(!d)return;a.push(t.Cs.removeMatchingKeys(i,l.removedDocuments,h).next(()=>t.Cs.addMatchingKeys(i,l.addedDocuments,h)));let g=d.withSequenceNumber(i.currentSequenceNumber);var v,T,C;e.targetMismatches.has(h)?g=g.withResumeToken(ae.EMPTY_BYTE_STRING,A.min()).withLastLimboFreeSnapshotVersion(A.min()):l.resumeToken.approximateByteSize()>0&&(g=g.withResumeToken(l.resumeToken,r)),s=s.insert(h,g),T=g,C=l,(0===(v=d).resumeToken.approximateByteSize()||T.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8||C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0)&&a.push(t.Cs.updateTargetData(i,g))});let u=be(),c=k();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(i,l))}),a.push(Vh(i,o,e.documentUpdates).next(l=>{u=l.Wi,c=l.zi})),!r.isEqual(A.min())){const l=t.Cs.getLastRemoteSnapshotVersion(i).next(h=>t.Cs.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(l)}return f.waitFor(a).next(()=>o.apply(i)).next(()=>t.localDocuments.getLocalViewOfDocuments(i,u,c)).next(()=>u)}).then(i=>(t.qi=s,i))}function Vh(n,e,t){let r=k(),s=k();return t.forEach(i=>r=r.add(i)),e.getEntries(n,r).next(i=>{let o=be();return t.forEach((a,u)=>{const c=i.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),u.isNoDocument()&&u.version.isEqual(A.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):w("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{Wi:o,zi:s}})}function mp(n,e){const t=x(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function pn(n,e){const t=x(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return t.Cs.getTargetData(r,e).next(i=>i?(s=i,f.resolve(s)):t.Cs.allocateTargetId(r).next(o=>(s=new lt(e,o,0,r.currentSequenceNumber),t.Cs.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=t.qi.get(r.targetId);return(null===s||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.qi=t.qi.insert(r.targetId,r),t.Ui.set(e,r.targetId)),r})}function yn(n,e,t){return Po.apply(this,arguments)}function Po(){return Po=(0,p.Z)(function*(n,e,t){const r=x(n),s=r.qi.get(e),i=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!rt(o))throw o;w("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.qi=r.qi.remove(e),r.Ui.delete(s.target)}),Po.apply(this,arguments)}function Ps(n,e,t){const r=x(n);let s=A.min(),i=k();return r.persistence.runTransaction("Execute query","readonly",o=>function(a,u,c){const l=x(a),h=l.Ui.get(c);return void 0!==h?f.resolve(l.qi.get(h)):l.Cs.getTargetData(u,c)}(r,o,Ie(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(o,a.targetId).next(u=>{i=u})}).next(()=>r.Li.getDocumentsMatchingQuery(o,e,t?s:A.min(),t?i:k())).next(a=>(Uh(r,yl(e),a),{documents:a,Hi:i})))}function Ph(n,e){const t=x(n),r=x(t.Cs),s=t.qi.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",i=>r.ne(i,e).next(o=>o?o.target:null))}function qh(n,e){const t=x(n),r=t.Ki.get(e)||A.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Gi.getAllFromCollectionGroup(s,e,Uc(r,-1),Number.MAX_SAFE_INTEGER)).then(s=>(Uh(t,e,s),s))}function Uh(n,e,t){let r=n.Ki.get(e)||A.min();t.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),n.Ki.set(e,r)}function qo(){return qo=(0,p.Z)(function*(n,e,t,r){const s=x(n);let i=k(),o=be();for(const c of t){const l=e.Ji(c.metadata.name);c.document&&(i=i.add(l));const h=e.Yi(c);h.setReadTime(e.Xi(c.metadata.readTime)),o=o.insert(l,h)}const a=s.Gi.newChangeBuffer({trackRemovals:!0}),u=yield pn(s,(c=r,Ie(on(M.fromString(`__bundle__/docs/${c}`)))));var c;return s.persistence.runTransaction("Apply bundle documents","readwrite",c=>Vh(c,a,o).next(l=>(a.apply(c),l)).next(l=>s.Cs.removeMatchingKeysForTargetId(c,u.targetId).next(()=>s.Cs.addMatchingKeys(c,i,u.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(c,l.Wi,l.zi)).next(()=>l.Wi)))}),qo.apply(this,arguments)}function pp(n,e){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,p.Z)(function*(n,e,t=k()){const r=yield pn(n,Ie(So(e.bundledQuery))),s=x(n);return s.persistence.runTransaction("Save named query","readwrite",i=>{const o=re(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return s.Ns.saveNamedQuery(i,e);const a=r.withResumeToken(ae.EMPTY_BYTE_STRING,o);return s.qi=s.qi.insert(a.targetId,a),s.Cs.updateTargetData(i,a).next(()=>s.Cs.removeMatchingKeysForTargetId(i,r.targetId)).next(()=>s.Cs.addMatchingKeys(i,t,r.targetId)).next(()=>s.Ns.saveNamedQuery(i,e))})}),Uo.apply(this,arguments)}function Bh(n,e){return`firestore_clients_${n}_${e}`}function Gh(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Bo(n,e){return`firestore_targets_${n}_${e}`}class qs{constructor(e,t,r,s){this.user=e,this.batchId=t,this.state=r,this.error=s}static Zi(e,t,r){const s=JSON.parse(r);let i,o="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return o&&s.error&&(o="string"==typeof s.error.message&&"string"==typeof s.error.code,o&&(i=new y(s.error.code,s.error.message))),o?new qs(e,t,s.state,i):(ne("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Ir{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Zi(e,t){const r=JSON.parse(t);let s,i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code,i&&(s=new y(r.error.code,r.error.message))),i?new Ir(e,r.state,s):(ne("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Us{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const r=JSON.parse(t);let s="object"==typeof r&&r.activeTargetIds instanceof Array,i=Ss();for(let o=0;s&&o<r.activeTargetIds.length;++o)s=Qc(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return s?new Us(e,i):(ne("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Go{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Go(t.clientId,t.onlineState):(ne("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ko{constructor(){this.activeTargetIds=Ss()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class jo{constructor(e,t,r,s,i){this.window=e,this.Hs=t,this.persistenceKey=r,this.sr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new ee(N),this.started=!1,this.cr=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=Bh(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new Ko),this.lr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,p.Z)(function*(){const t=yield e.syncEngine.vi();for(const s of t){if(s===e.sr)continue;const i=e.getItem(Bh(e.persistenceKey,s));if(i){const o=Us.Zi(s,i);o&&(e.ur=e.ur.insert(o.clientId,o))}}e.gr();const r=e.storage.getItem(e.wr);if(r){const s=e.yr(r);s&&e.pr(s)}for(const s of e.cr)e.rr(s);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((r,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,r){this.Tr(e,t,r),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Bo(this.persistenceKey,e));if(r){const s=Ir.Zi(e,r);s&&(t=s.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Bo(this.persistenceKey,e))}updateQueryState(e,t,r){this.Rr(e,t,r)}handleUserChange(e,t,r){t.forEach(s=>{this.Er(s)}),this.currentUser=e,r.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return w("SharedClientState","READ",e,t),t}setItem(e,t){w("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){w("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(w("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ar)return void ne("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,p.Z)(function*(){if(t.started){if(null!==r.key)if(t.lr.test(r.key)){if(null==r.newValue){const s=t.vr(r.key);return t.Vr(s,null)}{const s=t.Sr(r.key,r.newValue);if(s)return t.Vr(s.clientId,s)}}else if(t.dr.test(r.key)){if(null!==r.newValue){const s=t.Dr(r.key,r.newValue);if(s)return t.Cr(s)}}else if(t._r.test(r.key)){if(null!==r.newValue){const s=t.Nr(r.key,r.newValue);if(s)return t.kr(s)}}else if(r.key===t.wr){if(null!==r.newValue){const s=t.yr(r.newValue);if(s)return t.pr(s)}}else if(r.key===t.hr){const s=function(i){let o=ke.at;if(null!=i)try{const a=JSON.parse(i);S("number"==typeof a),o=a}catch(a){ne("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(r.newValue);s!==ke.at&&t.sequenceNumberHandler(s)}else if(r.key===t.mr){const s=t.Or(r.newValue);yield Promise.all(s.map(i=>t.syncEngine.Mr(i)))}}else t.cr.push(r)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,r){const s=new qs(this.currentUser,e,t,r),i=Gh(this.persistenceKey,this.currentUser,e);this.setItem(i,s.tr())}Er(e){const t=Gh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,r){const s=Bo(this.persistenceKey,e),i=new Ir(e,t,r);this.setItem(s,i.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const r=this.vr(e);return Us.Zi(r,t)}Dr(e,t){const r=this.dr.exec(e),s=Number(r[1]);return qs.Zi(new le(void 0!==r[2]?r[2]:null),s,t)}Nr(e,t){const r=this._r.exec(e),s=Number(r[1]);return Ir.Zi(s,t)}yr(e){return Go.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,p.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);w("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const r=t?this.ur.insert(e,t):this.ur.remove(e),s=this.Ir(this.ur),i=this.Ir(r),o=[],a=[];return i.forEach(u=>{s.has(u)||o.push(u)}),s.forEach(u=>{i.has(u)||a.push(u)}),this.syncEngine.Br(o,a).then(()=>{this.ur=r})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=Ss();return e.forEach((r,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Kh{constructor(){this.Lr=new Ko,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,r){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Ko,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class yp{Ur(e){}shutdown(){}}class jh{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){w("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){w("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const vp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class wp{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class _p extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,s,i){const o=this.ho(e,t);w("RestConnection","Sending: ",o,r);const a={};return this.lo(a,s,i),this.fo(e,o,a,r).then(u=>(w("RestConnection","Received: ",u),u),u=>{throw Et("RestConnection",`${e} failed with error: `,u,"url: ",o,"request:",r),u})}_o(e,t,r,s,i,o){return this.ao(e,t,r,s,i)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Jt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}ho(e,t){return`${this.oo}/v1/${t}:${vp[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,s){return new Promise((i,o)=>{const a=new wm;a.setWithCredentials(!0),a.listenOnce(pm.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Hi.NO_ERROR:const c=a.getResponseJson();w("Connection","XHR received:",JSON.stringify(c)),i(c);break;case Hi.TIMEOUT:w("Connection",'RPC "'+e+'" timed out'),o(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case Hi.HTTP_ERROR:const l=a.getStatus();if(w("Connection",'RPC "'+e+'" failed with status:',l,"response text:",a.getResponseText()),l>0){let h=a.getResponseJson();Array.isArray(h)&&(h=h[0]);const d=null==h?void 0:h.error;if(d&&d.status&&d.message){const g=function(v){const T=v.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(T)>=0?T:m.UNKNOWN}(d.status);o(new y(g,d.message))}else o(new y(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new y(m.UNAVAILABLE,"Connection failed."));break;default:E()}}finally{w("Connection",'RPC "'+e+'" completed.')}});const u=JSON.stringify(s);a.send(t,"POST",u,r,15)})}wo(e,t,r){const s=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=mm(),o=gm(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new vm({})),this.lo(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const u=s.join("");w("Connection","Creating WebChannel: "+u,a);const c=i.createWebChannel(u,a);let l=!1,h=!1;const d=new wp({Hr:v=>{h?w("Connection","Not sending because WebChannel is closed:",v):(l||(w("Connection","Opening WebChannel transport."),c.open(),l=!0),w("Connection","WebChannel sending:",v),c.send(v))},Jr:()=>c.close()}),g=(v,T,C)=>{v.listen(T,G=>{try{C(G)}catch(H){setTimeout(()=>{throw H},0)}})};return g(c,hs.EventType.OPEN,()=>{h||w("Connection","WebChannel transport opened.")}),g(c,hs.EventType.CLOSE,()=>{h||(h=!0,w("Connection","WebChannel transport closed"),d.io())}),g(c,hs.EventType.ERROR,v=>{h||(h=!0,Et("Connection","WebChannel transport errored:",v),d.io(new y(m.UNAVAILABLE,"The operation could not be completed")))}),g(c,hs.EventType.MESSAGE,v=>{var T;if(!h){const C=v.data[0];S(!!C);const H=C.error||(null===(T=C[0])||void 0===T?void 0:T.error);if(H){w("Connection","WebChannel received error:",H);const O=H.status;let te=function(q){const ue=ie[q];if(void 0!==ue)return Fl(ue)}(O),V=H.message;void 0===te&&(te=m.INTERNAL,V="Unknown error status: "+O+" with message "+H.message),h=!0,d.io(new y(te,V)),c.close()}else w("Connection","WebChannel received:",C),d.ro(C)}}),g(o,ym.STAT_EVENT,v=>{v.stat===Mc.PROXY?w("Connection","Detected buffering proxy"):v.stat===Mc.NOPROXY&&w("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}function $h(){return typeof window<"u"?window:null}function Bs(){return typeof document<"u"?document:null}function xr(n){return new hg(n,!0)}class $o{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=s,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),s=Math.max(0,t-r);s>0&&w("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,s,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class zh{constructor(e,t,r,s,i,o,a,u){this.Hs=e,this.vo=r,this.Vo=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new $o(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,p.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,p.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var r=this;return(0,p.Z)(function*(){r.Lo(),r.qo(),r.xo.cancel(),r.So++,4!==e?r.xo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(ne(t.toString()),ne("Using maximum backoff delay to prevent overloading the backend."),r.xo.Ao()):t&&t.code===m.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Uo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.So===t&&this.Go(r,s)},r=>{e(()=>{const s=new y(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Qo(s)})})}Go(e,t){const r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(s=>{r(()=>this.Qo(s))}),this.stream.onMessage(s=>{r(()=>this.onMessage(s))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,p.Z)(function*(){e.state=0,e.start()}))}Qo(e){return w("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(w("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ip extends zh{constructor(e,t,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,o),this.yt=i}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function mg(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(u=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===u?1:"REMOVE"===u?2:"CURRENT"===u?3:"RESET"===u?4:E(),s=e.targetChange.targetIds||[],i=function(u,c){return u.wt?(S(void 0===c||"string"==typeof c),ae.fromBase64String(c||"")):(S(void 0===c||c instanceof Uint8Array),ae.fromUint8Array(c||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const c=void 0===u.code?m.UNKNOWN:Fl(u.code);return new y(c,u.message||"")}(o);t=new Pl(r,s,i,a||null)}else if("documentChange"in e){const r=e.documentChange,s=qe(n,r.document.name),i=re(r.document.updateTime),o=r.document.createTime?re(r.document.createTime):A.min(),a=new pe({mapValue:{fields:r.document.fields}}),u=j.newFoundDocument(s,i,o,a);t=new bs(r.targetIds||[],r.removedTargetIds||[],u.key,u)}else if("documentDelete"in e){const r=e.documentDelete,s=qe(n,r.document),i=r.readTime?re(r.readTime):A.min(),o=j.newNoDocument(s,i);t=new bs([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in e){const r=e.documentRemove,s=qe(n,r.document);t=new bs([],r.removedTargetIds||[],s,null)}else{if(!("filter"in e))return E();{const r=e.filter,i=new ng(r.count||0);t=new Vl(r.targetId,i)}}var u;return t}(this.yt,e),r=function(s){if(!("targetChange"in s))return A.min();const i=s.targetChange;return i.targetIds&&i.targetIds.length?A.min():i.readTime?re(i.readTime):A.min()}(e);return this.listener.Wo(t,r)}zo(e){const t={};t.database=dr(this.yt),t.addTarget=function(s,i){let o;const a=i.target;return o=vs(a)?{documents:Zl(s,a)}:{query:_o(s,a)},o.targetId=i.targetId,i.resumeToken.approximateByteSize()>0?o.resumeToken=Gl(s,i.resumeToken):i.snapshotVersion.compareTo(A.min())>0&&(o.readTime=hn(s,i.snapshotVersion.toTimestamp())),o}(this.yt,e);const r=function pg(n,e){const t=function(r,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return E()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=dr(this.yt),t.removeTarget=e,this.Bo(t)}}class xp extends zh{constructor(e,t,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,o),this.yt=i,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(S(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function gg(n,e){return n&&n.length>0?(S(void 0!==e),n.map(t=>function(r,s){let i=re(r.updateTime?r.updateTime:s);return i.isEqual(A.min())&&(i=re(s)),new Jm(i,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=re(e.commitTime);return this.listener.Zo(r,t)}return S(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=dr(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>fr(this.yt,r))};this.Bo(t)}}class Tp extends class{}{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.yt=s,this.nu=!1}su(){if(this.nu)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,i])=>this.connection.ao(e,t,r,s,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(m.UNKNOWN,s.toString())})}_o(e,t,r,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection._o(e,t,r,i,o,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new y(m.UNKNOWN,i.toString())})}terminate(){this.nu=!0}}class Sp{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(ne(t),this.ou=!1):w("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class bp{constructor(e,t,r,s,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.Ur(a=>{r.enqueueAndForget((0,p.Z)(function*(){var u;We(o)&&(w("RemoteStore","Restarting streams for network reachability change."),yield(u=(0,p.Z)(function*(c){const l=x(c);l._u.add(4),yield vn(l),l.gu.set("Unknown"),l._u.delete(4),yield Tr(l)}),function(c){return u.apply(this,arguments)})(o))}))}),this.gu=new Sp(r,s)}}function Tr(n){return Qo.apply(this,arguments)}function Qo(){return Qo=(0,p.Z)(function*(n){if(We(n))for(const e of n.wu)yield e(!0)}),Qo.apply(this,arguments)}function vn(n){return Zo.apply(this,arguments)}function Zo(){return Zo=(0,p.Z)(function*(n){for(const e of n.wu)yield e(!1)}),Zo.apply(this,arguments)}function Gs(n,e){const t=x(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Yo(t)?Ho(t):_n(t).ko()&&Wo(t,e))}function Er(n,e){const t=x(n),r=_n(t);t.du.delete(e),r.ko()&&Qh(t,e),0===t.du.size&&(r.ko()?r.Fo():We(t)&&t.gu.set("Unknown"))}function Wo(n,e){n.yu.Ot(e.targetId),_n(n).zo(e)}function Qh(n,e){n.yu.Ot(e),_n(n).Ho(e)}function Ho(n){n.yu=new ag({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),_n(n).start(),n.gu.uu()}function Yo(n){return We(n)&&!_n(n).No()&&n.du.size>0}function We(n){return 0===x(n)._u.size}function Zh(n){n.yu=void 0}function Cp(n){return Xo.apply(this,arguments)}function Xo(){return Xo=(0,p.Z)(function*(n){n.du.forEach((e,t)=>{Wo(n,e)})}),Xo.apply(this,arguments)}function Ap(n,e){return Jo.apply(this,arguments)}function Jo(){return Jo=(0,p.Z)(function*(n,e){Zh(n),Yo(n)?(n.gu.hu(e),Ho(n)):n.gu.set("Unknown")}),Jo.apply(this,arguments)}function Dp(n,e,t){return ea.apply(this,arguments)}function ea(){return ea=(0,p.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof Pl&&2===e.state&&e.cause)try{yield(r=(0,p.Z)(function*(s,i){const o=i.cause;for(const a of i.targetIds)s.du.has(a)&&(yield s.remoteSyncer.rejectListen(a,o),s.du.delete(a),s.yu.removeTarget(a))}),function(s,i){return r.apply(this,arguments)})(n,e)}catch(r){w("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ks(n,r)}else if(e instanceof bs?n.yu.Kt(e):e instanceof Vl?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(A.min()))try{const r=yield Oh(n.localStore);t.compareTo(r)>=0&&(yield function(s,i){const o=s.yu.Zt(i);return o.targetChanges.forEach((a,u)=>{if(a.resumeToken.approximateByteSize()>0){const c=s.du.get(u);c&&s.du.set(u,c.withResumeToken(a.resumeToken,i))}}),o.targetMismatches.forEach(a=>{const u=s.du.get(a);if(!u)return;s.du.set(a,u.withResumeToken(ae.EMPTY_BYTE_STRING,u.snapshotVersion)),Qh(s,a);const c=new lt(u.target,a,1,u.sequenceNumber);Wo(s,c)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t))}catch(r){w("RemoteStore","Failed to raise snapshot:",r),yield Ks(n,r)}var r}),ea.apply(this,arguments)}function Ks(n,e,t){return ta.apply(this,arguments)}function ta(){return ta=(0,p.Z)(function*(n,e,t){if(!rt(e))throw e;n._u.add(1),yield vn(n),n.gu.set("Offline"),t||(t=()=>Oh(n.localStore)),n.asyncQueue.enqueueRetryable((0,p.Z)(function*(){w("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Tr(n)}))}),ta.apply(this,arguments)}function Wh(n,e){return e().catch(t=>Ks(n,t,e))}function wn(n){return na.apply(this,arguments)}function na(){return na=(0,p.Z)(function*(n){const e=x(n),t=mt(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;Np(e);)try{const s=yield mp(e.localStore,r);if(null===s){0===e.fu.length&&t.Fo();break}r=s.batchId,kp(e,s)}catch(s){yield Ks(e,s)}Hh(e)&&Yh(e)}),na.apply(this,arguments)}function Np(n){return We(n)&&n.fu.length<10}function kp(n,e){n.fu.push(e);const t=mt(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function Hh(n){return We(n)&&!mt(n).No()&&n.fu.length>0}function Yh(n){mt(n).start()}function Rp(n){return ra.apply(this,arguments)}function ra(){return ra=(0,p.Z)(function*(n){mt(n).eu()}),ra.apply(this,arguments)}function Fp(n){return sa.apply(this,arguments)}function sa(){return sa=(0,p.Z)(function*(n){const e=mt(n);for(const t of n.fu)e.Xo(t.mutations)}),sa.apply(this,arguments)}function Mp(n,e,t){return ia.apply(this,arguments)}function ia(){return ia=(0,p.Z)(function*(n,e,t){const r=n.fu.shift(),s=To.from(r,e,t);yield Wh(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),yield wn(n)}),ia.apply(this,arguments)}function Lp(n,e){return oa.apply(this,arguments)}function oa(){return oa=(0,p.Z)(function*(n,e){var t;e&&mt(n).Yo&&(yield(t=(0,p.Z)(function*(r,s){if(Rl(i=s.code)&&i!==m.ABORTED){const o=r.fu.shift();mt(r).Mo(),yield Wh(r,()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s)),yield wn(r)}var i}),function(r,s){return t.apply(this,arguments)})(n,e)),Hh(n)&&Yh(n)}),oa.apply(this,arguments)}function Xh(n,e){return aa.apply(this,arguments)}function aa(){return aa=(0,p.Z)(function*(n,e){const t=x(n);t.asyncQueue.verifyOperationInProgress(),w("RemoteStore","RemoteStore received new credentials");const r=We(t);t._u.add(3),yield vn(t),r&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Tr(t)}),aa.apply(this,arguments)}function ua(n,e){return ca.apply(this,arguments)}function ca(){return ca=(0,p.Z)(function*(n,e){const t=x(n);e?(t._u.delete(2),yield Tr(t)):e||(t._u.add(2),yield vn(t),t.gu.set("Unknown"))}),ca.apply(this,arguments)}function _n(n){return n.pu||(n.pu=function(e,t,r){const s=x(e);return s.su(),new Ip(t,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,r)}(n.datastore,n.asyncQueue,{Yr:Cp.bind(null,n),Zr:Ap.bind(null,n),Wo:Dp.bind(null,n)}),n.wu.push(function(){var e=(0,p.Z)(function*(t){t?(n.pu.Mo(),Yo(n)?Ho(n):n.gu.set("Unknown")):(yield n.pu.stop(),Zh(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function mt(n){return n.Iu||(n.Iu=function(e,t,r){const s=x(e);return s.su(),new xp(t,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,r)}(n.datastore,n.asyncQueue,{Yr:Rp.bind(null,n),Zr:Lp.bind(null,n),tu:Fp.bind(null,n),Zo:Mp.bind(null,n)}),n.wu.push(function(){var e=(0,p.Z)(function*(t){t?(n.Iu.Mo(),yield wn(n)):(yield n.Iu.stop(),n.fu.length>0&&(w("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class la{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new oe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,r,s,i){const o=Date.now()+r,a=new la(e,t,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function In(n,e){if(ne("AsyncQueue",`${e}: ${n}`),rt(n))return new y(m.UNAVAILABLE,`${e}: ${n}`);throw n}class xn{constructor(e){this.comparator=e?(t,r)=>e(t,r)||I.comparator(t.key,r.key):(t,r)=>I.comparator(t.key,r.key),this.keyedMap=ar(),this.sortedSet=new ee(this.comparator)}static emptySet(e){return new xn(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xn)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new xn;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Jh{constructor(){this.Tu=new ee(I.comparator)}track(e){const t=e.doc.key,r=this.Tu.get(t);r?0!==e.type&&3===r.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==r.type?this.Tu=this.Tu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Tu=this.Tu.remove(t):1===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):E():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Tn{constructor(e,t,r,s,i,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,s,i){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new Tn(e,t,xn.emptySet(t),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&sr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class Op{constructor(){this.Au=void 0,this.listeners=[]}}class Vp{constructor(){this.queries=new ct(e=>pl(e),sr),this.onlineState="Unknown",this.Ru=new Set}}function ha(n,e){return da.apply(this,arguments)}function da(){return da=(0,p.Z)(function*(n,e){const t=x(n),r=e.query;let s=!1,i=t.queries.get(r);if(i||(s=!0,i=new Op),s)try{i.Au=yield t.onListen(r)}catch(o){const a=In(o,`Initialization of query '${mo(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,i),i.listeners.push(e),e.bu(t.onlineState),i.Au&&e.Pu(i.Au)&&ga(t)}),da.apply(this,arguments)}function fa(n,e){return ma.apply(this,arguments)}function ma(){return ma=(0,p.Z)(function*(n,e){const t=x(n),r=e.query;let s=!1;const i=t.queries.get(r);if(i){const o=i.listeners.indexOf(e);o>=0&&(i.listeners.splice(o,1),s=0===i.listeners.length)}if(s)return t.queries.delete(r),t.onUnlisten(r)}),ma.apply(this,arguments)}function Pp(n,e){const t=x(n);let r=!1;for(const s of e){const o=t.queries.get(s.query);if(o){for(const a of o.listeners)a.Pu(s)&&(r=!0);o.Au=s}}r&&ga(t)}function qp(n,e,t){const r=x(n),s=r.queries.get(e);if(s)for(const i of s.listeners)i.onError(t);r.queries.delete(e)}function ga(n){n.Ru.forEach(e=>{e.next()})}class pa{constructor(e,t,r){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}Pu(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)3!==s.type&&r.push(s);e=new Tn(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=Tn.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Up{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class ed{constructor(e){this.yt=e}Ji(e){return qe(this.yt,e)}Yi(e){return e.metadata.exists?Ql(this.yt,e.document,!1):j.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return re(e)}}class Bp{constructor(e,t,r){this.Mu=e,this.localStore=t,this.yt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=td(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const r=M.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,r=new ed(this.yt);for(const s of e)if(s.metadata.queries){const i=r.Ji(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||k()).add(i);t.set(o,a)}}return t}complete(){var e=this;return(0,p.Z)(function*(){const t=yield function gp(n,e,t,r){return qo.apply(this,arguments)}(e.localStore,new ed(e.yt),e.documents,e.Mu.id),r=e.$u(e.documents);for(const s of e.queries)yield pp(e.localStore,s,r.get(s.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function td(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class nd{constructor(e){this.key=e}}class rd{constructor(e){this.key=e}}class sd{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=k(),this.mutatedKeys=k(),this.Gu=vl(e),this.Qu=new xn(this.Gu)}get ju(){return this.qu}Wu(e,t){const r=t?t.zu:new Jh,s=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const u="F"===this.query.limitType&&s.size===this.query.limit?s.last():null,c="L"===this.query.limitType&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((l,h)=>{const d=s.get(l),g=go(this.query,h)?h:null,v=!!d&&this.mutatedKeys.has(d.key),T=!!g&&(g.hasLocalMutations||this.mutatedKeys.has(g.key)&&g.hasCommittedMutations);let C=!1;d&&g?d.data.isEqual(g.data)?v!==T&&(r.track({type:3,doc:g}),C=!0):this.Hu(d,g)||(r.track({type:2,doc:g}),C=!0,(u&&this.Gu(g,u)>0||c&&this.Gu(g,c)<0)&&(a=!0)):!d&&g?(r.track({type:0,doc:g}),C=!0):d&&!g&&(r.track({type:1,doc:d}),C=!0,(u||c)&&(a=!0)),C&&(g?(o=o.add(g),i=T?i.add(l):i.delete(l)):(o=o.delete(l),i=i.delete(l)))}),null!==this.query.limit)for(;o.size>this.query.limit;){const l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Qu:o,zu:r,$i:a,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const s=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Eu();i.sort((c,l)=>function(h,d){const g=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return E()}};return g(h)-g(d)}(c.type,l.type)||this.Gu(c.doc,l.doc)),this.Ju(r);const o=t?this.Yu():[],a=0===this.Ku.size&&this.current?1:0,u=a!==this.Uu;return this.Uu=a,0!==i.length||u?{snapshot:new Tn(this.query,e.Qu,s,i,e.mutatedKeys,0===a,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Jh,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=k(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new rd(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new nd(r))}),t}tc(e){this.qu=e.Hi,this.Ku=k();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Tn.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Gp{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Kp{constructor(e){this.key=e,this.nc=!1}}class jp{constructor(e,t,r,s,i,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new ct(a=>pl(a),sr),this.rc=new Map,this.oc=new Set,this.uc=new ee(I.comparator),this.cc=new Map,this.ac=new Ro,this.hc={},this.lc=new Map,this.fc=Ut.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function $p(n,e){return ya.apply(this,arguments)}function ya(){return ya=(0,p.Z)(function*(n,e){const t=Ua(n);let r,s;const i=t.ic.get(e);if(i)r=i.targetId,t.sharedClientState.addLocalQueryTarget(r),s=i.view.ec();else{const o=yield pn(t.localStore,Ie(e));t.isPrimaryClient&&Gs(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,s=yield va(t,e,r,"current"===a,o.resumeToken)}return s}),ya.apply(this,arguments)}function va(n,e,t,r,s){return wa.apply(this,arguments)}function wa(){return wa=(0,p.Z)(function*(n,e,t,r,s){n._c=(h,d,g)=>{return(v=(0,p.Z)(function*(T,C,G,H){let O=C.view.Wu(G);O.$i&&(O=yield Ps(T.localStore,C.query,!1).then(({documents:q})=>C.view.Wu(q,O)));const te=H&&H.targetChanges.get(C.targetId),V=C.view.applyChanges(O,T.isPrimaryClient,te);return Da(T,C.targetId,V.Xu),V.snapshot}),function(T,C,G,H){return v.apply(this,arguments)})(n,h,d,g);var v};const i=yield Ps(n.localStore,e,!0),o=new sd(e,i.Hi),a=o.Wu(i.documents),u=lr.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,s),c=o.applyChanges(a,n.isPrimaryClient,u);Da(n,t,c.Xu);const l=new Gp(e,t,o);return n.ic.set(e,l),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),c.snapshot}),wa.apply(this,arguments)}function zp(n,e){return _a.apply(this,arguments)}function _a(){return _a=(0,p.Z)(function*(n,e){const t=x(n),r=t.ic.get(e),s=t.rc.get(r.targetId);if(s.length>1)return t.rc.set(r.targetId,s.filter(i=>!sr(i,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield yn(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Er(t.remoteStore,r.targetId),En(t,r.targetId)}).catch(nt))):(En(t,r.targetId),yield yn(t.localStore,r.targetId,!0))}),_a.apply(this,arguments)}function Ia(){return Ia=(0,p.Z)(function*(n,e,t){const r=Ba(n);try{const s=yield function(i,o){const a=x(i),u=Z.now(),c=o.reduce((d,g)=>d.add(g.key),k());let l,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let g=be(),v=k();return a.Gi.getEntries(d,c).next(T=>{g=T,g.forEach((C,G)=>{G.isValidDocument()||(v=v.add(C))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,g)).next(T=>{l=T;const C=[];for(const G of o){const H=tg(G,l.get(G.key).overlayedDocument);null!=H&&C.push(new Ze(G.key,H,hl(H.value.mapValue),W.exists(!0)))}return a.mutationQueue.addMutationBatch(d,u,C,o)}).next(T=>{h=T;const C=T.applyToLocalDocumentSet(l,v);return a.documentOverlayCache.saveOverlays(d,T.batchId,C)})}).then(()=>({batchId:h.batchId,changes:Ll(l)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(i,o,a){let u=i.hc[i.currentUser.toKey()];u||(u=new ee(N)),u=u.insert(o,a),i.hc[i.currentUser.toKey()]=u}(r,s.batchId,t),yield He(r,s.changes),yield wn(r.remoteStore)}catch(s){const i=In(s,"Failed to persist write");t.reject(i)}}),Ia.apply(this,arguments)}function id(n,e){return xa.apply(this,arguments)}function xa(){return xa=(0,p.Z)(function*(n,e){const t=x(n);try{const r=yield fp(t.localStore,e);e.targetChanges.forEach((s,i)=>{const o=t.cc.get(i);o&&(S(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.nc=!0:s.modifiedDocuments.size>0?S(o.nc):s.removedDocuments.size>0&&(S(o.nc),o.nc=!1))}),yield He(t,r,e)}catch(r){yield nt(r)}}),xa.apply(this,arguments)}function od(n,e,t){const r=x(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const s=[];r.ic.forEach((i,o)=>{const a=o.view.bu(e);a.snapshot&&s.push(a.snapshot)}),function(i,o){const a=x(i);a.onlineState=o;let u=!1;a.queries.forEach((c,l)=>{for(const h of l.listeners)h.bu(o)&&(u=!0)}),u&&ga(a)}(r.eventManager,e),s.length&&r.sc.Wo(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Zp(n,e,t){return Ta.apply(this,arguments)}function Ta(){return Ta=(0,p.Z)(function*(n,e,t){const r=x(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.cc.get(e),i=s&&s.key;if(i){let o=new ee(I.comparator);o=o.insert(i,j.newNoDocument(i,A.min()));const a=k().add(i),u=new cr(A.min(),new Map,new B(N),o,a);yield id(r,u),r.uc=r.uc.remove(i),r.cc.delete(e),Na(r)}else yield yn(r.localStore,e,!1).then(()=>En(r,e,t)).catch(nt)}),Ta.apply(this,arguments)}function Wp(n,e){return Ea.apply(this,arguments)}function Ea(){return Ea=(0,p.Z)(function*(n,e){const t=x(n),r=e.batch.batchId;try{const s=yield dp(t.localStore,e);Aa(t,r,null),Ca(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield He(t,s)}catch(s){yield nt(s)}}),Ea.apply(this,arguments)}function Hp(n,e,t){return Sa.apply(this,arguments)}function Sa(){return Sa=(0,p.Z)(function*(n,e,t){const r=x(n);try{const s=yield function(i,o){const a=x(i);return a.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let c;return a.mutationQueue.lookupMutationBatch(u,o).next(l=>(S(null!==l),c=l.keys(),a.mutationQueue.removeMutationBatch(u,l))).next(()=>a.mutationQueue.performConsistencyCheck(u)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(u,c,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,c)).next(()=>a.localDocuments.getDocuments(u,c))})}(r.localStore,e);Aa(r,e,t),Ca(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield He(r,s)}catch(s){yield nt(s)}}),Sa.apply(this,arguments)}function ba(){return ba=(0,p.Z)(function*(n,e){const t=x(n);We(t.remoteStore)||w("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(i){const o=x(i);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(-1===r)return void e.resolve();const s=t.lc.get(r)||[];s.push(e),t.lc.set(r,s)}catch(r){const s=In(r,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}),ba.apply(this,arguments)}function Ca(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function Aa(n,e,t){const r=x(n);let s=r.hc[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.hc[r.currentUser.toKey()]=s}}function En(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.rc.get(e))n.ic.delete(r),t&&n.sc.wc(r,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(r=>{n.ac.containsKey(r)||ad(n,r)})}function ad(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Er(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),Na(n))}function Da(n,e,t){for(const r of t)r instanceof nd?(n.ac.addReference(r.key,e),Xp(n,r)):r instanceof rd?(w("SyncEngine","Document no longer in limbo: "+r.key),n.ac.removeReference(r.key,e),n.ac.containsKey(r.key)||ad(n,r.key)):E()}function Xp(n,e){const t=e.key,r=t.path.canonicalString();n.uc.get(t)||n.oc.has(r)||(w("SyncEngine","New document in limbo: "+t),n.oc.add(r),Na(n))}function Na(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new I(M.fromString(e)),r=n.fc.next();n.cc.set(r,new Kp(t)),n.uc=n.uc.insert(t,r),Gs(n.remoteStore,new lt(Ie(on(t.path)),r,2,ke.at))}}function He(n,e,t){return ka.apply(this,arguments)}function ka(){return ka=(0,p.Z)(function*(n,e,t){const r=x(n),s=[],i=[],o=[];var a;r.ic.isEmpty()||(r.ic.forEach((a,u)=>{o.push(r._c(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,null!=c&&c.fromCache?"not-current":"current"),c){s.push(c);const l=Oo.Ci(u.targetId,c);i.push(l)}}))}),yield Promise.all(o),r.sc.Wo(s),yield(a=(0,p.Z)(function*(u,c){const l=x(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>f.forEach(c,d=>f.forEach(d.Si,g=>l.persistence.referenceDelegate.addReference(h,d.targetId,g)).next(()=>f.forEach(d.Di,g=>l.persistence.referenceDelegate.removeReference(h,d.targetId,g)))))}catch(h){if(!rt(h))throw h;w("LocalStore","Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const g=l.qi.get(d),T=g.withLastLimboFreeSnapshotVersion(g.snapshotVersion);l.qi=l.qi.insert(d,T)}}}),function(u,c){return a.apply(this,arguments)})(r.localStore,i))}),ka.apply(this,arguments)}function Jp(n,e){return Ra.apply(this,arguments)}function Ra(){return Ra=(0,p.Z)(function*(n,e){const t=x(n);if(!t.currentUser.isEqual(e)){w("SyncEngine","User change. New user:",e.toKey());const r=yield Lh(t.localStore,e);t.currentUser=e,(s=t).lc.forEach(o=>{o.forEach(a=>{a.reject(new y(m.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.lc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield He(t,r.ji)}var s}),Ra.apply(this,arguments)}function ey(n,e){const t=x(n),r=t.cc.get(e);if(r&&r.nc)return k().add(r.key);{let s=k();const i=t.rc.get(e);if(!i)return s;for(const o of i){const a=t.ic.get(o);s=s.unionWith(a.view.ju)}return s}}function ty(n,e){return Fa.apply(this,arguments)}function Fa(){return Fa=(0,p.Z)(function*(n,e){const t=x(n),r=yield Ps(t.localStore,e.query,!0),s=e.view.tc(r);return t.isPrimaryClient&&Da(t,e.targetId,s.Xu),s}),Fa.apply(this,arguments)}function ny(n,e){return Ma.apply(this,arguments)}function Ma(){return Ma=(0,p.Z)(function*(n,e){const t=x(n);return qh(t.localStore,e).then(r=>He(t,r))}),Ma.apply(this,arguments)}function ry(n,e,t,r){return La.apply(this,arguments)}function La(){return La=(0,p.Z)(function*(n,e,t,r){const s=x(n),i=yield function(o,a){const u=x(o),c=x(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",l=>c.Tn(l,a).next(h=>h?u.localDocuments.getDocuments(l,h):f.resolve(null)))}(s.localStore,e);var a;null!==i?("pending"===t?yield wn(s.remoteStore):"acknowledged"===t||"rejected"===t?(Aa(s,e,r||null),Ca(s,e),a=e,x(x(s.localStore).mutationQueue).An(a)):E(),yield He(s,i)):w("SyncEngine","Cannot apply mutation batch with id: "+e)}),La.apply(this,arguments)}function Oa(){return Oa=(0,p.Z)(function*(n,e){const t=x(n);if(Ua(t),Ba(t),!0===e&&!0!==t.dc){const r=t.sharedClientState.getAllActiveQueryTargets(),s=yield ud(t,r.toArray());t.dc=!0,yield ua(t.remoteStore,!0);for(const i of s)Gs(t.remoteStore,i)}else if(!1===e&&!1!==t.dc){const r=[];let s=Promise.resolve();t.rc.forEach((i,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):s=s.then(()=>(En(t,o),yn(t.localStore,o,!0))),Er(t.remoteStore,o)}),yield s,yield ud(t,r),function(i){const o=x(i);o.cc.forEach((a,u)=>{Er(o.remoteStore,u)}),o.ac.fs(),o.cc=new Map,o.uc=new ee(I.comparator)}(t),t.dc=!1,yield ua(t.remoteStore,!1)}}),Oa.apply(this,arguments)}function ud(n,e,t){return Va.apply(this,arguments)}function Va(){return Va=(0,p.Z)(function*(n,e,t){const r=x(n),s=[],i=[];for(const o of e){let a;const u=r.rc.get(o);if(u&&0!==u.length){a=yield pn(r.localStore,Ie(u[0]));for(const c of u){const l=r.ic.get(c),h=yield ty(r,l);h.snapshot&&i.push(h.snapshot)}}else{const c=yield Ph(r.localStore,o);a=yield pn(r.localStore,c),yield va(r,cd(c),o,!1,a.resumeToken)}s.push(a)}return r.sc.Wo(i),s}),Va.apply(this,arguments)}function cd(n){return ml(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function iy(n){const e=x(n);return x(x(e.localStore).persistence).vi()}function oy(n,e,t,r){return Pa.apply(this,arguments)}function Pa(){return Pa=(0,p.Z)(function*(n,e,t,r){const s=x(n);if(s.dc)return void w("SyncEngine","Ignoring unexpected query state notification.");const i=s.rc.get(e);if(i&&i.length>0)switch(t){case"current":case"not-current":{const o=yield qh(s.localStore,yl(i[0])),a=cr.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,ae.EMPTY_BYTE_STRING);yield He(s,o,a);break}case"rejected":yield yn(s.localStore,e,!0),En(s,e,r);break;default:E()}}),Pa.apply(this,arguments)}function ay(n,e,t){return qa.apply(this,arguments)}function qa(){return qa=(0,p.Z)(function*(n,e,t){const r=Ua(n);if(r.dc){for(const s of e){if(r.rc.has(s)){w("SyncEngine","Adding an already active target "+s);continue}const i=yield Ph(r.localStore,s),o=yield pn(r.localStore,i);yield va(r,cd(i),o.targetId,!1,o.resumeToken),Gs(r.remoteStore,o)}for(const s of t)r.rc.has(s)&&(yield yn(r.localStore,s,!1).then(()=>{Er(r.remoteStore,s),En(r,s)}).catch(nt))}}),qa.apply(this,arguments)}function Ua(n){const e=x(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=id.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ey.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Zp.bind(null,e),e.sc.Wo=Pp.bind(null,e.eventManager),e.sc.wc=qp.bind(null,e.eventManager),e}function Ba(n){const e=x(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Wp.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Hp.bind(null,e),e}class ld{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,p.Z)(function*(){t.yt=xr(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Mh(this.persistence,new Fh,e.initialUser,this.yt)}yc(e){return new kh(Os.Bs,this.yt)}gc(e){return new Kh}terminate(){var e=this;return(0,p.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class hd extends ld{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e),yield r.Ac.initialize(r,e),yield Ba(r.Ac.syncEngine),yield wn(r.Ac.remoteStore),yield r.persistence.li(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return Mh(this.persistence,new Fh,e.initialUser,this.yt)}Tc(e,t){return new Yg(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const r=new Lm(t,this.persistence);return new Mm(e.asyncQueue,r)}yc(e){const t=Lo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Ce.withCacheSize(this.cacheSizeBytes):Ce.DEFAULT;return new Mo(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,$h(),Bs(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Kh}}class cy extends hd{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,p.Z)(function*(){yield t().call(r,e);const s=r.Ac.syncEngine;r.sharedClientState instanceof jo&&(r.sharedClientState.syncEngine={Fr:ry.bind(null,s),$r:oy.bind(null,s),Br:ay.bind(null,s),vi:iy.bind(null,s),Mr:ny.bind(null,s)},yield r.sharedClientState.start()),yield r.persistence.li(function(){var i=(0,p.Z)(function*(o){yield function sy(n,e){return Oa.apply(this,arguments)}(r.Ac.syncEngine,o),r.gcScheduler&&(o&&!r.gcScheduler.started?r.gcScheduler.start():o||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(o&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():o||r.indexBackfillerScheduler.stop())});return function(o){return i.apply(this,arguments)}}())})()}gc(e){const t=$h();if(!jo.C(t))throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=Lo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new jo(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ga{initialize(e,t){var r=this;return(0,p.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=s=>od(r.syncEngine,s,1),r.remoteStore.remoteSyncer.handleCredentialChange=Jp.bind(null,r.syncEngine),yield ua(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Vp}createDatastore(e){const t=xr(e.databaseInfo.databaseId),r=new _p(e.databaseInfo);return new Tp(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,s=e.asyncQueue,i=a=>od(this.syncEngine,a,0),o=jh.C()?new jh:new yp,new bp(t,r,s,i,o);var t,r,s,i,o}createSyncEngine(e,t){return function(r,s,i,o,a,u,c){const l=new jp(r,s,i,o,a,u);return c&&(l.dc=!0),l}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,p.Z)(function*(t){const r=x(t);w("RemoteStore","RemoteStore shutting down."),r._u.add(5),yield vn(r),r.mu.shutdown(),r.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Ka(n,e,t){if(!t)throw new y(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dd(n,e,t,r){if(!0===e&&!0===r)throw new y(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function fd(n){if(!I.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function md(n){if(I.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function js(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":E()}function F(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=js(n);throw new y(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function gd(n,e){if(e<=0)throw new y(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const pd=new Map;class yd{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,dd("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Sr{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yd({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yd(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new xm;switch(t.type){case"gapi":return new bm(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new y(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=pd.get(e);t&&(w("ComponentProvider","Removing Datastore"),pd.delete(e),t.terminate())}(this),Promise.resolve()}}class ${constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Be(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new $(this.firestore,e,this._key)}}class ye{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new ye(this.firestore,e,this._query)}}class Be extends ye{constructor(e,t,r){super(e,t,on(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new $(this.firestore,null,new I(e))}withConverter(e){return new Be(this.firestore,e,this._path)}}function wd(n,e,...t){if(n=(0,K.m9)(n),Ka("collection","path",e),n instanceof Sr){const r=M.fromString(e,...t);return md(r),new Be(n,null,r)}{if(!(n instanceof $||n instanceof Be))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(M.fromString(e,...t));return md(r),new Be(n.firestore,null,r)}}function $s(n,e,...t){if(n=(0,K.m9)(n),1===arguments.length&&(e=Pc.R()),Ka("doc","path",e),n instanceof Sr){const r=M.fromString(e,...t);return fd(r),new $(n,null,new I(r))}{if(!(n instanceof $||n instanceof Be))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(M.fromString(e,...t));return fd(r),new $(n.firestore,n instanceof Be?n.converter:null,new I(r))}}function _d(n,e){return n=(0,K.m9)(n),e=(0,K.m9)(e),(n instanceof $||n instanceof Be)&&(e instanceof $||e instanceof Be)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function ja(n,e){return n=(0,K.m9)(n),e=(0,K.m9)(e),n instanceof ye&&e instanceof ye&&n.firestore===e.firestore&&sr(n._query,e._query)&&n.converter===e.converter}function Id(n,e=10240){let t=0;return{read:()=>(0,p.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,p.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class zs{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):ne("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class hy{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new oe,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(r=>{r&&r.Ou()?this.metadata.resolve(r.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.ku)}`))},r=>this.metadata.reject(r))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,p.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,p.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,p.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const r=e.vc.decode(t),s=Number(r);isNaN(s)&&e.Dc(`length string (${r}) is not valid number`);const i=yield e.Cc(s);return new Up(JSON.parse(i),t.length+s)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,p.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Cc(e){var t=this;return(0,p.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const r=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,p.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class my{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,p.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(s=(0,p.Z)(function*(i,o){const a=x(i),u=dr(a.yt)+"/documents",c={documents:o.map(g=>hr(a.yt,g))},l=yield a._o("BatchGetDocuments",u,c,o.length),h=new Map;l.forEach(g=>{const v=function fg(n,e){return"found"in e?function(t,r){S(!!r.found);const s=qe(t,r.found.name),i=re(r.found.updateTime),o=r.found.createTime?re(r.found.createTime):A.min(),a=new pe({mapValue:{fields:r.found.fields}});return j.newFoundDocument(s,i,o,a)}(n,e):"missing"in e?function(t,r){S(!!r.missing),S(!!r.readTime);const s=qe(t,r.missing),i=re(r.readTime);return j.newNoDocument(s,i)}(n,e):E()}(a.yt,g);h.set(v.key.toString(),v)});const d=[];return o.forEach(g=>{const v=h.get(g.toString());S(!!v),d.push(v)}),d}),function(i,o){return s.apply(this,arguments)})(t.datastore,e);var s;return r.forEach(s=>t.recordVersion(s)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ln(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,p.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,s)=>{const i=I.fromPath(s);e.mutations.push(new po(i,e.precondition(i)))}),yield(r=(0,p.Z)(function*(s,i){const o=x(s),a=dr(o.yt)+"/documents",u={writes:i.map(c=>fr(o.yt,c))};yield o.ao("Commit",a,u)}),function(s,i){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw E();t=A.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new y(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(A.min())?W.exists(!1):W.updateTime(t):W.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(A.min()))throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return W.updateTime(t)}return W.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class gy{constructor(e,t,r,s,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=s,this.deferred=i,this.kc=r.maxAttempts,this.xo=new $o(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.xo.Ro((0,p.Z)(function*(){const t=new my(e.datastore),r=e.Mc(t);r&&r.then(s=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(s)}).catch(i=>{e.Fc(i)}))}).catch(s=>{e.Fc(s)})}))}Mc(e){try{const t=this.updateFunction(e);return!Yn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Rl(t)}return!1}}class py{constructor(e,t,r,s){var i=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=le.UNAUTHENTICATED,this.clientId=Pc.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var o=(0,p.Z)(function*(a){w("FirestoreClient","Received user=",a.uid),yield i.authCredentialListener(a),i.user=a});return function(a){return o.apply(this,arguments)}}()),this.appCheckCredentials.start(r,o=>(w("FirestoreClient","Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}getConfiguration(){var e=this;return(0,p.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new oe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const s=In(r,"Failed to shutdown persistence");t.reject(s)}})),t.promise}}function xd(n,e){return $a.apply(this,arguments)}function $a(){return $a=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),w("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var s=(0,p.Z)(function*(i){r.isEqual(i)||(yield Lh(e.localStore,i),r=i)});return function(i){return s.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),$a.apply(this,arguments)}function Td(n,e){return za.apply(this,arguments)}function za(){return za=(0,p.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield Qa(n);w("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(s=>Xh(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,i)=>Xh(e.remoteStore,i)),n.onlineComponents=e}),za.apply(this,arguments)}function Qa(n){return Za.apply(this,arguments)}function Za(){return Za=(0,p.Z)(function*(n){return n.offlineComponents||(w("FirestoreClient","Using default OfflineComponentProvider"),yield xd(n,new ld)),n.offlineComponents}),Za.apply(this,arguments)}function Qs(n){return Wa.apply(this,arguments)}function Wa(){return Wa=(0,p.Z)(function*(n){return n.onlineComponents||(w("FirestoreClient","Using default OnlineComponentProvider"),yield Td(n,new Ga)),n.onlineComponents}),Wa.apply(this,arguments)}function Ed(n){return Qa(n).then(e=>e.persistence)}function Zs(n){return Qa(n).then(e=>e.localStore)}function Ha(n){return Qs(n).then(e=>e.remoteStore)}function Ya(n){return Qs(n).then(e=>e.syncEngine)}function Sn(n){return Xa.apply(this,arguments)}function Xa(){return Xa=(0,p.Z)(function*(n){const e=yield Qs(n),t=e.eventManager;return t.onListen=$p.bind(null,e.syncEngine),t.onUnlisten=zp.bind(null,e.syncEngine),t}),Xa.apply(this,arguments)}function bd(n,e,t={}){const r=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new zs({next:h=>{i.enqueueAndForget(()=>fa(s,l));const d=h.docs.has(o);!d&&h.fromCache?u.reject(new y(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&"server"===a.source?u.reject(new y(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new pa(on(o.path),c,{includeMetadataChanges:!0,Nu:!0});return ha(s,l)}(yield Sn(n),n.asyncQueue,e,t,r)})),r.promise}function Cd(n,e,t={}){const r=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function(s,i,o,a,u){const c=new zs({next:h=>{i.enqueueAndForget(()=>fa(s,l)),h.fromCache&&"server"===a.source?u.reject(new y(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(h)},error:h=>u.reject(h)}),l=new pa(o,c,{includeMetadataChanges:!0,Nu:!0});return ha(s,l)}(yield Sn(n),n.asyncQueue,e,t,r)})),r.promise}class Ey{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new $o(this,"async_queue_retry"),this.Wc=()=>{const t=Bs();t&&w("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=Bs();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=Bs();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new oe;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,p.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!rt(t))throw t;w("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{throw this.Kc=r,this.Gc=!1,ne("INTERNAL UNHANDLED ERROR: ",function(i){let o=i.message||"";return i.stack&&(o=i.stack.includes(i.message)?i.stack:i.message+"\n"+i.stack),o}(r)),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const s=la.createAndSchedule(this,e,t,r,i=>this.Yc(i));return this.Uc.push(s),s}zc(){this.Kc&&E()}verifyOperationInProgress(){}Xc(){var e=this;return(0,p.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Ja(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const s of["next","error","complete"])if(s in r&&"function"==typeof r[s])return!0;return!1}(n)}class Sy{constructor(){this._progressObserver={},this._taskCompletionResolver=new oe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class z extends Sr{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new Ey,this._persistenceKey=(null==s?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Ad(this),this._firestoreClient.terminate()}}function se(n){return n._firestoreClient||Ad(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Ad(n){var e;const t=n._freezeSettings(),r=(i=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Om(n._databaseId,i,n._persistenceKey,(a=t).host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams));var i,a;n._firestoreClient=new py(n._authCredentials,n._appCheckCredentials,n._queue,r)}function Dd(n,e,t){const r=new oe;return n.asyncQueue.enqueue((0,p.Z)(function*(){try{yield xd(n,t),yield Td(n,e),r.resolve()}catch(s){const i=s;if(!("FirebaseError"===(o=i).name?o.code===m.FAILED_PRECONDITION||o.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&o instanceof DOMException)||22===o.code||20===o.code||11===o.code))throw i;Et("Error enabling offline persistence. Falling back to persistence disabled: "+i),r.reject(i)}var o})).then(()=>r.promise)}function Nd(n){if(n._initialized||n._terminated)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Ge{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ge(ae.fromBase64String(e))}catch(t){throw new y(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Ge(ae.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Ye{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new X(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Gt{constructor(e){this._methodName=e}}class Ws{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return N(this._lat,e._lat)||N(this._long,e._long)}}const Ly=/^__.*__$/;class Oy{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms):new cn(e,this.data,t,this.fieldTransforms)}}class kd{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ze(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Rd(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw E()}}class Hs{constructor(e,t,r,s,i,o){this.settings=e,this.databaseId=t,this.yt=r,this.ignoreUndefinedProperties=s,void 0===i&&this.na(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Hs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ia({path:r,oa:!1});return s.ua(e),s}ca(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),s=this.ia({path:r,oa:!1});return s.na(),s}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Js(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Rd(this.sa)&&Ly.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class Vy{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=r||xr(e)}da(e,t,r,s=!1){return new Hs({sa:e,methodName:t,fa:r,path:X.emptyPath(),oa:!1,la:s},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Kt(n){const e=n._freezeSettings(),t=xr(n._databaseId);return new Vy(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ys(n,e,t,r,s,i={}){const o=n.da(i.merge||i.mergeFields?2:0,e,t,s);ru("Data must be an object, but it was:",o,r);const a=Ld(r,o);let u,c;if(i.merge)u=new Se(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const l=[];for(const h of i.mergeFields){const d=su(e,h,t);if(!o.contains(d))throw new y(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);Vd(l,d)||l.push(d)}u=new Se(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new Oy(new pe(a),u,c)}class br extends Gt{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof br}}function Fd(n,e,t){return new Hs({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class eu extends Gt{_toFieldTransform(e){return new ir(e.path,new an)}isEqual(e){return e instanceof eu}}class Py extends Gt{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Fd(this,e,!0),r=this._a.map(i=>jt(i,t)),s=new Ft(r);return new ir(e.path,s)}isEqual(e){return this===e}}class qy extends Gt{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Fd(this,e,!0),r=this._a.map(i=>jt(i,t)),s=new Mt(r);return new ir(e.path,s)}isEqual(e){return this===e}}class Uy extends Gt{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new un(e.yt,Il(e.yt,this.wa));return new ir(e.path,t)}isEqual(e){return this===e}}function tu(n,e,t,r){const s=n.da(1,e,t);ru("Data must be an object, but it was:",s,r);const i=[],o=pe.empty();Ct(r,(u,c)=>{const l=Xs(e,u,t);c=(0,K.m9)(c);const h=s.ca(l);if(c instanceof br)i.push(l);else{const d=jt(c,h);null!=d&&(i.push(l),o.set(l,d))}});const a=new Se(i);return new kd(o,a,s.fieldTransforms)}function nu(n,e,t,r,s,i){const o=n.da(1,e,t),a=[su(e,r,t)],u=[s];if(i.length%2!=0)throw new y(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(su(e,i[d])),u.push(i[d+1]);const c=[],l=pe.empty();for(let d=a.length-1;d>=0;--d)if(!Vd(c,a[d])){const g=a[d];let v=u[d];v=(0,K.m9)(v);const T=o.ca(g);if(v instanceof br)c.push(g);else{const C=jt(v,T);null!=C&&(c.push(g),l.set(g,C))}}const h=new Se(c);return new kd(l,h,o.fieldTransforms)}function Md(n,e,t,r=!1){return jt(t,n.da(r?4:3,e))}function jt(n,e){if(Od(n=(0,K.m9)(n)))return ru("Unsupported field value:",e,n),Ld(n,e);if(n instanceof Gt)return function(t,r){if(!Rd(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(r);s&&r.fieldTransforms.push(s)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,r){const s=[];let i=0;for(const o of t){let a=jt(o,r.aa(i));null==a&&(a={nullValue:"NULL_VALUE"}),s.push(a),i++}return{arrayValue:{values:s}}}(n,e)}return function(t,r){if(null===(t=(0,K.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Il(r.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const s=Z.fromDate(t);return{timestampValue:hn(r.yt,s)}}if(t instanceof Z){const s=new Z(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:hn(r.yt,s)}}if(t instanceof Ws)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ge)return{bytesValue:Gl(r.yt,t._byteString)};if(t instanceof $){const s=r.databaseId,i=t.firestore._databaseId;if(!i.isEqual(s))throw r.ha(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:yo(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${js(t)}`)}(n,e)}function Ld(n,e){const t={};return zc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ct(n,(r,s)=>{const i=jt(s,e.ra(r));null!=i&&(t[r]=i)}),{mapValue:{fields:t}}}function Od(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof Ws||n instanceof Ge||n instanceof $||n instanceof Gt)}function ru(n,e,t){if(!Od(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=js(t);throw e.ha("an object"===r?n+" a custom object":n+" "+r)}var r}function su(n,e,t){if((e=(0,K.m9)(e))instanceof Ye)return e._internalPath;if("string"==typeof e)return Xs(n,e);throw Js("Field path arguments must be of type string or ",n,!1,void 0,t)}const By=new RegExp("[~\\*/\\[\\]]");function Xs(n,e,t){if(e.search(By)>=0)throw Js(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Ye(...e.split("."))._internalPath}catch(r){throw Js(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Js(n,e,t,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=` in field ${r}`),o&&(u+=` in document ${s}`),u+=")"),new y(m.INVALID_ARGUMENT,a+n+u)}function Vd(n,e){return n.some(t=>t.isEqual(e))}class Cr{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new $(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Gy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ei("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Gy extends Cr{data(){return super.data()}}function ei(n,e){return"string"==typeof e?Xs(n,e):e instanceof Ye?e._internalPath:e._delegate._internalPath}function Pd(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new y(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class iu{}class Ar extends iu{}function gt(n,e,...t){let r=[];e instanceof iu&&r.push(e),r=r.concat(t),function(s){const i=s.filter(a=>a instanceof bn).length,o=s.filter(a=>a instanceof Dr).length;if(i>1||i>0&&o>0)throw new y(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)n=s._apply(n);return n}class Dr extends Ar{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Dr(e,t,r)}_apply(e){const t=this._parse(e);return Gd(e._query,t),new ye(e.firestore,e.converter,fo(e._query,t))}_parse(e){const t=Kt(e.firestore);return function(s,i,o,a,u,c,l){let h;if(u.isKeyField()){if("array-contains"===c||"array-contains-any"===c)throw new y(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${c}' queries on documentId().`);if("in"===c||"not-in"===c){Bd(l,c);const d=[];for(const g of l)d.push(Ud(a,s,g));h={arrayValue:{values:d}}}else h=Ud(a,s,l)}else"in"!==c&&"not-in"!==c&&"array-contains-any"!==c||Bd(l,c),h=Md(o,"where",l,"in"===c||"not-in"===c);return R.create(u,c,h)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class bn extends iu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new bn(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:U.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,s){let i=r;const o=s.getFlattenedFilters();for(const a of o)Gd(i,a),i=fo(i,a)}(e._query,t),new ye(e.firestore,e.converter,fo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ou extends Ar{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ou(e,t)}_apply(e){const t=function(r,s,i){if(null!==r.startAt)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new rn(s,i);return function(a,u){if(null===lo(a)){const c=_s(a);null!==c&&Kd(0,c,u.field)}}(r,o),o}(e._query,this._field,this._direction);return new ye(e.firestore,e.converter,function(r,s){const i=r.explicitOrderBy.concat([s]);return new Qe(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class ti extends Ar{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new ti(e,t,r)}_apply(e){return new ye(e.firestore,e.converter,Is(e._query,this._limit,this._limitType))}}class ni extends Ar{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ni(e,t,r)}_apply(e){const t=qd(e,this.type,this._docOrFields,this._inclusive);return new ye(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,s,r.endAt)));var r,s}}class ri extends Ar{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ri(e,t,r)}_apply(e){const t=qd(e,this.type,this._docOrFields,this._inclusive);return new ye(e.firestore,e.converter,(s=t,new Qe((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,s)));var r,s}}function qd(n,e,t,r){if(t[0]=(0,K.m9)(t[0]),t[0]instanceof Cr)return function(s,i,o,a,u){if(!a)throw new y(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const c=[];for(const l of Rt(s))if(l.field.isKeyField())c.push(Nt(i,a.key));else{const h=a.data.field(l.field);if(ro(h))throw new y(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+l.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===h){const d=l.field.canonicalString();throw new y(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}c.push(h)}return new ut(c,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const s=Kt(n.firestore);return function(i,o,a,u,c,l){const h=i.explicitOrderBy;if(c.length>h.length)throw new y(m.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let g=0;g<c.length;g++){const v=c[g];if(h[g].field.isKeyField()){if("string"!=typeof v)throw new y(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof v}`);if(!ho(i)&&-1!==v.indexOf("/"))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${v}' contains a slash.`);const T=i.path.child(M.fromString(v));if(!I.isDocumentKey(T))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${T}' is not because it contains an odd number of segments.`);const C=new I(T);d.push(Nt(o,C))}else{const T=Md(a,u,v);d.push(T)}}return new ut(d,l)}(n._query,n.firestore._databaseId,s,e,t,r)}}function Ud(n,e,t){if("string"==typeof(t=(0,K.m9)(t))){if(""===t)throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ho(e)&&-1!==t.indexOf("/"))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(M.fromString(t));if(!I.isDocumentKey(r))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Nt(n,new I(r))}if(t instanceof $)return Nt(n,t._key);throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${js(t)}.`)}function Bd(n,e){if(!Array.isArray(n)||0===n.length)throw new y(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new y(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Gd(n,e){if(e.isInequality()){const r=_s(n),s=e.field;if(null!==r&&!r.isEqual(s))throw new y(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${s.toString()}'`);const i=lo(n);null!==i&&Kd(0,s,i)}const t=function(r,s){for(const i of r)for(const o of i.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new y(m.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Kd(n,e,t){if(!t.isEqual(e))throw new y(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class au{convertValue(e,t="none"){switch(Dt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return J(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(At(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw E()}}convertObject(e,t){const r={};return Ct(e.fields,(s,i)=>{r[s]=this.convertValue(i,t)}),r}convertGeoPoint(e){return new Ws(J(e.latitude),J(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Zc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Jn(e));default:return null}}convertTimestamp(e){const t=it(e);return new Z(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=M.fromString(e);S(Xl(r));const s=new st(r.get(1),r.get(3)),i=new I(r.popFirst(5));return s.isEqual(t)||ne(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function si(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Yy extends au{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ge(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $(this.firestore,null,t)}}class $t{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Xe extends Cr{constructor(e,t,r,s,i,o){super(e,t,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Nr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(ei("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Nr extends Xe{data(e={}){return super.data(e)}}class pt{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new $t(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Nr(this._firestore,this._userDataWriter,r.key,r,new $t(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,s){if(r._snapshot.oldDocs.isEmpty()){let i=0;return r._snapshot.docChanges.map(o=>({type:"added",doc:new Nr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new $t(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:i++}))}{let i=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(o=>s||3!==o.type).map(o=>{const a=new Nr(r._firestore,r._userDataWriter,o.doc.key,o.doc,new $t(r._snapshot.mutatedKeys.has(o.doc.key),r._snapshot.fromCache),r.query.converter);let u=-1,c=-1;return 0!==o.type&&(u=i.indexOf(o.doc.key),i=i.delete(o.doc.key)),1!==o.type&&(i=i.add(o.doc),c=i.indexOf(o.doc.key)),{type:Xy(o.type),doc:a,oldIndex:u,newIndex:c}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Xy(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return E()}}function $d(n,e){return n instanceof Xe&&e instanceof Xe?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof pt&&e instanceof pt&&n._firestore===e._firestore&&ja(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class yt extends au{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ge(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new $(this.firestore,null,t)}}function zd(n,e,t){n=F(n,$);const r=F(n.firestore,z),s=si(n.converter,e,t);return Cn(r,[Ys(Kt(r),"setDoc",n._key,s,null!==n.converter,t).toMutation(n._key,W.none())])}function Qd(n,e,t,...r){n=F(n,$);const s=F(n.firestore,z),i=Kt(s);let o;return o="string"==typeof(e=(0,K.m9)(e))||e instanceof Ye?nu(i,"updateDoc",n._key,e,t,r):tu(i,"updateDoc",n._key,e),Cn(s,[o.toMutation(n._key,W.exists(!0))])}function Zd(n,...e){var t,r,s;n=(0,K.m9)(n);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Ja(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Ja(e[o])){const h=e[o];e[o]=null===(t=h.next)||void 0===t?void 0:t.bind(h),e[o+1]=null===(r=h.error)||void 0===r?void 0:r.bind(h),e[o+2]=null===(s=h.complete)||void 0===s?void 0:s.bind(h)}let u,c,l;if(n instanceof $)c=F(n.firestore,z),l=on(n._key.path),u={next:h=>{e[o]&&e[o](uu(c,n,h))},error:e[o+1],complete:e[o+2]};else{const h=F(n,ye);c=F(h.firestore,z),l=h._query;const d=new yt(c);u={next:g=>{e[o]&&e[o](new pt(c,d,h,g))},error:e[o+1],complete:e[o+2]},Pd(n._query)}return function(h,d,g,v){const T=new zs(v),C=new pa(d,T,g);return h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return ha(yield Sn(h),C)})),()=>{T.bc(),h.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return fa(yield Sn(h),C)}))}}(se(c),l,a,u)}function Cn(n,e){return function(t,r){const s=new oe;return t.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Qp(n,e,t){return Ia.apply(this,arguments)}(yield Ya(t),r,s)})),s.promise}(se(n),e)}function uu(n,e,t){const r=t.docs.get(e._key),s=new yt(n);return new Xe(n,s,e._key,r,new $t(t.hasPendingWrites,t.fromCache),e.converter)}const uv={maxAttempts:5};class Wd{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Kt(e)}set(e,t,r){this._verifyNotCommitted();const s=vt(e,this._firestore),i=si(s.converter,t,r),o=Ys(this._dataReader,"WriteBatch.set",s._key,i,null!==s.converter,r);return this._mutations.push(o.toMutation(s._key,W.none())),this}update(e,t,r,...s){this._verifyNotCommitted();const i=vt(e,this._firestore);let o;return o="string"==typeof(t=(0,K.m9)(t))||t instanceof Ye?nu(this._dataReader,"WriteBatch.update",i._key,t,r,s):tu(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(o.toMutation(i._key,W.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=vt(e,this._firestore);return this._mutations=this._mutations.concat(new ln(t._key,W.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function vt(n,e){if((n=(0,K.m9)(n)).firestore!==e)throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class cv extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Kt(e)}get(e){const t=vt(e,this._firestore),r=new Yy(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||1!==s.length)return E();const i=s[0];if(i.isFoundDocument())return new Cr(this._firestore,r,i.key,i,t.converter);if(i.isNoDocument())return new Cr(this._firestore,r,t._key,null,t.converter);throw E()})}set(e,t,r){const s=vt(e,this._firestore),i=si(s.converter,t,r),o=Ys(this._dataReader,"Transaction.set",s._key,i,null!==s.converter,r);return this._transaction.set(s._key,o),this}update(e,t,r,...s){const i=vt(e,this._firestore);let o;return o="string"==typeof(t=(0,K.m9)(t))||t instanceof Ye?nu(this._dataReader,"Transaction.update",i._key,t,r,s):tu(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,o),this}delete(e){const t=vt(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=vt(e,this._firestore),r=new yt(this._firestore);return super.get(e).then(s=>new Xe(this._firestore,r,t._key,s._document,new $t(!1,!1),t.converter))}}function cu(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Yd(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function Xd(){if(!function Vm(){return typeof atob<"u"}())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Jt=Pr.SDK_VERSION,(0,Pr._registerComponent)(new wu.wA("firestore",(t,{instanceIdentifier:r,options:s})=>{const i=t.getProvider("app").getImmediate(),o=new z(new Em(t.getProvider("auth-internal")),new Cm(t.getProvider("app-check-internal")),function(a,u){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new st(a.options.projectId,u)}(i,r),i);return s=Object.assign({useFetchStreams:e},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),(0,Pr.registerVersion)(Lc,"3.8.1",n),(0,Pr.registerVersion)(Lc,"3.8.1","esm2017")}();class kr{constructor(e){this._delegate=e}static fromBase64String(e){return Xd(),new kr(Ge.fromBase64String(e))}static fromUint8Array(e){return Yd(),new kr(Ge.fromUint8Array(e))}toBase64(){return Xd(),this._delegate.toBase64()}toUint8Array(){return Yd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function lu(n){return function vv(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class wv{enableIndexedDbPersistence(e,t){return function Cy(n,e){Nd(n=F(n,z));const t=se(n),r=n._freezeSettings(),s=new Ga;return Dd(t,s,new hd(s,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Ay(n){Nd(n=F(n,z));const e=se(n),t=n._freezeSettings(),r=new Ga;return Dd(e,r,new cy(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function Dy(n){if(n._initialized&&!n._terminated)throw new y(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new oe;return n._queue.enqueueAndForgetEvenWhileRestricted((0,p.Z)(function*(){try{yield(t=(0,p.Z)(function*(r){if(!Me.C())return Promise.resolve();const s=r+"main";yield Me.delete(s)}),function(r){return t.apply(this,arguments)})(Lo(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Jd{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof st||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Et("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function vd(n,e,t,r={}){var s;const i=(n=F(n,Sr))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Et("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let o,a;if("string"==typeof r.mockUserToken)o=r.mockUserToken,a=le.MOCK_USER;else{o=(0,K.Sg)(r.mockUserToken,null===(s=n._app)||void 0===s?void 0:s.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new y(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new le(u)}n._authCredentials=new Tm(new Oc(o,a))}}(this._delegate,e,t,r)}enableNetwork(){return function ky(n){return function yy(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Ed(n),t=yield Ha(n);return e.setNetworkEnabled(!0),function(r){const s=x(r);return s._u.delete(0),Tr(s)}(t)}))}(se(n=F(n,z)))}(this._delegate)}disableNetwork(){return function Ry(n){return function vy(n){return n.asyncQueue.enqueue((0,p.Z)(function*(){const e=yield Ed(n),t=yield Ha(n);return e.setNetworkEnabled(!1),(r=(0,p.Z)(function*(s){const i=x(s);i._u.add(0),yield vn(i),i.gu.set("Offline")}),function(s){return r.apply(this,arguments)})(t);var r}))}(se(n=F(n,z)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,dd("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Ny(n){return function(e){const t=new oe;return e.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return function Yp(n,e){return ba.apply(this,arguments)}(yield Ya(e),t)})),t.promise}(se(n=F(n,z)))}(this._delegate)}onSnapshotsInSync(e){return function av(n,e){return function Iy(n,e){const t=new zs(e);return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield Sn(n),s=t,x(r).Ru.add(s),void s.next();var r,s})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return r=yield Sn(n),s=t,void x(r).Ru.delete(s);var r,s}))}}(se(n=F(n,z)),Ja(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new An(this,wd(this._delegate,e))}catch(t){throw Te(t,"collection()","Firestore.collection()")}}doc(e){try{return new Fe(this,$s(this._delegate,e))}catch(t){throw Te(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ee(this,function ly(n,e){if(n=F(n,Sr),Ka("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ye(n,null,(t=e,new Qe(M.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Te(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function lv(n,e,t){n=F(n,z);const r=Object.assign(Object.assign({},uv),t);return function(s){if(s.maxAttempts<1)throw new y(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,i,o){const a=new oe;return s.asyncQueue.enqueueAndForget((0,p.Z)(function*(){const u=yield function Sd(n){return Qs(n).then(e=>e.datastore)}(s);new gy(s.asyncQueue,u,o,i,a).run()})),a.promise}(se(n),s=>e(new cv(n,s)),r)}(this._delegate,t=>e(new ef(this,t)))}batch(){return se(this._delegate),new tf(new Wd(this._delegate,e=>Cn(this._delegate,e)))}loadBundle(e){return function Fy(n,e){const t=se(n=F(n,z)),r=new Sy;return function xy(n,e,t,r){const s=function(i,o){let a;return a="string"==typeof i?(new TextEncoder).encode(i):i,u=function(u,c){if(u instanceof Uint8Array)return Id(u,c);if(u instanceof ArrayBuffer)return Id(new Uint8Array(u),c);if(u instanceof ReadableStream)return u.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),new hy(u,o);var u}(t,xr(e));n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){!function uy(n,e,t){const r=x(n);var s;(s=(0,p.Z)(function*(i,o,a){try{const u=yield o.getMetadata();if(yield function(d,g){const v=x(d),T=re(g.createTime);return v.persistence.runTransaction("hasNewerBundle","readonly",C=>v.Ns.getBundleMetadata(C,g.id)).then(C=>!!C&&C.createTime.compareTo(T)>=0)}(i.localStore,u))return yield o.close(),a._completeWith({taskState:"Success",documentsLoaded:(d=u).totalDocuments,bytesLoaded:d.totalBytes,totalDocuments:d.totalDocuments,totalBytes:d.totalBytes}),Promise.resolve(new Set);a._updateProgress(td(u));const c=new Bp(u,i.localStore,o.yt);let l=yield o.mc();for(;l;){const d=yield c.Fu(l);d&&a._updateProgress(d),l=yield o.mc()}const h=yield c.complete();return yield He(i,h.Lu,void 0),yield function(d,g){const v=x(d);return v.persistence.runTransaction("Save bundle","readwrite",T=>v.Ns.saveBundleMetadata(T,g))}(i.localStore,u),a._completeWith(h.progress),Promise.resolve(h.Bu)}catch(u){return Et("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}var d}),function(i,o,a){return s.apply(this,arguments)})(r,e,t).then(s=>{r.sharedClientState.notifyBundleLoaded(s)})}(yield Ya(n),s,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function My(n,e){return function Ty(n,e){return n.asyncQueue.enqueue((0,p.Z)(function*(){return function(t,r){const s=x(t);return s.persistence.runTransaction("Get named query","readonly",i=>s.Ns.getNamedQuery(i,r))}(yield Zs(n),e)}))}(se(n=F(n,z)),e).then(t=>t?new ye(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Ee(this,t):null)}}class ii extends au{constructor(e){super(),this.firestore=e}convertBytes(e){return new kr(new Ge(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Fe.forKey(t,this.firestore,null)}}class ef{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ii(e)}get(e){const t=Qt(e);return this._delegate.get(t).then(r=>new Rr(this._firestore,new Xe(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const s=Qt(e);return r?(cu("Transaction.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Qt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Qt(e);return this._delegate.delete(t),this}}class tf{constructor(e){this._delegate=e}set(e,t,r){const s=Qt(e);return r?(cu("WriteBatch.set",r),this._delegate.set(s,t,r)):this._delegate.set(s,t),this}update(e,t,r,...s){const i=Qt(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,r,...s),this}delete(e){const t=Qt(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class zt{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Nr(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fr(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=zt.INSTANCES;let s=r.get(e);s||(s=new WeakMap,r.set(e,s));let i=s.get(t);return i||(i=new zt(e,new ii(e),t),s.set(t,i)),i}}zt.INSTANCES=new WeakMap;class Fe{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ii(e)}static forPath(e,t,r){if(e.length%2!=0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Fe(t,new $(t._delegate,r,new I(e)))}static forKey(e,t,r){return new Fe(t,new $(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new An(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new An(this.firestore,wd(this._delegate,e))}catch(t){throw Te(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,K.m9)(e))instanceof $&&_d(this._delegate,e)}set(e,t){t=cu("DocumentReference.set",t);try{return t?zd(this._delegate,e,t):zd(this._delegate,e)}catch(r){throw Te(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Qd(this._delegate,e):Qd(this._delegate,e,t,...r)}catch(s){throw Te(s,"updateDoc()","DocumentReference.update()")}}delete(){return function iv(n){return Cn(F(n.firestore,z),[new ln(n._key,W.none())])}(this._delegate)}onSnapshot(...e){const t=nf(e),r=rf(e,s=>new Rr(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return Zd(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function ev(n){n=F(n,$);const e=F(n.firestore,z),t=se(e),r=new yt(e);return function wy(n,e){const t=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield function(u,c){const l=x(u);return l.persistence.runTransaction("read document","readonly",h=>l.localDocuments.getDocument(h,c))}(s,i);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const u=In(a,`Failed to get document '${i} from cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Zs(n),e,t);var r})),t.promise}(t,n._key).then(s=>new Xe(e,r,n._key,s,new $t(null!==s&&s.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function tv(n){n=F(n,$);const e=F(n.firestore,z);return bd(se(e),n._key,{source:"server"}).then(t=>uu(e,n,t))}(this._delegate):function Jy(n){n=F(n,$);const e=F(n.firestore,z);return bd(se(e),n._key).then(t=>uu(e,n,t))}(this._delegate),t.then(r=>new Rr(this.firestore,new Xe(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Fe(this.firestore,this._delegate.withConverter(e?zt.getInstance(this.firestore,e):null))}}function Te(n,e,t){return n.message=n.message.replace(e,t),n}function nf(n){for(const e of n)if("object"==typeof e&&!lu(e))return e;return{}}function rf(n,e){var t,r;let s;return s=lu(n[0])?n[0]:lu(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:i=>{s.next&&s.next(e(i))},error:null===(t=s.error)||void 0===t?void 0:t.bind(s),complete:null===(r=s.complete)||void 0===r?void 0:r.bind(s)}}class Rr{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Fe(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return $d(this._delegate,e._delegate)}}class Fr extends Rr{data(e){const t=this._delegate.data(e);return function Im(n,e){n||E()}(void 0!==t),t}}class Ee{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ii(e)}where(e,t,r){try{return new Ee(this.firestore,gt(this._delegate,function Ky(n,e,t){const r=e,s=ei("where",n);return Dr._create(s,r,t)}(e,t,r)))}catch(s){throw Te(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Ee(this.firestore,gt(this._delegate,function jy(n,e="asc"){const t=e,r=ei("orderBy",n);return ou._create(r,t)}(e,t)))}catch(r){throw Te(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Ee(this.firestore,gt(this._delegate,function $y(n){return gd("limit",n),ti._create("limit",n,"F")}(e)))}catch(t){throw Te(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Ee(this.firestore,gt(this._delegate,function zy(n){return gd("limitToLast",n),ti._create("limitToLast",n,"L")}(e)))}catch(t){throw Te(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Ee(this.firestore,gt(this._delegate,function Qy(...n){return ni._create("startAt",n,!0)}(...e)))}catch(t){throw Te(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Ee(this.firestore,gt(this._delegate,function Zy(...n){return ni._create("startAfter",n,!1)}(...e)))}catch(t){throw Te(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Ee(this.firestore,gt(this._delegate,function Wy(...n){return ri._create("endBefore",n,!1)}(...e)))}catch(t){throw Te(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Ee(this.firestore,gt(this._delegate,function Hy(...n){return ri._create("endAt",n,!0)}(...e)))}catch(t){throw Te(t,"endAt()","Query.endAt()")}}isEqual(e){return ja(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function rv(n){n=F(n,ye);const e=F(n.firestore,z),t=se(e),r=new yt(e);return function _y(n,e){const t=new oe;return n.asyncQueue.enqueueAndForget((0,p.Z)(function*(){return(r=(0,p.Z)(function*(s,i,o){try{const a=yield Ps(s,i,!0),u=new sd(i,a.Hi),c=u.Wu(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){const u=In(a,`Failed to execute query '${i} against cache`);o.reject(u)}}),function(s,i,o){return r.apply(this,arguments)})(yield Zs(n),e,t);var r})),t.promise}(t,n._query).then(s=>new pt(e,r,n,s))}(this._delegate):"server"===(null==e?void 0:e.source)?function sv(n){n=F(n,ye);const e=F(n.firestore,z),t=se(e),r=new yt(e);return Cd(t,n._query,{source:"server"}).then(s=>new pt(e,r,n,s))}(this._delegate):function nv(n){n=F(n,ye);const e=F(n.firestore,z),t=se(e),r=new yt(e);return Pd(n._query),Cd(t,n._query).then(s=>new pt(e,r,n,s))}(this._delegate),t.then(r=>new hu(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=nf(e),r=rf(e,s=>new hu(this.firestore,new pt(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return Zd(this._delegate,t,r)}withConverter(e){return new Ee(this.firestore,this._delegate.withConverter(e?zt.getInstance(this.firestore,e):null))}}class Iv{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class hu{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ee(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Fr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Iv(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Fr(this._firestore,r))})}isEqual(e){return $d(this._delegate,e._delegate)}}class An extends Ee{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Fe(this.firestore,e):null}doc(e){try{return new Fe(this.firestore,void 0===e?$s(this._delegate):$s(this._delegate,e))}catch(t){throw Te(t,"doc()","CollectionReference.doc()")}}add(e){return function ov(n,e){const t=F(n.firestore,z),r=$s(n),s=si(n.converter,e);return Cn(t,[Ys(Kt(n.firestore),"addDoc",r._key,s,null!==n.converter,{}).toMutation(r._key,W.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Fe(this.firestore,t))}isEqual(e){return _d(this._delegate,e._delegate)}withConverter(e){return new An(this.firestore,this._delegate.withConverter(e?zt.getInstance(this.firestore,e):null))}}function Qt(n){return F(n,$)}class du{constructor(...e){this._delegate=new Ye(...e)}static documentId(){return new du(X.keyField().canonicalString())}isEqual(e){return(e=(0,K.m9)(e))instanceof Ye&&this._delegate._internalPath.isEqual(e._internalPath)}}class Zt{constructor(e){this._delegate=e}static serverTimestamp(){const e=function dv(){return new eu("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new Zt(e)}static delete(){const e=function hv(){return new br("deleteField")}();return e._methodName="FieldValue.delete",new Zt(e)}static arrayUnion(...e){const t=function fv(...n){return new Py("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new Zt(t)}static arrayRemove(...e){const t=function mv(...n){return new qy("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new Zt(t)}static increment(e){const t=function gv(n){return new Uy("increment",n)}(e);return t._methodName="FieldValue.increment",new Zt(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const xv={Firestore:Jd,GeoPoint:Ws,Timestamp:Z,Blob:kr,Transaction:ef,WriteBatch:tf,DocumentReference:Fe,DocumentSnapshot:Rr,Query:Ee,QueryDocumentSnapshot:Fr,QuerySnapshot:hu,CollectionReference:An,FieldPath:du,FieldValue:Zt,setLogLevel:function _v(n){!function _m(n){tt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function Ev(n){(function Tv(n,e){n.INTERNAL.registerComponent(new wu.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(r,s)},"PUBLIC").setServiceProps(Object.assign({},xv)))})(n,(e,t)=>new Jd(e,t,new wv)),n.registerVersion("@firebase/firestore-compat","0.3.1")}(yf.Z);var Sv=P(6217);function sf(n,e){return function bv(n,e=df.z){return new ff.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function fu(n,e){return sf(n,e).pipe((0,Le.U)(t=>({payload:t,type:"query"})))}function oi(n,e){return fu(n,e).pipe((0,ui.O)(void 0),ci(),(0,Le.U)(([t,r])=>{const s=r.payload.docChanges(),i=s.map(o=>({type:o.type,payload:o}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((o,a)=>{const u=s.find(l=>l.doc.ref.isEqual(o.ref)),c=null==t?void 0:t.payload.docs.find(l=>l.ref.isEqual(o.ref));u&&JSON.stringify(u.doc.metadata)===JSON.stringify(o.metadata)||!u&&c&&JSON.stringify(c.metadata)===JSON.stringify(o.metadata)||i.push({type:"modified",payload:{oldIndex:a,newIndex:a,type:"modified",doc:o}})}),i}))}function of(n,e,t){return oi(n,t).pipe((0,li.R)((r,s)=>function Av(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function Dv(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return mu(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return mu(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return mu(n,e.oldIndex,1)}return n}(n,r))}),n}(r,s.map(i=>i.payload),e),[]),(0,pf.x)(),(0,Le.U)(r=>r.map(s=>({type:s.type,payload:s}))))}function mu(n,e,t,...r){const s=n.slice();return s.splice(e,t,...r),s}function af(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}P(9260);class uf{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=oi(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Le.U)(r=>r.filter(s=>e.indexOf(s.type)>-1)))),t.pipe((0,ui.O)(void 0),ci(),(0,vu.h)(([r,s])=>s.length>0||!r),(0,Le.U)(([r,s])=>s),Re.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,li.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=af(e);return of(this.query,t,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return fu(this.query,this.afs.schedulers.outsideAngular).pipe((0,Le.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Re.iC)}get(e){return(0,Or.D)(this.query.get(e)).pipe(Re.iC)}add(e){return this.ref.add(e)}doc(e){return new cf(this.ref.doc(e),this.afs)}}class cf{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:s,query:i}=lf(r,t);return new uf(s,i,this.afs)}snapshotChanges(){return function Cv(n,e){return sf(n,e).pipe((0,ui.O)(void 0),ci(),(0,Le.U)(([t,r])=>r.exists?null!=t&&t.exists?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Le.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Or.D)(this.ref.get(e)).pipe(Re.iC)}}class Nv{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?oi(this.query,this.afs.schedulers.outsideAngular).pipe((0,Le.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,vu.h)(t=>t.length>0),Re.iC):oi(this.query,this.afs.schedulers.outsideAngular).pipe(Re.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,li.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=af(e);return of(this.query,t,this.afs.schedulers.outsideAngular).pipe(Re.iC)}valueChanges(e={}){return fu(this.query,this.afs.schedulers.outsideAngular).pipe((0,Le.U)(r=>r.payload.docs.map(s=>e.idField?Object.assign({[e.idField]:s.id},s.data()):s.data())),Re.iC)}get(e){return(0,Or.D)(this.query.get(e)).pipe(Re.iC)}}const kv=new _.OlP("angularfire2.enableFirestorePersistence"),Rv=new _.OlP("angularfire2.firestore.persistenceSettings"),Fv=new _.OlP("angularfire2.firestore.settings"),Mv=new _.OlP("angularfire2.firestore.use-emulator");function lf(n,e=(t=>t)){return{query:e(n),ref:n}}let Lv=(()=>{class n{constructor(t,r,s,i,o,a,u,c,l,h,d,g,v,T,C,G,H){this.schedulers=u;const O=(0,Vr.on)(t,a,r),te=l;h&&(0,Ke.nw)(O,a,d,v,T,C,g,G),[this.firestore,this.persistenceEnabled$]=(0,Vr.cc)(`${O.name}.firestore`,"AngularFirestore",O.name,()=>{const V=a.runOutsideAngular(()=>O.firestore());if(i&&V.settings(i),te&&V.useEmulator(...te),s&&!(0,pu.PM)(o)){const q=()=>{try{return(0,Or.D)(V.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ue){return typeof console<"u"&&console.warn(ue),(0,ai.of)(!1)}};return[V,a.runOutsideAngular(q)]}return[V,(0,ai.of)(!1)]},[i,te,s])}collection(t,r){let s;s="string"==typeof t?this.firestore.collection(t):t;const{ref:i,query:o}=lf(s,r),a=this.schedulers.ngZone.run(()=>i);return new uf(a,o,this)}collectionGroup(t,r){const s=r||(o=>o),i=this.firestore.collectionGroup(t);return new Nv(s(i),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const s=this.schedulers.ngZone.run(()=>r);return new cf(s,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(_.LFG(Vr.Dh),_.LFG(Vr.xv,8),_.LFG(kv,8),_.LFG(Fv,8),_.LFG(_.Lbi),_.LFG(_.R0b),_.LFG(Re.HU),_.LFG(Rv,8),_.LFG(Mv,8),_.LFG(Ke.zQ,8),_.LFG(Ke.Qv,8),_.LFG(Ke.L6,8),_.LFG(Ke._Q,8),_.LFG(Ke.rT,8),_.LFG(Ke.lh,8),_.LFG(Ke.f7,8),_.LFG(Sv.nm,8))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Ov=(()=>{class n{constructor(t,r){this.afAuth=t,this.afs=r,this.user$=this.afAuth.authState.pipe((0,hf.w)(s=>s?this.afs.doc(`usuarios/${s.uid}`).valueChanges():(0,ai.of)(null)))}register(t,r){return(0,Dn.mG)(this,void 0,void 0,function*(){try{const{user:s}=yield this.afAuth.createUserWithEmailAndPassword(t,r);return yield this.enviarVerificacionEmail(),s}catch(s){return console.log(s),null}})}login(t,r){return(0,Dn.mG)(this,void 0,void 0,function*(){try{const{user:s}=yield this.afAuth.signInWithEmailAndPassword(t,r);return yield this.updateUserData(s),s}catch(s){return console.log(s),null}})}enviarVerificacionEmail(){return(0,Dn.mG)(this,void 0,void 0,function*(){try{return(yield this.afAuth.currentUser).sendEmailVerification()}catch(t){console.log(t)}})}isEmailVerificado(t){return!0===t.emailVerified}updateUserData(t){return this.afs.doc(`usuarios/${t.uid}`).set({uid:t.uid,email:t.email,emailVerified:t.emailVerified,displayName:t.displayName},{merge:!0})}}return n.\u0275fac=function(t){return new(t||n)(_.LFG(Ke.zQ),_.LFG(Lv))},n.\u0275prov=_.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Vv=[{path:"",component:(()=>{class n{constructor(t){this.firebase=t}ngOnInit(){}onRegister(t,r){return(0,Dn.mG)(this,void 0,void 0,function*(){try{const s=yield this.firebase.register(t.value,r.value);s&&console.log("Usuario->",s)}catch(s){console.log("Error",s)}})}onLogin(t,r){return(0,Dn.mG)(this,void 0,void 0,function*(){try{const s=yield this.firebase.login(t.value,r.value);this.firebase.isEmailVerificado(s)&&(document.getElementById("boton-acceso").innerHTML="Activado",document.getElementById("boton-acceso").setAttribute("disabled","false"))}catch(s){console.log("Error",s)}})}}return n.\u0275fac=function(t){return new(t||n)(_.Y36(Ov))},n.\u0275cmp=_.Xpm({type:n,selectors:[["app-login"]],decls:42,vars:1,consts:[["color","secondary",1,"ion-text-center"],[2,"text-decoration","underline"],["lines","full"],["position","floatting"],["type","text","requiered",""],["emailRegister",""],["type","password","requiered",""],["passwordRegister",""],["size","12"],["type","submit","expand","block",3,"click"],["emailLog",""],["passwordLog",""],["id","boton-acceso","expand","block","fill","clear","shape","round",3,"disabled"]],template:function(t,r){if(1&t){const s=_.EpF();_.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),_._uU(3,"Login"),_.qZA()()(),_.TgZ(4,"ion-content")(5,"ion-text",0)(6,"h1",1),_._uU(7,"Registrar"),_.qZA()(),_.TgZ(8,"form")(9,"ion-item",2)(10,"ion-label",3),_._uU(11,"Email"),_.qZA(),_._UZ(12,"ion-input",4,5),_.qZA(),_.TgZ(14,"ion-item",2)(15,"ion-label",3),_._uU(16,"Password"),_.qZA(),_._UZ(17,"ion-input",6,7),_.qZA(),_.TgZ(19,"ion-row")(20,"ion-col",8)(21,"ion-button",9),_.NdJ("click",function(){_.CHM(s);const o=_.MAs(13),a=_.MAs(18);return _.KtG(r.onRegister(o,a))}),_._uU(22," Registar "),_.qZA()()()(),_.TgZ(23,"ion-text",0)(24,"h1",1),_._uU(25,"Iniciar Sesi\xf3n"),_.qZA()(),_.TgZ(26,"ion-item",2)(27,"ion-label",3),_._uU(28,"Email"),_.qZA(),_._UZ(29,"ion-input",4,10),_.qZA(),_.TgZ(31,"ion-item",2)(32,"ion-label",3),_._uU(33,"Password"),_.qZA(),_._UZ(34,"ion-input",6,11),_.qZA(),_.TgZ(36,"ion-row")(37,"ion-col",8)(38,"ion-button",9),_.NdJ("click",function(){_.CHM(s);const o=_.MAs(30),a=_.MAs(35);return _.KtG(r.onLogin(o,a))}),_._uU(39," Iniciar Sesi\xf3n "),_.qZA()()(),_.TgZ(40,"ion-button",12),_._uU(41," Desactivado "),_.qZA()()}2&t&&(_.xp6(40),_.Q6J("disabled",!0))},dependencies:[Lr._Y,Lr.JL,Lr.F,Ae.YG,Ae.wI,Ae.W2,Ae.Gu,Ae.pK,Ae.Ie,Ae.Q$,Ae.Nd,Ae.yW,Ae.wd,Ae.sr,Ae.j9]}),n})()}];let Pv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[yu.Bz.forChild(Vv),yu.Bz]}),n})(),qv=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=_.oAB({type:n}),n.\u0275inj=_.cJS({imports:[pu.ez,Lr.u5,Ae.Pc,Pv]}),n})()}}]);